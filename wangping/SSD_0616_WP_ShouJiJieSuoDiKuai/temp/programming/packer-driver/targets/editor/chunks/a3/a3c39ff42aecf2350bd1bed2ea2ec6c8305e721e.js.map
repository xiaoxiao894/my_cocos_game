{"version":3,"sources":["file:///D:/playable/wangping/SSD_0616_WP_ShouJiJieSuoDiKuai/assets/Script/core/CameraMain.ts"],"names":["_decorator","Camera","Component","Quat","v3","Vec3","tween","CCInteger","ccclass","property","tempPos","CameraMain","initialPos","initialRotation","_tweenAni","start","node","worldPosition","clone","getRotation","moveToCenter","scheduleOnce","realMove","delayTime","distence","distance","t","speed","to","stopTweenAni","stop","unschedule","moveCenterAndScale","orgHeight","camera","orthoHeight","easing","onUpdate","target","ratio"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;AAAYC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,I,OAAAA,I;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,S,OAAAA,S;;;;;;;;;OAE/D;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;AAE1BU,MAAAA,O,GAAgBN,EAAE,E;;4BAGTO,U,WADZH,OAAO,CAAC,YAAD,C,UAGHC,QAAQ,CAACR,MAAD,C,UAERQ,QAAQ,CAACF,SAAD,C,UAERE,QAAQ,CAACF,SAAD,C,2BAPb,MACaI,UADb,SACgCT,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAS9BU,UAT8B,GASXR,EAAE,EATS;AAAA,eAU9BS,eAV8B,GAUN,IAAIV,IAAJ,EAVM;AAAA,eAW9BW,SAX8B;AAAA;;AAatCC,QAAAA,KAAK,GAAG;AAGJ;AACA,eAAKH,UAAL,GAAkB,KAAKI,IAAL,CAAUC,aAAV,CAAwBC,KAAxB,EAAlB,CAJI,CAKJ;;AACA,eAAKF,IAAL,CAAUG,WAAV,CAAsB,KAAKN,eAA3B;AACH,SApBqC,CAwBtC;;;AACOO,QAAAA,YAAY,GAAE;AACjB,eAAKC,YAAL,CAAkB,KAAKC,QAAvB,EAAgC,KAAKC,SAArC;AACH;;AAEOD,QAAAA,QAAQ,GAAE;AACd,cAAIE,QAAe,GAAGnB,IAAI,CAACoB,QAAL,CAAc,KAAKT,IAAL,CAAUC,aAAxB,EAAsC,KAAKL,UAA3C,CAAtB;AACA,cAAIc,CAAQ,GAAG,KAAKC,KAAL,GAAWH,QAA1B;AACA,eAAKV,SAAL,GAAiBR,KAAK,CAAC,KAAKU,IAAN,CAAL,CAAiBY,EAAjB,CAAoBF,CAApB,EAAsB;AAACT,YAAAA,aAAa,EAAC,KAAKL;AAApB,WAAtB,EAAuDG,KAAvD,EAAjB;AACH,SAjCqC,CAmCtC;;;AACOc,QAAAA,YAAY,GAAE;AACjB,cAAG,KAAKf,SAAR,EAAkB;AACd,iBAAKA,SAAL,CAAegB,IAAf;AACH;;AACD,eAAKC,UAAL,CAAgB,KAAKT,QAArB;AACH,SAzCqC,CA2CtC;;;AACOU,QAAAA,kBAAkB,GAAE;AACvB,gBAAMC,SAAgB,GAAG,KAAKC,MAAL,CAAYC,WAArC;AACA,eAAKrB,SAAL,GAAiBR,KAAK,CAAC,KAAKU,IAAN,CAAL,CAChBY,EADgB,CACb,GADa,EACT;AAACX,YAAAA,aAAa,EAAC,KAAKL;AAApB,WADS,EACuB;AACpCwB,YAAAA,MAAM,EAAE,SAD4B;AACjB;AACnBC,YAAAA,QAAQ,EAAE,CAACC,MAAD,EAASC,KAAT,KAAmB;AACzB;AACA,mBAAKL,MAAL,CAAYC,WAAZ,GAA0BF,SAAS,GAAEM,KAAK,GAAC,CAA3C;AACH;AALmC,WADvB,EAOdxB,KAPc,EAAjB;AAQH;;AAtDqC,O;;;;;iBAGd,I;;;;;;;iBAET,G;;;;;;;iBAEI,C","sourcesContent":["import { _decorator, Camera, Component,  Quat, v3, Vec3,Node, tween, CCInteger, Tween } from 'cc';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet tempPos: Vec3 = v3();\r\n\r\n@ccclass('CameraMain')\r\nexport class CameraMain extends Component {\r\n\r\n    @property(Camera)\r\n    camera: Camera | null = null;\r\n    @property(CCInteger)\r\n    speed:number = 0.7;\r\n    @property(CCInteger)\r\n    delayTime:number = 5;\r\n\r\n    private initialPos: Vec3 = v3();      \r\n    private initialRotation: Quat = new Quat(); \r\n    private _tweenAni:Tween<Node>;\r\n\r\n    start() {\r\n      \r\n\r\n        // 记录初始位置\r\n        this.initialPos = this.node.worldPosition.clone();\r\n        // 记录初始旋转角度（保持角度不变）\r\n        this.node.getRotation(this.initialRotation);\r\n    }\r\n\r\n\r\n\r\n    //回到中心位置\r\n    public moveToCenter(){\r\n        this.scheduleOnce(this.realMove,this.delayTime);\r\n    }\r\n\r\n    private realMove(){\r\n        let distence:number = Vec3.distance(this.node.worldPosition,this.initialPos);\r\n        let t:number = this.speed*distence;\r\n        this._tweenAni = tween(this.node).to(t,{worldPosition:this.initialPos}).start();\r\n    }\r\n\r\n    //停止回到中心位\r\n    public stopTweenAni(){\r\n        if(this._tweenAni){\r\n            this._tweenAni.stop();\r\n        }\r\n        this.unschedule(this.realMove);\r\n    }\r\n\r\n    //移动摄像机并且升高高度\r\n    public moveCenterAndScale(){\r\n        const orgHeight:number = this.camera.orthoHeight;\r\n        this._tweenAni = tween(this.node)\r\n        .to(0.5,{worldPosition:this.initialPos},{\r\n            easing: 'sineOut', // 使用缓动函数使动画更自然\r\n            onUpdate: (target, ratio) => {\r\n                // 动态调整正交摄像机大小\r\n                this.camera.orthoHeight = orgHeight +ratio*5;\r\n            }\r\n        }).start();\r\n    }\r\n}\r\n"]}