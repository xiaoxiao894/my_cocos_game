{"version":3,"sources":["file:///D:/playable/wangping/SSD_0616_WP_ShouJiJieSuoDiKuai/assets/Script/Game/WorldMap.ts"],"names":["_decorator","Component","Label","Node","Sprite","Animation","Material","MeshRenderer","tween","eventMgr","EventType","EnemyTree","Global","GroundEffct","enemyCharacter","treeController","playerController","super_html_playable","BubbleFead","ccclass","property","google_play","appstore","WorldMap","type","tooltip","isShowUpgradeNodep","upgradeUIAnmationTree","upgradeUIAnmationEnemy","changeAnimation","isComplate","isAniTrue","start","set_google_play_url","set_app_store_url","upgradeNodep1","getComponent","upgradeNodep","initAll","soundManager","playBgMusic","initAllTree","treeParentNode","initCharacters","characterParent","birthNodes","endNodes","cronNodesPos","enemyHandOverPos","allCharacterPos","enemySelfLanPos","onListenerEvent","on","ENTITY_MOVE_TREE","moveTreeCallBack","ENTITY_MOVE_HAND_OVER","moveHandOver","bind","ENTITY_HAND_OVER_ADD","updateHandOverProgress","ENTITY_TREE_COMPLATE","treeUpgradeComplate","ENTITY_TREE_TRANSMIT","treeTransmitCallback","ENTITY_CORN_CUT","cornCutCallback","ENTITY_ENEMY_TRANSMIT","enemyTransmitCallback","ENTITY_ENEMY_DIE","enemyDieCallback","ENTITY_ENEMY_HAND_OVER","enemyHandOverCallback","ENTITY_CORNHAND_OVER_ADD","enemyHandeOverAdd","ENTITY_CORN_COMPLATE","enemyHandOverComplate","ENTITY_CLICK_ENEMY","clickEnemyAttack","ENTITY_SHOW_TREEHANDE","showTreeHande","ENTITY_ALL_DIE","allDieCallback","SHOW_ENEMY","showCallBack","GAME_OVER","gameOver","ENTITY_HAND_OVER_NO","handoverNo","children","forEach","item","active","enemy","animationNum","setFindState","console","log","getChildByName","Show1","curCollectNum","houseMaterial","GroundEffect","enemyLandHouse","node","sequence","call","material","meterialHouseChange","delay","materialHouseBase","repeat","enemyParent","scheduleOnce","isClickUpgrade","red","upgradeUIAnimtion","playShatterSound","ani","play","once","FINISHED","allCharacterHanover","target","behaviourType","squenceMove","squenceHandOver","sp","greenScript","curNum","getParent","maxNum","current","Math","max","min","treeHandOverNum","treeHandOverNumLimit","string","toString","percentage","fillRange","round","upgradeTreeHouseAnimation","passAnimation1","treeArrow","selfNode","ArrowgroundObject2_1","ArrowgroundObject2_2","ArrowgroundObject2_3","ArrowgroundObject2_4","isClickUpLandTree","passAnimation11","resetBehaviour","moveCornPos","i","clickCornLand","length","cutCornController","upgradeAnimationgPlayTyep","isStartMoveEnemyLand","isClickUpLandCorn","schedule","hideCornArrow","passAnimation21","moveFindEnemyLandPos","arrowEnemynode","attackEnemy","cahracter","warnUI","stopWarnFadeAnimation","isClickEnemy","showAllTreeClick","isEnemyCutTree","moveFindEnemHandOver","greenScript_1","cornHandOverNum","cornHandOverNumLimit","character","upgradeEnemyHouseAnimation","GameHandOverComplate","passAnimation3","gameEndUI","update","deltaTime","clickNum","stop","animState","getState","isPlaying","speed"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Component, Label, Node, Sprite, Animation, Vec3, Quat, Material, MeshRenderer, tween } from 'cc';\r\nimport { eventMgr } from '../core/EventManager';\r\nimport { EventType } from '../core/EventType';\r\nimport { EnemyTree } from '../entitys/EnemyTree';\r\nimport Entity from '../entitys/Entity';\r\nimport { BehaviourType } from '../entitys/Character';\r\nimport { Global } from '../core/Global';\r\nimport { GroundEffct } from '../GroundEffct';\r\nimport { enemyCharacter } from '../entitys/enemyCharacter';\r\nimport { treeController } from './TreeController';\r\nimport { playerController } from './PlayerController';\r\nimport super_html_playable from '../../super_html_playable';\r\nimport { BubbleFead } from '../BubbleFead';\r\nconst { ccclass, property } = _decorator;\r\nconst google_play = \"https://play.google.com/store/apps/details?id=com.funplus.ts.global\";\r\nconst appstore = \"https://play.google.com/store/apps/details?id=com.funplus.ts.global\";\r\n@ccclass('WorldMap')\r\nexport class WorldMap extends Component {\r\n\r\n    @property(Node)\r\n    public mainCamera: Camera = null;\r\n\r\n    @property(Node)\r\n    private greenScript: Node = null;\r\n\r\n    @property(Node)\r\n    private greenScript_1: Node = null;\r\n\r\n    @property(Node)\r\n    private treeArrow: Node = null;\r\n\r\n    @property(Node)\r\n    private upgradeNodep: Node = null;\r\n\r\n    private isShowUpgradeNodep: boolean = false;\r\n\r\n    @property(Node)\r\n    private upgradeNodep1: Node = null;\r\n\r\n    @property(GroundEffct)\r\n    private GroundEffect: GroundEffct = null;\r\n\r\n\r\n    @property(Node)\r\n    private enemyParent: Node = null;\r\n\r\n    @property(Node)\r\n    private characterParent: Node = null;\r\n\r\n    @property(Node)\r\n    private treeParentNode: Node = null;\r\n\r\n\r\n    //出生点 和第一地块交付的位置 //\r\n    @property({ type: Node, tooltip: \"birshPos1\" })\r\n    private birthNodes: Node[] = []\r\n\r\n    @property(Material)\r\n    private materialHouseBase: Material = null;\r\n    @property(Material)\r\n    private meterialHouseChange: Material = null;\r\n\r\n\r\n    //结束点传送点  暂时没有用 后续看需要\r\n    @property({ type: Node, tooltip: \"endPos1\" })\r\n    private endNodes: Node[] = []\r\n\r\n\r\n    @property({ type: Node, tooltip: \"enemySelfPos1\" })\r\n    private enemySelfLanPos: Node[] = [];\r\n\r\n    //玉米地占位点\r\n    @property({ type: Node, tooltip: \"cornPos1\" })\r\n    private cronNodesPos: Node[] = []\r\n\r\n    //人物交付时候所站的位置\r\n    @property({ type: Node, tooltip: \"enemyHandOverPos1\" })\r\n    private enemyHandOverPos: Node[] = []\r\n\r\n    //游戏结束时候四散的位置\r\n    @property({ type: Node, tooltip: \"gameOverPos1\" })\r\n    private allCharacterPos: Node[] = []\r\n\r\n\r\n    private upgradeUIAnmationTree: Animation = null;\r\n    private upgradeUIAnmationEnemy: Animation = null;\r\n\r\n    private changeAnimation: Animation = null;\r\n\r\n\r\n    @property(Node)\r\n    gameEndUI: Node = null;\r\n\r\n    private isComplate: boolean = false;\r\n\r\n    start() {\r\n        super_html_playable.set_google_play_url(google_play);\r\n        super_html_playable.set_app_store_url(appstore);\r\n        this.upgradeUIAnmationEnemy = this.upgradeNodep1.getComponent(Animation);\r\n        this.upgradeUIAnmationTree = this.upgradeNodep.getComponent(Animation);\r\n        this.initAll()\r\n        Global.soundManager.playBgMusic()\r\n\r\n    }\r\n    initAll() {\r\n\r\n        treeController.initAllTree(this.treeParentNode);\r\n        playerController.initCharacters(this.characterParent, this.birthNodes, this.endNodes,\r\n            this.cronNodesPos, this.enemyHandOverPos, this.allCharacterPos, this.enemySelfLanPos);\r\n        this.onListenerEvent()\r\n    }\r\n    onListenerEvent() {\r\n        eventMgr.on(EventType.ENTITY_MOVE_TREE, this.moveTreeCallBack)\r\n        eventMgr.on(EventType.ENTITY_MOVE_HAND_OVER, this.moveHandOver.bind(this))\r\n        eventMgr.on(EventType.ENTITY_HAND_OVER_ADD, this.updateHandOverProgress.bind(this));\r\n        eventMgr.on(EventType.ENTITY_TREE_COMPLATE, this.treeUpgradeComplate.bind(this))\r\n        eventMgr.on(EventType.ENTITY_TREE_TRANSMIT, this.treeTransmitCallback.bind(this))\r\n        eventMgr.on(EventType.ENTITY_CORN_CUT, this.cornCutCallback.bind(this))\r\n        eventMgr.on(EventType.ENTITY_ENEMY_TRANSMIT, this.enemyTransmitCallback.bind(this))\r\n        eventMgr.on(EventType.ENTITY_ENEMY_DIE, this.enemyDieCallback.bind(this))\r\n        eventMgr.on(EventType.ENTITY_ENEMY_HAND_OVER, this.enemyHandOverCallback.bind(this))\r\n        eventMgr.on(EventType.ENTITY_CORNHAND_OVER_ADD, this.enemyHandeOverAdd.bind(this))\r\n        eventMgr.on(EventType.ENTITY_CORN_COMPLATE, this.enemyHandOverComplate.bind(this))\r\n        eventMgr.on(EventType.ENTITY_CLICK_ENEMY, this.clickEnemyAttack.bind(this))\r\n        eventMgr.on(EventType.ENTITY_SHOW_TREEHANDE, this.showTreeHande.bind(this))\r\n        eventMgr.on(EventType.ENTITY_ALL_DIE, this.allDieCallback.bind(this))\r\n        eventMgr.on(EventType.SHOW_ENEMY, this.showCallBack.bind(this));\r\n        eventMgr.on(EventType.GAME_OVER, this.gameOver.bind(this));\r\n        eventMgr.on(EventType.ENTITY_HAND_OVER_NO, this.handoverNo.bind(this));\r\n\r\n\r\n    }\r\n    handoverNo() {\r\n\r\n        this.treeParentNode.children.forEach((item) => {\r\n            if (item.active) {\r\n                let enemy = item.getComponent(EnemyTree)\r\n                if (enemy.animationNum < 4) {\r\n                    item.getComponent(EnemyTree).setFindState(true);\r\n                    console.log(\"enemy.animationNum enemy.animationNum \", enemy.animationNum);\r\n                    item.getChildByName(\"UI_famuzhiyin\").getComponent(BubbleFead).Show1(enemy.curCollectNum);\r\n                }\r\n\r\n            }\r\n        })\r\n    }\r\n    showCallBack() {\r\n        let houseMaterial = this.GroundEffect.enemyLandHouse.getChildByName(\"shengjiqian\").getChildByName(\"posun\").getComponent(MeshRenderer);\r\n\r\n\r\n        tween(houseMaterial.node)\r\n            // 定义要重复的动作序列：切换材质→等待→切回材质→等待\r\n            .sequence(\r\n                // 切换到目标材质\r\n                tween().call(() => {\r\n                    houseMaterial.material = this.meterialHouseChange;\r\n                }),\r\n                // 等待 0.2 秒\r\n                tween().delay(0.2),\r\n                // 切回原材质\r\n                tween().call(() => {\r\n                    houseMaterial.material = this.materialHouseBase;\r\n                }),\r\n                // 等待 0.2 秒（与切换时间对称）\r\n                tween().delay(0.2)\r\n            )\r\n            // 重复整个序列 3 次\r\n            .repeat(5)\r\n            // 启动 tween\r\n            .start();\r\n        //houseMaterial.material = this.meterialHouseChange;\r\n        if (!this.enemyParent.active) {\r\n            this.enemyParent.active = true;\r\n            //  this.scheduleOnce(()=>{\r\n\r\n            //  },1.2)\r\n\r\n        }\r\n\r\n    }\r\n    private isAniTrue: boolean = false;\r\n    gameOver() {\r\n        this.scheduleOnce(() => {\r\n            Global.isClickUpgrade = true;\r\n            let red = this.upgradeNodep1.getChildByName(\"2dNode\").getChildByName(\"scaleNode\").getChildByName(\"Sprite-red\")\r\n            red.active = false;\r\n            if (Global.upgradeUIAnimtion != 3) {\r\n                Global.upgradeUIAnimtion = 3;\r\n            }\r\n            Global.soundManager.playShatterSound();\r\n            let ani = this.upgradeNodep1.getChildByName(\"TX_posun\")\r\n            ani.active = true;\r\n            if (!this.isAniTrue) {\r\n                this.isAniTrue = true;\r\n                ani.getComponent(Animation).play();\r\n                ani.getComponent(Animation).once(Animation.EventType.FINISHED, () => {\r\n\r\n                    this.upgradeNodep1.getChildByName(\"UI_ZYXS\").active = true;\r\n                })\r\n            }\r\n\r\n\r\n\r\n        }, 1)\r\n\r\n\r\n\r\n    }\r\n    allDieCallback() {\r\n        playerController.allCharacterHanover();\r\n\r\n    }\r\n    ///////////////////////////////////第一个地块的操作\r\n    //移动到目标点树\r\n    moveTreeCallBack(target: Entity, behaviourType: BehaviourType) {\r\n        playerController.squenceMove(target, behaviourType)\r\n    }\r\n    //移动到树交付的目标点\r\n    moveHandOver(target: Node, behaviourType: BehaviourType) {\r\n        playerController.squenceHandOver(target, behaviourType)\r\n    }\r\n    showTreeHande() {\r\n        this.upgradeNodep.getChildByName(\"UI_ZYXS\").active = true;\r\n    }\r\n    //交付木材 每次交付回调设置显示进度\r\n    updateHandOverProgress() {\r\n        let sp: Sprite = this.greenScript.getComponent(Sprite)\r\n\r\n        let curNum: Label = sp.node.getParent().getChildByName(\"Label\").getComponent(Label);\r\n        let maxNum: Label = sp.node.getParent().getChildByName(\"Label-001\").getComponent(Label);\r\n        // 确保数值在有效范围内\r\n        const current = Math.max(0, Math.min(Global.treeHandOverNum, Global.treeHandOverNumLimit));\r\n        const max = Math.max(1, Global.treeHandOverNumLimit); // 防止除零错误\r\n\r\n        curNum.string = current.toString();\r\n        maxNum.string = \"/\" + max.toString();\r\n        // if(Number(curNum) >= Number(maxNum)){\r\n        //     this.upgradeNodep.getChildByName(\"UI_ZYXS\").active = true;\r\n        // }\r\n\r\n        // 计算百分比 (0-1范围)\r\n        const percentage = current / max;\r\n\r\n        // 更新进度条\r\n        sp.fillRange = percentage;\r\n\r\n        // 可选：显示进度文本\r\n        console.log(`交付进度: ${Math.round(percentage * 100)}% (${current}/${max})`);\r\n    }\r\n    //  交付 数量达到成绩的处理 升级处理\r\n    treeUpgradeComplate() {\r\n        this.upgradeNodep.active = false;\r\n        this.treeParentNode.children.forEach((item) => {\r\n            if (item.active) {\r\n                item.getChildByName(\"UI_famuzhiyin\").active = false\r\n            }\r\n        })\r\n        this.GroundEffect.upgradeTreeHouseAnimation(() => {\r\n            this.GroundEffect.passAnimation1();\r\n            this.scheduleOnce(() => {\r\n                this.treeArrow.active = true;\r\n            }, 2.4)\r\n        })\r\n\r\n    }\r\n    //点击引导按钮人物移动到下一个场景\r\n    treeTransmitCallback(selfNode: Node) {\r\n        this.treeParentNode.children.forEach((item) => {\r\n            item.getChildByName(\"UI_famuzhiyin\").active = false;\r\n        })\r\n        this.GroundEffect.ArrowgroundObject2_1.active = true;\r\n        this.GroundEffect.ArrowgroundObject2_2.active = true;\r\n        this.GroundEffect.ArrowgroundObject2_3.active = true;\r\n        this.GroundEffect.ArrowgroundObject2_4.active = true;\r\n        Global.isClickUpLandTree = false\r\n        this.GroundEffect.passAnimation11();\r\n        this.treeArrow.active = false;\r\n        playerController.resetBehaviour();\r\n        playerController.moveCornPos();\r\n\r\n    }\r\n    //////////////////////////////////////第二个地块的操作\r\n    // 点击玉米地块开始收割玉米\r\n    cornCutCallback(selfNode: Node) {\r\n\r\n        for (let i = 1; i < Global.clickCornLand.length; i++) {\r\n            if (Global.clickCornLand[i] == 0) {\r\n                this.GroundEffect[\"ArrowgroundObject2_\" + i].getChildByName(\"UI_ZYXS\").active = true;\r\n                break;\r\n            }\r\n        }\r\n        // this.GroundEffect.ArrowgroundObject2_2.active = true;\r\n        // this.GroundEffect.ArrowgroundObject2_3.active = true;\r\n        // this.GroundEffect.ArrowgroundObject2_4.active = true;\r\n        playerController.cutCornController(selfNode, this.GroundEffect)\r\n    }\r\n    // 玉米收割完 点击 传送按钮  摄像机操作 人物进入有怪物的地块\r\n    enemyTransmitCallback(selfNode: Node) {\r\n        this.upgradeNodep1.active = true;\r\n        Global.upgradeAnimationgPlayTyep = 2;\r\n        Global.upgradeUIAnimtion = 1;\r\n        Global.isStartMoveEnemyLand = true;\r\n        Global.isClickUpLandCorn = false;\r\n        playerController.resetBehaviour();\r\n        this.schedule(() => {\r\n            this.GroundEffect.hideCornArrow();\r\n        }, 3)\r\n        this.GroundEffect.passAnimation21();\r\n        //直接寻找敌人之后攻击的操作 后续有需要解开注释\r\n        //playerController.moveFindEnemyPos(this.enemyParent);\r\n        //找到自己的占位点\r\n        playerController.moveFindEnemyLandPos(this.enemyParent)\r\n    }\r\n    //点击攻击敌人\r\n    clickEnemyAttack(arrowEnemynode: Node) {\r\n        console.log(\"点击攻击敌人\")\r\n        let enemy = arrowEnemynode.getComponent(enemyCharacter)\r\n        let target = enemy.target\r\n        playerController.attackEnemy(target, enemy)\r\n\r\n    }\r\n    //敌人死亡事件回调 \r\n    enemyDieCallback(cahracter: EnemyTree) {\r\n        this.upgradeNodep1.active = true;\r\n\r\n        // this.scheduleOnce(() => {\r\n        //     Global.isClickUpgrade = true;\r\n        // }, 0.5)\r\n\r\n        Global.warnUI.stopWarnFadeAnimation();\r\n\r\n        Global.isClickUpLandTree = true;\r\n        Global.isClickEnemy = true;\r\n        this.GroundEffect.showAllTreeClick();\r\n        Global.isEnemyCutTree = true;\r\n    }\r\n    //怪物死亡点击交付\r\n    enemyHandOverCallback() {\r\n        playerController.moveFindEnemHandOver()\r\n    }\r\n    //点击交付进度增长\r\n    enemyHandeOverAdd() {\r\n        let sp: Sprite = this.greenScript_1.getComponent(Sprite)\r\n        // 确保数值在有效范围内\r\n        let curNum: Label = sp.node.getParent().getChildByName(\"Label\").getComponent(Label);\r\n        let maxNum: Label = sp.node.getParent().getChildByName(\"Label-001\").getComponent(Label);\r\n        // 确保数值在有效范围内\r\n        const current = Math.max(0, Math.min(Global.cornHandOverNum, Global.cornHandOverNumLimit));\r\n        const max = Math.max(1, Global.cornHandOverNumLimit); // 防止除零错误\r\n\r\n        curNum.string = current.toString();\r\n        maxNum.string = \"/\" + max.toString();\r\n        // 计算百分比 (0-1范围)\r\n        const percentage = current / max;\r\n\r\n        // 更新进度条\r\n        sp.fillRange = percentage;\r\n\r\n        // 可选：显示进度文本\r\n        console.log(`交付进度: ${Math.round(percentage * 100)}% (${current}/${max})`);\r\n\r\n    }\r\n    //交付完成\r\n    enemyHandOverComplate(character: Entity) {\r\n        if (!this.isComplate) {\r\n            this.isComplate = true;\r\n            this.scheduleOnce(() => {\r\n                this.upgradeNodep1.active = false;\r\n            }, 0.1)\r\n            this.scheduleOnce(() => {\r\n                this.GroundEffect.upgradeEnemyHouseAnimation(() => {\r\n                    playerController.GameHandOverComplate();\r\n                    this.scheduleOnce(() => {\r\n                        this.GroundEffect.passAnimation3();\r\n                        this.gameEndUI.active = true\r\n                    }, 1)\r\n                })\r\n            }, 0.12)\r\n\r\n        }\r\n        console.log(\"CornHandOverComplate\")\r\n    }\r\n    update(deltaTime: number) {\r\n\r\n        if (Global.clickNum == 5 && !this.isShowUpgradeNodep) {\r\n            if (!this.upgradeNodep.active) {\r\n                this.upgradeNodep.active = true;\r\n                this.isShowUpgradeNodep = true;\r\n                Global.upgradeUIAnimtion = 1;\r\n            }\r\n        }\r\n        if (Global.upgradeAnimationgPlayTyep == 1) {\r\n            this.changeAnimation = this.upgradeUIAnmationTree\r\n            Global.upgradeAnimationgPlayTyep = 0\r\n        } else if (Global.upgradeAnimationgPlayTyep == 2) {\r\n            this.changeAnimation = this.upgradeUIAnmationEnemy\r\n            Global.upgradeAnimationgPlayTyep = 0;\r\n\r\n        }\r\n        if (this.upgradeNodep.active || this.upgradeNodep1.active) {\r\n            if (Global.upgradeUIAnimtion == 1) {\r\n                // const anim = this.upgradeNodep.getComponent(Animation);\r\n                this.changeAnimation.stop()\r\n                Global.upgradeUIAnimtion = 2;\r\n                const animState = this.changeAnimation.getState('SJZY');\r\n                if (!animState || animState.isPlaying) {\r\n                    return;\r\n                }\r\n                this.changeAnimation.play('SJZY');\r\n            } else if (Global.upgradeUIAnimtion == 3) {\r\n\r\n                Global.upgradeUIAnimtion = 4;\r\n                // const anim = this.upgradeNodep.getComponent(Animation);\r\n                this.changeAnimation.stop()\r\n\r\n                const animState = this.changeAnimation.getState('WoodTDAni');\r\n                animState.speed = 2;\r\n                if (!animState || animState.isPlaying) {\r\n                    return;\r\n                }\r\n                this.changeAnimation.play('WoodTDAni');\r\n            } else if (Global.upgradeUIAnimtion == 5 || Global.upgradeUIAnimtion == 0) {\r\n                //  const anim = this.upgradeNodep.getComponent(Animation);\r\n                this.changeAnimation.stop()\r\n                const animState = this.changeAnimation.getState('WoodTDAni');\r\n                animState.speed = 1;\r\n                this.changeAnimation.play('WoodTDAni');\r\n                Global.upgradeUIAnimtion = -1;\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}