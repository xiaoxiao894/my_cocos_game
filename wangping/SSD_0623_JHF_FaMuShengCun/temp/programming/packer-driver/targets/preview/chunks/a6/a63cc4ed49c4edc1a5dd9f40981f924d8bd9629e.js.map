{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_0623_JHF_FaMuShengCun/assets/JavaScript/Actor/Actor.ts"],"names":["_decorator","Animation","AnimationClip","CCFloat","Collider","Color","Component","find","Label","math","Node","RigidBody","SkeletalAnimation","Sprite","Texture2D","tween","UIRenderer","v3","Vec3","StateDefine","MathUtil","DataManager","FunTypeEnum","PlotEnum","TypeItemEnum","GridPathController","SoundManager","ItemElectricTowerManager","ccclass","property","tempVelocity","Actor","destForward","collider","rigidbody","currentState","Idle","uiproperty","onceData","isWeaponArea","isDeliveryProgress","areaEffectNode","_plots","stackOffsetY","_isEnterArea","_deliverCooldown","_lastDeliverTime","_activeTransferringItems","Set","_curPlots","_reservedLabelMap","Map","start","node","getComponent","getChildByName","on","onTriggerEnter","onTriggerStay","onTriggerExit","update","deltaTime","Die","a","signAngle","forward","UP","as","setAngularVelocity","doMove","instance","updatePath","worldPosition","clone","speed","linearSpeed","length","x","clamp","z","setLinearVelocity","stopMove","ZERO","changState","state","clipName","aniState","skeletalAnimation","getState","Attack","crossFade","isPlaying","play","Walk","Walk_attack","wrapMode","WrapMode","Loop","event","resetLandDiscoloration","otherCollider","push","name","Plot7","Instance","isGetCoins","arrowTargetNode","_unlockHelper","landDiscoloration","_handleExecution","plotIndex","findIndex","item","splice","isEnterPromptArea","landmark","scheduleOnce","stopBreathingAni","guideTarget","guideTargetList","isDisplay","plot","rule","rules","colliderName","placing","funType","typeItem","isChangValue","playerNode","backpack1","backpack2","backpack3","backpacks","filter","Boolean","targetPath","targetCon","obj","isPlot1ArrangePos","Plot1","isPlot7ArrangePos","Deliver","sourceBackpack","_findBackpackWithItem","startDelivery","Collect","targetBackpack","_findEmptyBackpack","collectAni","bag","children","some","child","includes","from","to","now","performance","playBezierTransfer","mode","reserveValueIfPossible","stackManager","fromStackManager","slots","getAllOccupiedSlots","i","slot","assignedNode","isValid","releaseSlot","inst","playAudio","add","startPos","getWorldPosition","parent","setWorldPosition","endPos","assignSlot","delete","getSlotWorldPos","_getStackTopWorldPos","curvePeakY","Math","max","y","curvePeakYOffset","abs","controlPoint","landmarkAni","tParam","t","distance","runTime","exp","min","onUpdate","oneMinusT","current","onComplete","Wood","eulerAngles","onlyGuidanceOnce","mainCamera","woodGuidance","UIPropertyManager","collectProperty","rigidBody","enabled","scale","easing","finalWorldPos","setParent","localPos","inverseTransformPoint","setPosition","finalPos","changeValueFun","deliverProperty","label","progress","data","labelStr","string","coinNum","progressSprite","fillRange","initCoinNum","removeFromParent","destroy","newVal","finalizeReservedValue","otherColliderNode","Plot8","isUnlockHelper","cancelPhysics","shrinkHideLandmark","active","unlockHelper","unlockPlot3AndPlot9","setGuideDisplay","playLevelUpOnce","Plot3","Plot9","plotLevelUpEffect","activateElementCon","dtNode","curReduceTemplateTimeIndex","unlockPowerTowersNum","unlockTriggerConditions","enablePhysics","itemElectricTowerManager","isNew","plot4","lm","popShowLandmark","Plot4","plot2","Plot2","Plot5","boardManager","denominatorUpgradeAni","thirdShow","powerPlant","plantAni","fire","fireAni","fireState","unlock","str","elementCon","dtani","dtaniAni","shengji","electricTowerAttackRange","overGuide","isGameEnd","gameEndManager","init","Plot6","conveyorAni","loggingState","logging","conveyorLevel","isConveyerBeltUpgrade","workflow","beltNode","workflowAni","done","call","enterPrompt","it","parentPlot","onDtReady","setScale","wireCon","dianxian","dianxianAni","once","EventType","FINISHED","dt","col","rb","host","childName","fx","ani","guideDisplay","unlockPlot5OrPlot6","plots","plotName","bulletAttackTimeInterval","sceneManager","towerAttackInterval","monsterNum","bornTimeLimit","coinAni","clip","clips","c","createState","time","sample","stop","plotBoxCollider","plotRightbody","levelUpNode","rightBody","partner","partnerConManager","create","worldPos","partnerCon","landmarkNode","amount","labelNode","labelCom","key","currentVal","Number","reserved","get","set","container","offsetY","base","maxY","dashedBoxParent","renderer","color","dashedBox","resetPlotPromptAni","list","plotNode"],"mappings":"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","sourcesContent":["import { _decorator, absMaxComponent, animation, Animation, AnimationClip, AnimationState, AsyncDelegate, BoxCollider, builtinResMgr, CCFloat, Collider, Color, Component, director, DynamicAtlasManager, EffectAsset, find, gfx, ICollisionEvent, instantiate, Label, Mat4, Material, math, MeshRenderer, Node, resources, RigidBody, SkeletalAnimation, Slider, Sprite, Texture2D, tween, UIOpacity, UIRenderer, v3, Vec3, Vec4, warnID } from 'cc';\r\nimport { MinionStateEnum, StateDefine } from './StateDefine';\r\nimport { MathUtil } from '../Util/MathUtil';\r\nimport { DataManager } from '../Global/DataManager';\r\nimport { AreaEnum, CollisionEntityEnum, EntityTypeEnum, FunTypeEnum, GamePlayNameEnum, PathEnum, PlotEnum, TypeItemEnum } from '../Enum/Index';\r\nimport { UIPropertyManager } from '../UI/UIPropertyManager';\r\nimport RVOObstacles from '../Global/RVOObstacles';\r\nimport { Simulator } from '../RVO/Simulator';\r\nimport { StackManager } from '../StackSlot/StackManager';\r\nimport GridPathController from './GridPathController';\r\nimport { SoundManager } from '../Common/SoundManager';\r\nimport { ItemElectricTowerManager } from '../ElectricTower/ItemElectricTowerManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet tempVelocity: Vec3 = v3();\r\n\r\n@ccclass('Actor')\r\nexport class Actor extends Component {\r\n    @property(SkeletalAnimation)\r\n    skeletalAnimation: SkeletalAnimation | null = null;\r\n\r\n    @property(CCFloat)\r\n    linearSpeed: number = 1.0;\r\n\r\n    @property(CCFloat)\r\n    angularSpeed: number = 90;\r\n\r\n    @property(Node)\r\n    partnerCon: Node = null;\r\n\r\n    @property(Texture2D)\r\n    texture: Texture2D = null;\r\n\r\n    // 升级动画\r\n    @property(Node)\r\n    powerPlant: Node = null;\r\n\r\n    @property(SkeletalAnimation)\r\n    conveyorAni: SkeletalAnimation = null;\r\n\r\n    @property(Animation)\r\n    logging: Animation = null;\r\n\r\n    destForward: Vec3 = v3();\r\n\r\n    collider: Collider | null = null;\r\n    rigidbody: RigidBody | null = null;\r\n\r\n    currentState: StateDefine | string = StateDefine.Idle;\r\n    uiproperty = null;\r\n    onceData = true;\r\n    // 是否在获取兵器的区域\r\n    isWeaponArea = false;\r\n\r\n    // 是否正在交付\r\n    private isDeliveryProgress = false;\r\n\r\n    private areaEffectNode = null;\r\n\r\n    private _plots = [\"Plot0\", \"Plot9\", \"Plot3\", \"Plot2\", \"Plot4\"]\r\n\r\n    start() {\r\n        this.rigidbody = this.node.getComponent(RigidBody);\r\n        this.collider = this.node.getComponent(Collider);\r\n\r\n        this.uiproperty = this.node.getChildByName(\"UIproperty\");\r\n\r\n        this.collider?.on(\"onTriggerEnter\", this.onTriggerEnter, this);\r\n        this.collider?.on(\"onTriggerStay\", this.onTriggerStay, this);\r\n        this.collider?.on(\"onTriggerExit\", this.onTriggerExit, this);\r\n\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this.currentState == StateDefine.Die) {\r\n            return;\r\n        }\r\n\r\n        // 始终执行朝向调整\r\n        let a = MathUtil.signAngle(this.node.forward, this.destForward, Vec3.UP);\r\n        let as = v3(0, a * 20, 0);\r\n        this.rigidbody.setAngularVelocity(as);\r\n\r\n        //  改成无条件执行移动（不依赖状态）\r\n        this.doMove();\r\n\r\n        //记录网格坐标\r\n        GridPathController.instance.updatePath(this.node.worldPosition.clone());\r\n    }\r\n\r\n    doMove() {\r\n        let speed = this.linearSpeed * this.destForward.length() * 15;\r\n        tempVelocity.x = math.clamp(this.node.forward.x, -1, 1) * speed;\r\n        tempVelocity.z = math.clamp(this.node.forward.z, -1, 1) * speed;\r\n        this.rigidbody?.setLinearVelocity(tempVelocity);\r\n    }\r\n\r\n    stopMove() {\r\n        this.rigidbody?.setLinearVelocity(Vec3.ZERO);\r\n    }\r\n\r\n    changState(state: StateDefine | string) {\r\n        const clipName = state as string;\r\n\r\n        // 获取目标动画状态\r\n        const aniState = this.skeletalAnimation?.getState(clipName);\r\n\r\n        // 如果是攻击状态，允许重复切换（防止攻击无法连击）\r\n        if (state === StateDefine.Attack) {\r\n            this.skeletalAnimation?.crossFade(clipName, 0.1);\r\n            this.currentState = state;\r\n            return;\r\n        }\r\n\r\n        // 允许 Walk/WALK_ATTACK 状态重复切换播放动画\r\n        if (state === this.currentState) {\r\n            if (aniState && !aniState.isPlaying) {\r\n                this.skeletalAnimation?.play(clipName);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // 若切换自 Walk 类状态，停止移动\r\n        if (\r\n            this.currentState === StateDefine.Walk ||\r\n            this.currentState === StateDefine.Walk_attack\r\n        ) {\r\n            this.stopMove();\r\n        }\r\n\r\n        if (aniState) {\r\n            aniState.wrapMode = AnimationClip.WrapMode.Loop; // 防止播放完卡住\r\n            this.skeletalAnimation?.crossFade(clipName, 0.1);\r\n        } else {\r\n            // console.warn(`未找到动画状态：${clipName}`);\r\n        }\r\n\r\n        this.currentState = state;\r\n    }\r\n\r\n    private stackOffsetY: number = 0.5;\r\n    private _isEnterArea = false;\r\n    private _deliverCooldown: number = 0.1;\r\n    private _lastDeliverTime = 0;\r\n    private _activeTransferringItems: Set<Node> = new Set();\r\n\r\n    private _curPlots = [];\r\n    // 进入\r\n    onTriggerEnter(event: ICollisionEvent) {\r\n        this.isDeliveryProgress = true;\r\n        this.resetLandDiscoloration();\r\n\r\n        const otherCollider = event.otherCollider;\r\n        // this._isEnterArea = true;\r\n\r\n        this._curPlots.push(otherCollider.node.name);\r\n\r\n        if (otherCollider && otherCollider.node.name == PlotEnum.Plot7) {\r\n            DataManager.Instance.isGetCoins = true;\r\n\r\n            DataManager.Instance.arrowTargetNode._unlockHelper = false;\r\n        }\r\n\r\n        // 地块颜色\r\n        this.landDiscoloration(otherCollider);\r\n    }\r\n\r\n    onTriggerStay(event: ICollisionEvent) {\r\n        // if (!this._isEnterArea) return;\r\n\r\n        const otherCollider = event.otherCollider;\r\n        this._handleExecution(otherCollider);\r\n    }\r\n\r\n    // 离开\r\n    onTriggerExit(event: ICollisionEvent) {\r\n        const otherCollider = event.otherCollider;\r\n        // this._isEnterArea = false;\r\n        this.isDeliveryProgress = false;\r\n\r\n        if (otherCollider && otherCollider.node.name == PlotEnum.Plot7) {\r\n            DataManager.Instance.isGetCoins = false;\r\n        }\r\n\r\n        const plotIndex = this._curPlots.findIndex(item => {\r\n            return item == otherCollider.node.name;\r\n        })\r\n\r\n        if (plotIndex >= 0) {\r\n            this._curPlots.splice(plotIndex, 1);\r\n        }\r\n\r\n        this.resetLandDiscoloration();\r\n        this.isEnterPromptArea(otherCollider);\r\n\r\n        const landmark = otherCollider.node.getChildByName(\"Landmark\");\r\n        if (landmark) {\r\n            this.scheduleOnce(() => {\r\n                this.stopBreathingAni(landmark);\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n    isEnterPromptArea(otherCollider) {\r\n        const guideTarget = DataManager.Instance.guideTargetList.find(item => {\r\n            return item.isDisplay;\r\n        })\r\n\r\n        if (guideTarget && guideTarget.plot == otherCollider.node.name) {\r\n            DataManager.Instance.isEnterPromptArea = true;\r\n        } else if (otherCollider.name == PlotEnum.Plot7) {\r\n            DataManager.Instance.isEnterPromptArea = true;\r\n        }\r\n    }\r\n\r\n    // 执行处理函数\r\n    private _handleExecution(otherCollider: any) {\r\n        const rule = DataManager.Instance.rules.find(item => item.colliderName == otherCollider.node.name);\r\n        if (!rule) return;\r\n\r\n        const { placing, funType, typeItem, isChangValue } = rule;\r\n\r\n        // 检查背包\r\n        const playerNode = this.node;\r\n        const backpack1 = playerNode.getChildByName(\"Backpack1\");\r\n        const backpack2 = playerNode.getChildByName(\"Backpack2\");\r\n        const backpack3 = playerNode.getChildByName(\"Backpack3\");\r\n\r\n        const backpacks: Node[] = [backpack1, backpack2, backpack3].filter(Boolean) as Node[];\r\n\r\n        const targetPath = `THREE3DNODE/PlacingCon/${placing}`;\r\n        const targetCon = find(targetPath);\r\n        if (!targetCon) {\r\n            // console.log(`未找到目标容器 PlacingcCon/${placing}`);\r\n            if (this.isDeliveryProgress == false) {\r\n                const landmark = otherCollider.node.getChildByName(\"Landmark\");\r\n\r\n                if (landmark) {\r\n                    this.stopBreathingAni(landmark);\r\n                    // this.labelStopBreathingAni(landmark);\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        const obj = {\r\n            isChangValue: isChangValue,\r\n            otherCollider: otherCollider,\r\n            isPlot1ArrangePos: PlotEnum.Plot1 == otherCollider.node.name ? true : false,\r\n            isPlot7ArrangePos: PlotEnum.Plot7 == otherCollider.node.name ? true : false,\r\n        }\r\n\r\n        if (funType == FunTypeEnum.Deliver) {               // 交付\r\n            let sourceBackpack = this._findBackpackWithItem(backpacks, typeItem);\r\n            if (sourceBackpack) {\r\n                this.startDelivery(sourceBackpack, targetCon, obj);\r\n            } else {\r\n                if (this.isDeliveryProgress == false) {\r\n                    const landmark = otherCollider.node.getChildByName(\"Landmark\");\r\n\r\n                    if (landmark) {\r\n                        this.scheduleOnce(() => {\r\n                            this.stopBreathingAni(landmark);\r\n                            // this.labelStopBreathingAni(landmark);\r\n                        }, 0.2)\r\n                    }\r\n                }\r\n                // console.warn(`未找到包含 ${typeItem} 的背包用于交付`);\r\n            }\r\n        } else if (funType == FunTypeEnum.Collect) {        // 收集\r\n            let targetBackpack = this._findBackpackWithItem(backpacks, typeItem);\r\n\r\n            if (!targetBackpack) {\r\n                targetBackpack = this._findEmptyBackpack(backpacks);\r\n            }\r\n\r\n            if (targetBackpack) {\r\n                this.collectAni(targetCon, targetBackpack, obj);\r\n            } else {\r\n                if (this.isDeliveryProgress == false) {\r\n                    const landmark = otherCollider.node.getChildByName(\"Landmark\");\r\n\r\n                    if (landmark) {\r\n                        this.stopBreathingAni(landmark);\r\n                        // this.labelStopBreathingAni(landmark);\r\n                    }\r\n                }\r\n                // console.warn(`未找到可收集的目标背包（含${typeItem}或为空）`);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 查找背包物品\r\n    private _findBackpackWithItem(backpacks: Node[], typeItem: string): Node | null {\r\n        for (const bag of backpacks) {\r\n            if (bag.children.some(child => child.name.includes(typeItem))) {\r\n                return bag;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // 查找空背包\r\n    private _findEmptyBackpack(backpacks: Node[]): Node | null {\r\n        return backpacks.find(bag => bag.children.length === 0) || null;\r\n    }\r\n\r\n    startDelivery(from: Node, to: Node, obj) {\r\n        const now = performance.now();\r\n\r\n        // if (now - this._lastDeliverTime < this._deliverCooldown * 1000) return;\r\n        this._lastDeliverTime = now;\r\n\r\n        this.playBezierTransfer(from, to, 'deliver', obj);\r\n    }\r\n\r\n    private collectAni(from: Node, to: Node, obj) {\r\n        this.playBezierTransfer(from, to, 'collect', obj);\r\n    }\r\n\r\n    // === 贝塞尔转移动画 ===\r\n    private _reservedLabelMap: Map<Node, number> = new Map();\r\n\r\n    private playBezierTransfer(from: Node, to: Node, mode: 'collect' | 'deliver', obj) {\r\n        if (!from || !to) return;\r\n\r\n        if (obj.isChangValue) {\r\n            const landmark = obj.otherCollider.node.getChildByName(\"Landmark\");\r\n            if (!landmark || !this.reserveValueIfPossible(landmark, 1)) {\r\n                // console.warn(\"资源不足，跳过交付\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        const children = from.children;\r\n        if (children.length === 0) return;\r\n\r\n        const stackManager: StackManager = obj.isPlot1ArrangePos ? to[\"__stackManager\"] : to[\"__stackManager\"]; // to始终用于目标堆叠\r\n        let item: Node | null = null;\r\n        // Plot5：从 from 的堆叠管理器中取顶部 item 并释放槽位\r\n        if (obj.isPlot7ArrangePos) {\r\n            const fromStackManager: StackManager = from[\"__stackManager\"];\r\n            if (!fromStackManager) {\r\n                // console.warn(\"from 没有 stackManager，无法取出\");\r\n                return;\r\n            }\r\n\r\n            const slots = fromStackManager.getAllOccupiedSlots?.() ?? [];\r\n            for (let i = slots.length - 1; i >= 0; i--) {\r\n                const slot = slots[i];\r\n                const node = slot.assignedNode;\r\n                if (node && node.isValid && node['__fallingTarget'] === true) {\r\n                    item = node;\r\n                    fromStackManager.releaseSlot(node);\r\n                    break;\r\n                }\r\n            }\r\n            if (!item) {\r\n                // console.warn(\"Plot5 没有可收集的 __isReady 物品\");\r\n                return;\r\n            }\r\n        } else {\r\n            for (let i = children.length - 1; i >= 0; i--) {\r\n                const child = children[i];\r\n                if (child['__isReady'] === true) {\r\n                    item = child;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!item?.isValid) return;\r\n        if (mode == \"deliver\" && item.name == \"Coin\") {\r\n            SoundManager.inst.playAudio(\"YX_jinbi_jiaofu\");\r\n        } else if (mode == \"deliver\" && item.name == \"Wood\") {\r\n            SoundManager.inst.playAudio(\"Sounds_jiaofu_mutou\");\r\n        }\r\n        this._activeTransferringItems.add(item);\r\n\r\n        const startPos = item.getWorldPosition();\r\n        item.parent = this.node;\r\n        item.setWorldPosition(startPos);\r\n\r\n        let endPos: Vec3 | null = null;\r\n\r\n        if (obj.isPlot1ArrangePos) {\r\n            const slot = stackManager.assignSlot(item);\r\n            if (!slot) {\r\n                this._activeTransferringItems.delete(item);\r\n                return;\r\n            }\r\n            endPos = stackManager.getSlotWorldPos(slot, to);\r\n        } else {\r\n            endPos = this._getStackTopWorldPos(to, this.stackOffsetY);\r\n        }\r\n\r\n        const curvePeakY = Math.max(startPos.y, endPos.y) + 8;\r\n        const curvePeakYOffset = Math.abs(startPos.y - endPos.y);\r\n        let controlPoint\r\n        if (curvePeakYOffset <= 2 && mode == \"deliver\" && item.name == \"Coin\") {\r\n            controlPoint = new Vec3(\r\n                (startPos.x + endPos.x) / 2,\r\n                curvePeakY,\r\n                (startPos.z + endPos.z) / 2 + 2\r\n            );\r\n        } else {\r\n            controlPoint = new Vec3(\r\n                (startPos.x + endPos.x) / 2,\r\n                curvePeakY,\r\n                (startPos.z + endPos.z) / 2\r\n            );\r\n        }\r\n\r\n        if (this.isDeliveryProgress && obj.isChangValue) {\r\n            this.isDeliveryProgress = false;\r\n            const landmark = obj.otherCollider.node.getChildByName(\"Landmark\");\r\n            const landmarkAni = landmark.getComponent(Animation);\r\n            if (landmarkAni) {\r\n                landmarkAni.play(\"UI_jiaofu\");\r\n            }\r\n        }\r\n\r\n        const tParam = { t: 0 };\r\n\r\n        let distance = Math.abs(startPos.y - endPos.y);\r\n        // 使用指数衰减函数，提升高处下落速度\r\n        let runTime = 1.2 * (1 - Math.exp(-distance / 50));\r\n        // 限定时间边界\r\n        runTime = Math.min(Math.max(runTime, 0.3), 1.0);\r\n        tween(tParam)\r\n            .to(runTime, { t: 1 }, {\r\n                onUpdate: () => {\r\n                    const t = tParam.t;\r\n                    const oneMinusT = 1 - t;\r\n\r\n                    // 计算贝塞尔曲线位置\r\n                    const current = new Vec3(\r\n                        oneMinusT * oneMinusT * startPos.x + 2 * oneMinusT * t * controlPoint.x + t * t * endPos.x,\r\n                        oneMinusT * oneMinusT * startPos.y + 2 * oneMinusT * t * controlPoint.y + t * t * endPos.y,\r\n                        oneMinusT * oneMinusT * startPos.z + 2 * oneMinusT * t * controlPoint.z + t * t * endPos.z\r\n                    );\r\n\r\n                    item.setWorldPosition(current);\r\n                },\r\n                onComplete: () => {\r\n                    if (item.name == TypeItemEnum.Wood) {\r\n                        item.eulerAngles = new Vec3(-90, 0, 0);\r\n\r\n                        if (DataManager.Instance.onlyGuidanceOnce) {\r\n                            DataManager.Instance.onlyGuidanceOnce = false;\r\n                            DataManager.Instance.mainCamera.woodGuidance();\r\n                        }\r\n                    } else {\r\n                        item.eulerAngles = new Vec3(0, 0, 0);\r\n                    }\r\n\r\n                    if (obj.isPlot7ArrangePos) {\r\n                        if (DataManager.Instance.UIPropertyManager) {\r\n                            DataManager.Instance.UIPropertyManager.collectProperty();\r\n                            SoundManager.inst.playAudio(\"YX_jinbi_shiqu\");\r\n                        }\r\n                    }\r\n\r\n                    // 物理组件禁用\r\n                    const rigidBody = item.getComponent(RigidBody);\r\n                    if (rigidBody) {\r\n                        rigidBody.enabled = false;\r\n                    }\r\n\r\n                    // 禁用碰撞器\r\n                    const collider = item.getComponent(Collider);\r\n                    if (collider) {\r\n                        collider.enabled = false;\r\n                    }\r\n\r\n                    tween(item)\r\n                        .to(0.15, { scale: new Vec3(1.2, 1.2, 1.2) }, { easing: 'quadOut' })\r\n                        .to(0.05, { scale: new Vec3(1, 1, 1) }, { easing: 'quadOut' })\r\n                        .start();\r\n\r\n\r\n                    // 处理物体的位置\r\n                    if (obj.isPlot1ArrangePos) {\r\n                        const finalWorldPos = endPos;\r\n                        item.setWorldPosition(finalWorldPos);\r\n                        item.setParent(to);\r\n\r\n                        const localPos = new Vec3();\r\n                        to.inverseTransformPoint(localPos, finalWorldPos);\r\n                        item.setPosition(localPos);\r\n                    } else {\r\n                        let finalPos = null;\r\n                        if (item.name == \"Coin\") {\r\n                            finalPos = this._getStackTopWorldPos(to, 0.3);\r\n                        } else {\r\n                            finalPos = this._getStackTopWorldPos(to, this.stackOffsetY);\r\n                        }\r\n                        item.setWorldPosition(finalPos);\r\n                        item.setParent(to);\r\n\r\n                        const localPos = new Vec3();\r\n                        to.inverseTransformPoint(localPos, finalPos);\r\n                        item.setPosition(localPos);\r\n                    }\r\n                    this._activeTransferringItems.delete(item);\r\n\r\n                    if (obj.isChangValue) {\r\n                        this.changeValueFun(item, obj)\r\n\r\n                        if (mode == \"deliver\") {\r\n                            DataManager.Instance.UIPropertyManager.deliverProperty();\r\n\r\n                            const landmark = obj.otherCollider.node.getChildByName(\"Landmark\");\r\n                            const label = landmark.getChildByName(\"Label\");\r\n                            const progress = landmark.getChildByName(\"jindu\");\r\n                            const data = DataManager.Instance.guideTargetList.find(item => {\r\n                                return item.plot == obj.otherCollider.node.name;\r\n                            })\r\n\r\n                            if (data) {\r\n                                const labelStr = label.getComponent(Label).string;\r\n                                data.coinNum = labelStr;\r\n\r\n                                const progressSprite = progress.getComponent(Sprite)\r\n                                if (progressSprite) {\r\n                                    progressSprite.fillRange = (data.initCoinNum - data.coinNum) / data.initCoinNum\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n            .start();\r\n    }\r\n\r\n    /**\r\n     * plot2, 3, 4， 9\r\n     * \r\n     * plot5 升级\r\n     * \r\n     * plot6 传送\r\n     */\r\n\r\n    changeValueFun(item, obj) {\r\n        item.removeFromParent();\r\n        item.destroy();\r\n        // DataManager.Instance.coinManager.onProjectileDead(item);\r\n\r\n        // ================== 主处理 ==================\r\n        const landmark = obj.otherCollider.node.getChildByName(\"Landmark\");\r\n        if (!landmark) return;\r\n\r\n        const newVal = this.finalizeReservedValue(landmark, 1);\r\n        if (newVal === 0 && this.isDeliveryProgress === false) {\r\n            this.stopBreathingAni(landmark);\r\n        }\r\n\r\n        const otherColliderNode = obj.otherCollider.node;\r\n        if (newVal !== 0) return; // 只有清零才触发后续逻辑\r\n\r\n        switch (otherColliderNode.name) {\r\n            case PlotEnum.Plot8: {\r\n                // 解锁人物 + 解锁电塔两个地块 + 弹提示/特效\r\n                DataManager.Instance.isUnlockHelper = true;\r\n                this.cancelPhysics(otherColliderNode);\r\n                this.shrinkHideLandmark(landmark, () => {\r\n                    landmark.active = false;\r\n                    this.unlockHelper(obj);\r\n                    this.unlockPlot3AndPlot9();\r\n                    this.setGuideDisplay(PlotEnum.Plot8, false, true);\r\n                    this.playLevelUpOnce(otherColliderNode, \"TX_shengjiLZ\");\r\n                });\r\n                break;\r\n            }\r\n\r\n            case PlotEnum.Plot3:\r\n            case PlotEnum.Plot9: {\r\n                this.cancelPhysics(otherColliderNode);\r\n                this.shrinkHideLandmark(landmark, () => {\r\n                    this.scheduleOnce(() => this.plotLevelUpEffect(otherColliderNode), 0.2);\r\n                    this.setGuideDisplay(otherColliderNode.name, false, true);\r\n                    landmark.active = false;\r\n\r\n                    this.activateElementCon(otherColliderNode, (dtNode: Node) => {\r\n                        // 完成电线动画与DT弹起后，更新状态/解锁逻辑（两者一致）\r\n                        DataManager.Instance.curReduceTemplateTimeIndex++;\r\n                        DataManager.Instance.unlockPowerTowersNum++;\r\n                        this.unlockTriggerConditions();\r\n                        this.enablePhysics(dtNode);\r\n\r\n                        const itemElectricTowerManager = dtNode?.parent?.parent.getComponent(ItemElectricTowerManager);\r\n                        if (itemElectricTowerManager) {\r\n                            itemElectricTowerManager.isNew = true;\r\n                        }\r\n\r\n                        if (otherColliderNode.name === PlotEnum.Plot3) {\r\n                            // 激活Plot4并出现Landmark引导\r\n                            const plot4 = find(\"THREE3DNODE/Unlock/Plot4\");\r\n                            if (plot4) {\r\n                                plot4.active = true;\r\n                                const lm = plot4.getChildByName(\"Landmark\");\r\n                                this.popShowLandmark(lm, PlotEnum.Plot4, true);\r\n                            }\r\n                        } else {\r\n                            // name === PlotEnum.Plot9，激活Plot2并开物理+Landmark引导\r\n                            const plot2 = find(\"THREE3DNODE/Unlock/Plot2\");\r\n                            if (plot2) {\r\n                                plot2.active = true;\r\n                                this.enablePhysics(plot2);\r\n                                const lm = plot2.getChildByName(\"Landmark\");\r\n                                this.popShowLandmark(lm, PlotEnum.Plot2, true);\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n                break;\r\n            }\r\n\r\n            case PlotEnum.Plot4:\r\n            case PlotEnum.Plot2: {\r\n                this.cancelPhysics(otherColliderNode);\r\n                this.shrinkHideLandmark(landmark, () => {\r\n                    this.scheduleOnce(() => this.plotLevelUpEffect(otherColliderNode), 0.2);\r\n                    this.setGuideDisplay(otherColliderNode.name, false, true);\r\n                    landmark.active = false;\r\n\r\n                    this.activateElementCon(otherColliderNode, (dtNode: Node) => {\r\n                        this.enablePhysics(dtNode);\r\n                        const itemElectricTowerManager = dtNode?.parent?.parent.getComponent(ItemElectricTowerManager);\r\n                        if (itemElectricTowerManager) {\r\n                            itemElectricTowerManager.isNew = true;\r\n                        }\r\n\r\n                        DataManager.Instance.curReduceTemplateTimeIndex++;\r\n                        DataManager.Instance.unlockPowerTowersNum++;\r\n                        this.unlockTriggerConditions();\r\n                    });\r\n                });\r\n                break;\r\n            }\r\n\r\n            case PlotEnum.Plot5: {\r\n                // 升级建筑\r\n                this.shrinkHideLandmark(landmark, () => {\r\n                    this.setGuideDisplay(PlotEnum.Plot5, false, true);\r\n                    landmark.active = false;\r\n\r\n                    DataManager.Instance.boardManager.denominatorUpgradeAni(30, 80, 0.03);\r\n\r\n                    // 三阶段展示 + 动画\r\n                    const thirdShow: Node = this.powerPlant.getChildByName(\"thirdShow\");\r\n                    if (thirdShow) thirdShow.active = true;\r\n\r\n                    const plantAni = this.powerPlant.getComponent(Animation);\r\n                    plantAni?.play(\"shengji02\");\r\n\r\n                    // 火焰动画与升级特效\r\n                    const fire = this.powerPlant.getChildByName(\"TX_huoyan-001\");\r\n                    if (fire) {\r\n                        fire.active = true;\r\n                        const fireAni = fire.getComponent(Animation);\r\n                        const fireState = fireAni?.getState(\"TX_huoyan\");\r\n                        if (fireState) {\r\n                            fireState.speed = 0.35;\r\n                            fireState.play();\r\n                        }\r\n                    }\r\n                    this.playLevelUpOnce(this.powerPlant, \"TX_shengji\");\r\n                    this.playLevelUpOnce(this.powerPlant, \"TX_shengjiLZ\");\r\n\r\n                    this.scheduleOnce(() => {\r\n                        const unlock = find(\"THREE3DNODE/Unlock\");\r\n\r\n                        for (let i = 0; i < this._plots.length; i++) {\r\n                            const str = this._plots[i];\r\n\r\n                            this.scheduleOnce(() => {\r\n                                const plot = unlock.children.find(item => {\r\n                                    return item.name == str;\r\n                                })\r\n\r\n                                if (plot) {\r\n                                    const elementCon = plot.getChildByName(\"ElementCon\");\r\n                                    if (elementCon) {\r\n\r\n                                        const node = elementCon.getChildByName(\"Node\");\r\n                                        if (node) {\r\n                                            const dtani = node.getChildByName(\"DTani\");\r\n                                            if (dtani) {\r\n                                                const dtaniAni = dtani.getComponent(Animation);\r\n                                                if (dtaniAni) dtaniAni.play(\"levelDT\");\r\n\r\n                                                const shengji = dtani.getChildByName(\"TX_shengji_02\");\r\n                                                if (shengji) {\r\n                                                    shengji.active = true;\r\n                                                }\r\n\r\n                                                SoundManager.inst.playAudio(\"YX_huoban\");\r\n                                            }\r\n                                        };\r\n\r\n                                        // const itemElectricTowerManager = elementCon.getComponent(ItemElectricTowerManager);\r\n                                        // if (itemElectricTowerManager) {\r\n                                        //     itemElectricTowerManager.isNew = true;\r\n                                        // }\r\n\r\n                                        // 升级之后的电塔攻击距离\r\n                                        DataManager.Instance.electricTowerAttackRange = 22.5;\r\n                                    }\r\n                                }\r\n                            }, i * 0.1)\r\n                        }\r\n\r\n                        // this.scheduleOnce(() => {\r\n                        for (let i = 0; i < this._plots.length; i++) {\r\n                            const str = this._plots[i];\r\n                            const plot = unlock.children.find(item => {\r\n                                return item.name == str;\r\n                            })\r\n\r\n                            if (plot) {\r\n                                const elementCon = plot.getChildByName(\"ElementCon\");\r\n                                if (elementCon) {\r\n                                    const itemElectricTowerManager = elementCon.getComponent(ItemElectricTowerManager);\r\n                                    if (itemElectricTowerManager) {\r\n                                        itemElectricTowerManager.isNew = true;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        // }, 1)\r\n                    }, 0.6)\r\n\r\n                    if (DataManager.Instance.mainCamera) DataManager.Instance.mainCamera.overGuide();\r\n\r\n                    // 结束游戏\r\n                    if (!DataManager.Instance.isGameEnd) {\r\n                        this.scheduleOnce(() => {\r\n                            DataManager.Instance.isGameEnd = true;\r\n                            DataManager.Instance.gameEndManager.init();\r\n                        }, 2);\r\n                    }\r\n                    SoundManager.inst.playAudio(\"YX_weiqiangSC\");\r\n                });\r\n                break;\r\n            }\r\n\r\n            case PlotEnum.Plot6: {\r\n                // 升级传送带\r\n                SoundManager.inst.playAudio(\"YX_weiqiangSC\");\r\n                this.shrinkHideLandmark(landmark, () => {\r\n                    this.setGuideDisplay(PlotEnum.Plot6, false, true);\r\n                    landmark.active = false;\r\n\r\n                    // 提速\r\n                    const aniState = this.conveyorAni.getState(\"Take 001\");\r\n                    if (aniState) aniState.speed = 2;\r\n                    const loggingState = this.logging.getState(\"chilun\");\r\n                    if (loggingState) loggingState.speed = 2;\r\n\r\n                    DataManager.Instance.conveyorLevel = 2;\r\n                    this.plotLevelUpEffect(this.conveyorAni.node.parent, \"TX_shengji\");\r\n\r\n                    DataManager.Instance.isConveyerBeltUpgrade = true;\r\n\r\n                    // 切换皮带显示\r\n                    const workflow = find(\"THREE3DNODE/Workflow\");\r\n                    const beltNode = workflow?.getChildByName(\"chuansongdai\");\r\n                    beltNode?.getChildByName(\"polySurface42\") && (beltNode.getChildByName(\"polySurface42\").active = false);\r\n                    beltNode?.getChildByName(\"polySurface43\") && (beltNode.getChildByName(\"polySurface43\").active = true);\r\n\r\n                    const workflowAni = workflow?.getComponent(Animation);\r\n                    workflowAni?.play(\"chuansongSJ\");\r\n                });\r\n                break;\r\n            }\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    /** Landmark 收缩隐藏后回调 */\r\n    private shrinkHideLandmark(landmark: Node, done: () => void) {\r\n        tween(landmark)\r\n            .to(0.15, { scale: new Vec3(0, 0, 0) }, { easing: 'quadOut' })\r\n            .call(done)\r\n            .start();\r\n    }\r\n\r\n    /** 设置引导列表的显示状态，并可选地标记进入提示区域 */\r\n    private setGuideDisplay(plot: string, isDisplay: boolean, enterPrompt = false) {\r\n        const data = DataManager.Instance.guideTargetList.find(it => it.plot === plot);\r\n        if (data) data.isDisplay = isDisplay;\r\n        if (enterPrompt) DataManager.Instance.isEnterPromptArea = true;\r\n    }\r\n\r\n    /** 激活 ElementCon + 播放电线动画 + 弹起DT，完成后回调返还 DT 节点 */\r\n    private activateElementCon(parentPlot: Node, onDtReady: (dtNode: Node) => void) {\r\n        const elementCon = parentPlot.getChildByName(\"ElementCon\");\r\n        if (!elementCon) return;\r\n\r\n        elementCon.active = true;\r\n        elementCon.setScale(1, 1, 1);\r\n\r\n        const node = elementCon.getChildByName(\"Node\");\r\n        const wireCon = node?.getChildByName(\"WireCon\");\r\n        if (!wireCon) return;\r\n\r\n        wireCon.active = true;\r\n\r\n        const dianxian = wireCon.getChildByName(\"dianxian\");\r\n        const dianxianAni = dianxian?.getComponent(Animation);\r\n        dianxianAni?.play(\"dianxianCS\");\r\n        dianxianAni?.once(Animation.EventType.FINISHED, () => {\r\n            SoundManager.inst.playAudio(\"YX_huoban\");\r\n            const dt = node.getChildByName(\"DTani\");\r\n            if (!dt) return;\r\n\r\n            dt.active = true;\r\n            dt.setScale(1, 0, 1);\r\n\r\n            tween(dt)\r\n                .to(0.15, { scale: new Vec3(1, 1.2, 1) }, { easing: 'quadOut' })\r\n                .to(0.05, { scale: new Vec3(1, 1, 1) }, { easing: 'quadOut' })\r\n                .call(() => onDtReady(dt))\r\n                .start();\r\n        }, this);\r\n    }\r\n\r\n    /** 一键开刚体/碰撞体*/\r\n    private enablePhysics(node: Node) {\r\n        const col = node.getComponent(Collider);\r\n        if (col) col.enabled = true;\r\n        const rb = node.getComponent(RigidBody);\r\n        if (rb) rb.enabled = true;\r\n    }\r\n\r\n    /** 播放一次性升级特效 */\r\n    private playLevelUpOnce(host: Node, childName: string) {\r\n        const fx = host.getChildByName(childName);\r\n        if (!fx) return;\r\n        fx.active = true;\r\n        const ani = fx.getComponent(Animation);\r\n        ani?.play();\r\n        ani?.once(Animation.EventType.FINISHED, () => (fx.active = false), this);\r\n    }\r\n\r\n    /** 弹出显示 Landmark（并更新引导显示） */\r\n    private popShowLandmark(landmark: Node, plot: string, guideDisplay: boolean) {\r\n        if (!landmark) return;\r\n        landmark.active = true;\r\n        landmark.setScale(0, 0, 0);\r\n        tween(landmark)\r\n            .to(0.15, { scale: new Vec3(1.2, 1.2, 1.2) }, { easing: 'quadOut' })\r\n            .to(0.05, { scale: new Vec3(1, 1, 1) }, { easing: 'quadOut' })\r\n            .call(() => {\r\n                this.setGuideDisplay(plot, guideDisplay, true);\r\n            })\r\n            .start();\r\n    }\r\n\r\n    // 解锁5 or 6\r\n    unlockPlot5OrPlot6(plots) {\r\n        for (let i = 0; i < plots.length; i++) {\r\n            const plotName = plots[i];\r\n            const plot = find(`THREE3DNODE/Unlock/${plotName}`);\r\n            if (plot) {\r\n                plot.active = true;\r\n\r\n                const landmark = plot.getChildByName(\"Landmark\");\r\n                landmark.active = true;\r\n                landmark.setScale(0, 0, 0);\r\n                tween(landmark)\r\n                    .to(0.15, { scale: new Vec3(1.2, 1.2, 1.2) }, { easing: 'quadOut' })\r\n                    .to(0.05, { scale: new Vec3(1, 1, 1) }, { easing: 'quadOut' })\r\n                    .call(() => {\r\n                        if (plotName == PlotEnum.Plot6) {\r\n                            const data = DataManager.Instance.guideTargetList.find(item => {\r\n                                return item.plot == PlotEnum.Plot6;\r\n                            })\r\n\r\n                            if (data) {\r\n                                data.isDisplay = true;\r\n                                DataManager.Instance.isEnterPromptArea = true;\r\n                            }\r\n                        } else if (plotName == PlotEnum.Plot5) {\r\n                            const data = DataManager.Instance.guideTargetList.find(item => {\r\n                                return item.plot == PlotEnum.Plot5;\r\n                            })\r\n\r\n                            if (data) {\r\n                                data.isDisplay = true;\r\n                                DataManager.Instance.isEnterPromptArea = true;\r\n                            }\r\n                        }\r\n                    })\r\n                    .start();\r\n            }\r\n        }\r\n    }\r\n\r\n    // 解锁触发条件\r\n    unlockTriggerConditions() {\r\n        switch (DataManager.Instance.unlockPowerTowersNum) {\r\n            case 2:\r\n                {\r\n                    DataManager.Instance.bulletAttackTimeInterval = DataManager.Instance.sceneManager.towerAttackInterval[1] ?? 1;\r\n                    DataManager.Instance.monsterNum = 25;\r\n                }\r\n                break;\r\n            case 3:\r\n                {\r\n                    const plots = [PlotEnum.Plot6];                         // 解锁传送带地块\r\n                    this.unlockPlot5OrPlot6(plots);\r\n\r\n                    DataManager.Instance.bornTimeLimit = 0.3;\r\n                    DataManager.Instance.bulletAttackTimeInterval = DataManager.Instance.sceneManager.towerAttackInterval[2] ?? 0.9;\r\n                    DataManager.Instance.monsterNum = 30;\r\n\r\n                }\r\n                break;\r\n            case 4: {\r\n                {\r\n                    DataManager.Instance.bulletAttackTimeInterval = DataManager.Instance.sceneManager.towerAttackInterval[3] ?? 0.8;\r\n                }\r\n                break;\r\n            }\r\n            case 5:\r\n                {\r\n                    const plots = [PlotEnum.Plot5];\r\n                    this.unlockPlot5OrPlot6(plots);\r\n                    DataManager.Instance.bornTimeLimit = 0.2;\r\n                    DataManager.Instance.bulletAttackTimeInterval = DataManager.Instance.sceneManager.towerAttackInterval[4] ?? 0.7;\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    // 金币停止呼吸动画\r\n    stopBreathingAni(landmark: Node) {\r\n        const coinAni = landmark.getComponent(Animation);\r\n        if (!coinAni) return;\r\n        const clipName = \"UI_jiaofu\";\r\n        let state = coinAni.getState(clipName);\r\n\r\n        // 如果还没创建 state，则手动创建\r\n        if (!state) {\r\n            const clip = coinAni.clips?.find(c => c && c.name === clipName);\r\n            if (!clip) return;\r\n            state = coinAni.createState(clip, clipName);\r\n        }\r\n\r\n        // 强制跳到第 0 秒并采样\r\n        state.time = 0;\r\n        state.sample();\r\n        state.stop();\r\n    }\r\n\r\n    // 解锁plot3 和 plot9的两个地块\r\n    unlockPlot3AndPlot9() {\r\n        const plots = [PlotEnum.Plot3, PlotEnum.Plot9];\r\n\r\n        for (let i = 0; i < plots.length; i++) {\r\n            const plotName = plots[i];\r\n            const plot = find(`THREE3DNODE/Unlock/${plotName}`);\r\n            if (plot) {\r\n                plot.active = true;\r\n\r\n                const plotBoxCollider = plot.getComponent(Collider);\r\n                if (plotBoxCollider) {\r\n                    plotBoxCollider.enabled = true;\r\n                }\r\n\r\n                const plotRightbody = plot.getComponent(RigidBody);\r\n                if (plotRightbody) {\r\n                    plotRightbody.enabled = true;\r\n                }\r\n\r\n                const landmark = plot.getChildByName(\"Landmark\");\r\n                landmark.active = true;\r\n                landmark.setScale(0, 0, 0);\r\n                tween(landmark)\r\n                    .to(0.15, { scale: new Vec3(1.2, 1.2, 1.2) }, { easing: 'quadOut' })\r\n                    .to(0.05, { scale: new Vec3(1, 1, 1) }, { easing: 'quadOut' })\r\n                    .call(() => {\r\n                        const data = DataManager.Instance.guideTargetList.find(item => {\r\n                            return item.plot == plotName;\r\n                        })\r\n\r\n                        if (data) {\r\n                            data.isDisplay = true;\r\n                            DataManager.Instance.isEnterPromptArea = true;\r\n                        }\r\n                    })\r\n                    .start();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 地块升级效果\r\n     * @param node 地块节点\r\n     */\r\n    private plotLevelUpEffect(node: Node, name = \"TX_shengjiLZ\") {\r\n        let levelUpNode: Node = node.getChildByName(name);\r\n        if (levelUpNode) {\r\n            levelUpNode.active = true;\r\n            levelUpNode.getComponent(Animation).play();\r\n            levelUpNode.getComponent(Animation).on(Animation.EventType.FINISHED, () => {\r\n                levelUpNode.active = false;\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    // 取消武器\r\n    cancelPhysics(otherColliderNode) {\r\n        const collider = otherColliderNode.getComponent(Collider);\r\n        if (collider) {\r\n            collider.enabled = false;\r\n        }\r\n        const rightBody = otherColliderNode.getComponent(Collider);\r\n        if (rightBody) {\r\n            rightBody.enabled = false;\r\n        }\r\n    }\r\n\r\n    // 解锁士兵\r\n    unlockHelper(obj) {\r\n        const partner = DataManager.Instance.partnerConManager.create();\r\n        const worldPos = obj.otherCollider.node.getWorldPosition();\r\n        partner.setPosition(worldPos);\r\n\r\n        if (partner && this.partnerCon) partner.setParent(this.partnerCon);\r\n    }\r\n\r\n    private reserveValueIfPossible(landmarkNode: Node, amount: number): boolean {\r\n        const labelNode = landmarkNode.getChildByName(\"Label\");\r\n        const labelCom = labelNode?.getComponent(Label);\r\n        if (!labelCom) return false;\r\n\r\n        const key = landmarkNode.parent;\r\n        const currentVal = Number(labelCom.string);\r\n        const reserved = this._reservedLabelMap.get(key) || 0;\r\n\r\n        if (currentVal - reserved < amount) return false;\r\n\r\n        this._reservedLabelMap.set(key, reserved + amount);\r\n        return true;\r\n    }\r\n\r\n    private finalizeReservedValue(landmarkNode: Node, amount: number): number {\r\n        const labelNode = landmarkNode.getChildByName(\"Label\");\r\n        const labelCom = labelNode?.getComponent(Label);\r\n        if (!labelCom) return 0;\r\n\r\n        const key = landmarkNode.parent;\r\n        const currentVal = Number(labelCom.string);\r\n        const newVal = Math.max(0, currentVal - amount);\r\n        labelCom.string = `${newVal}`;\r\n\r\n        const reserved = this._reservedLabelMap.get(key) || 0;\r\n        this._reservedLabelMap.set(key, Math.max(0, reserved - amount));\r\n\r\n        return newVal;\r\n    }\r\n\r\n    // === 获取堆叠位置 ===\r\n    private _getStackTopWorldPos(container: Node, offsetY: number): Vec3 {\r\n        const base = container.getWorldPosition();\r\n        let maxY = 0;\r\n        for (const child of container.children) {\r\n            const y = child.getWorldPosition().y - base.y;\r\n            if (y > maxY) maxY = y;\r\n        }\r\n        return new Vec3(base.x, base.y + maxY + offsetY, base.z);\r\n    }\r\n\r\n    // 修改地块颜色\r\n    landDiscoloration(otherCollider) {\r\n        this.resetLandDiscoloration();\r\n\r\n        const landmark = otherCollider.node.getChildByName(\"Landmark\");\r\n        if (landmark) {\r\n            const dashedBoxParent = landmark.getChildByName(\"kuang-001\");\r\n            if (dashedBoxParent) {\r\n                this.areaEffectNode = dashedBoxParent;\r\n                const renderer = dashedBoxParent.getComponent(UIRenderer);\r\n                if (renderer) {\r\n                    renderer.color = new Color(61, 255, 0);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    resetLandDiscoloration() {\r\n        const unlock = find(\"THREE3DNODE/Unlock\");\r\n        if (!unlock) return;\r\n\r\n        for (const plot of unlock.children) {\r\n            const plotName = this._curPlots.find(item => {\r\n                return item == plot.name;\r\n            })\r\n\r\n            if (!plot || plotName) continue;\r\n\r\n            const landmark = plot.getChildByName(\"Landmark\");\r\n            if (!landmark) continue;\r\n\r\n            this.stopBreathingAni(landmark);\r\n\r\n            const dashedBox = landmark.getChildByName(\"kuang-001\");\r\n            if (!dashedBox) continue;\r\n\r\n            this.areaEffectNode = dashedBox;\r\n\r\n            const renderer = dashedBox.getComponent(UIRenderer);\r\n            if (renderer) {\r\n                renderer.color = new Color(255, 255, 255);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 重置plot动画\r\n    resetPlotPromptAni() {\r\n        const list = [\r\n            find(\"ThreeDNode/Plot6\"),\r\n            find(\"ThreeDNode/Plot7\"),\r\n            find(\"ThreeDNode/Plot8\"),\r\n            find(\"ThreeDNode/Plot9\"),\r\n        ]\r\n\r\n        for (let i = 0; i < list.length; i++) {\r\n            const plotNode = list[i];\r\n\r\n            if (!plotNode) continue;\r\n\r\n            const renderer = plotNode.getComponent(UIRenderer);\r\n            if (renderer) renderer.color = new Color(255, 255, 255, 255);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}