{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_0623_JHF_FaMuShengCun/assets/JavaScript/Camera/CameraMain.ts"],"names":["_decorator","Camera","Component","Node","tween","v3","Vec3","DataManager","ccclass","property","tempPos","CameraMain","initialDirection","start","Instance","mainCamera","subtract","node","worldPosition","target","update","dt","cameraGuiding","add","camera","setWorldPosition","overGuide","to","position","current","height","orthoHeight","onUpdate","woodGuidance","curPos","clone","cameraPos","children","x","y","z","delay","call"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Component, Node, Quat, tween, v3, Vec3 } from 'cc';\r\nimport { DataManager } from '../Global/DataManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet tempPos: Vec3 = v3();\r\n\r\n@ccclass('CameraMain')\r\nexport class CameraMain extends Component {\r\n    @property(Node)\r\n    target: Node | null = null;\r\n\r\n    @property(Camera)\r\n    camera: Camera | null = null;\r\n\r\n    @property(Node)\r\n    cameraPos: Node = null;\r\n\r\n    initialDirection: Vec3 = v3();\r\n    start() {\r\n        DataManager.Instance.mainCamera = this;\r\n\r\n        Vec3.subtract(this.initialDirection, this.node.worldPosition, this.target!.worldPosition);\r\n\r\n        // this.scheduleOnce(() => {\r\n        //     this.overGuide();\r\n        // }, 4)\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (DataManager.Instance.cameraGuiding) return;\r\n\r\n        Vec3.add(tempPos, this.target.worldPosition, this.initialDirection);\r\n\r\n        if (this.camera) {\r\n            this.camera.node.setWorldPosition(tempPos)\r\n        }\r\n    }\r\n\r\n    public overGuide() {\r\n        //结束引导\r\n        DataManager.Instance.cameraGuiding = true;\r\n        // tween(this.node)\r\n        //     .by(0.8, { worldPosition: new Vec3(20, 0, 0) })\r\n        //     .delay(1)\r\n        //     .by(0.8, { worldPosition: new Vec3(-20, 0, 0) })\r\n        //     .call(() => {\r\n        //         DataManager.Instance.cameraGuiding = false;\r\n        //     })\r\n        //     .start();\r\n\r\n        tween(this.node)\r\n            .to(1, { position: new Vec3(34.636, 41.019, 35.38) })\r\n            .start();\r\n\r\n        const current = { height: this.camera.orthoHeight };\r\n        tween(current)\r\n            .to(1, { height: 35 }, {\r\n                onUpdate: () => {\r\n                    this.camera.orthoHeight = current.height;\r\n                }\r\n            })\r\n            .start();\r\n    }\r\n\r\n    // 木头指引\r\n    public woodGuidance() {\r\n        //结束引导\r\n        DataManager.Instance.cameraGuiding = true;\r\n        const curPos = this.node.position.clone();\r\n        tween(this.node)\r\n            .to(1, { worldPosition: new Vec3(this.cameraPos.children[0].position.x, this.cameraPos.children[0].position.y, this.cameraPos.children[0].position.z) })\r\n            .to(2, { worldPosition: new Vec3(this.cameraPos.children[1].position.x, this.cameraPos.children[1].position.y, this.cameraPos.children[1].position.z) })\r\n            .delay(3)\r\n            .to(2, { worldPosition: curPos })\r\n            .call(() => {\r\n                DataManager.Instance.cameraGuiding = false;\r\n            })\r\n            .start();\r\n    }\r\n}\r\n"]}