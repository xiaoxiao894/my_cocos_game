{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_DefendTheCup/assets/JavaScript/pillars/PillarItem.ts"],"names":["_decorator","CCInteger","Collider","Component","instantiate","Node","Prefab","DeliverItem","ccclass","property","PillarItem","_num","_deliverItem","start","_state","pillarCollider","node","active","deliver","getComponent","addChild","onEnable","on","onCollisionEnter","onDisable","off","pillarActive","init","needNum","pillarDie","itemAdd","addItem","event","isUnlocked","getLeftNeedNum","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,S,OAAAA,S;AAA4BC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AAChFC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;4BAGjBU,U,WADZF,OAAO,CAAC,YAAD,C,UAGHC,QAAQ,CAACP,QAAD,C,UAGRO,QAAQ,CAACR,SAAD,C,UAGRQ,QAAQ,CAACR,SAAD,C,UAGRQ,QAAQ,CAACH,MAAD,C,UAGRG,QAAQ,CAACJ,IAAD,C,2BAfb,MACaK,UADb,SACgCP,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAkB9BQ,IAlB8B,GAkBf,CAlBe;AAAA,eAmB9BC,YAnB8B;AAAA;;AAsBtCC,QAAAA,KAAK,GAAG;AACJ,eAAKC,MAAL,GAAc,CAAd;AACA,eAAKH,IAAL,GAAY,CAAZ;AACA,eAAKI,cAAL,CAAoBC,IAApB,CAAyBC,MAAzB,GAAkC,KAAlC;AAEA,cAAID,IAAI,GAAGZ,WAAW,CAAC,KAAKc,OAAN,CAAtB;;AACA,cAAIF,IAAJ,EAAU;AACN,iBAAKJ,YAAL,GAAoBI,IAAI,CAACG,YAAL;AAAA;AAAA,2CAApB;AACAH,YAAAA,IAAI,CAACC,MAAL,GAAc,KAAd;AACA,iBAAKD,IAAL,CAAUI,QAAV,CAAmBJ,IAAnB;AACH;AAEJ;;AAESK,QAAAA,QAAQ,GAAS;AACvB,eAAKN,cAAL,CAAoBO,EAApB,CAAuB,kBAAvB,EAA2C,KAAKC,gBAAhD,EAAkE,IAAlE;AACH;;AAESC,QAAAA,SAAS,GAAS;AACxB,eAAKT,cAAL,CAAoBU,GAApB,CAAwB,kBAAxB,EAA4C,KAAKF,gBAAjD,EAAmE,IAAnE;AACH,SA1CqC,CA4CtC;;;AACOG,QAAAA,YAAY,GAAG;AAClB,eAAKZ,MAAL,GAAc,CAAd;AACA,eAAKC,cAAL,CAAoBC,IAApB,CAAyBC,MAAzB,GAAkC,IAAlC;;AACA,cAAI,KAAKL,YAAT,EAAuB;AACnB,iBAAKA,YAAL,CAAkBe,IAAlB,CAAuB,KAAKC,OAA5B;;AACA,iBAAKhB,YAAL,CAAkBI,IAAlB,CAAuBC,MAAvB,GAAgC,IAAhC;AACH;AAEJ;;AAEOY,QAAAA,SAAS,GAAG;AAChB,eAAKf,MAAL,GAAc,CAAd;AACH;;AAEMgB,QAAAA,OAAO,GAAG;AACb,cAAI,KAAKhB,MAAL,KAAgB,CAAhB,IAAqB,KAAKH,IAAL,GAAY,KAAKiB,OAA1C,EAAmD;AAAA;;AAC/C,iBAAKjB,IAAL,GAD+C,CAE/C;;AACA,gBAAI,KAAKA,IAAL,IAAa,KAAKiB,OAAtB,EAA+B;AAC3B,mBAAKC,SAAL;AACH;;AACD,uCAAKjB,YAAL,gCAAmBmB,OAAnB;AACH;AACJ;;AAEOR,QAAAA,gBAAgB,CAACS,KAAD,EAAyB,CAC7C;AACH;;AAEMC,QAAAA,UAAU,GAAG;AAChB,iBAAO,KAAKnB,MAAL,IAAe,CAAtB;AACH;;AAEMoB,QAAAA,cAAc,GAAW;AAC5B,iBAAO,KAAKN,OAAL,GAAe,KAAKjB,IAA3B;AACH;;AAIDwB,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAtFqC,O;;;;;iBAGX,I;;;;;;;iBAGL,C;;;;;;;iBAGJ,C;;;;;;;iBAGA,I;;;;;;;iBAKO,C","sourcesContent":["import { _decorator, CCInteger, Collider, Component, ICollisionEvent, instantiate, Node, Prefab } from 'cc';\r\nimport { DeliverItem } from './DeliverItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PillarItem')\r\nexport class PillarItem extends Component {\r\n\r\n    @property(Collider)\r\n    pillarCollider: Collider = null;\r\n\r\n    @property(CCInteger)\r\n    unlockIndex: number = 0;\r\n\r\n    @property(CCInteger)\r\n    needNum: number = 0;\r\n\r\n    @property(Prefab)\r\n    deliver: Prefab = null;\r\n\r\n    @property(Node)\r\n\r\n    //0 没激活  1 已激活  2  已无用\r\n    private _state: number = 0;\r\n    private _num: number = 0;\r\n    private _deliverItem: DeliverItem;\r\n\r\n\r\n    start() {\r\n        this._state = 0;\r\n        this._num = 0;\r\n        this.pillarCollider.node.active = false;\r\n\r\n        let node = instantiate(this.deliver);\r\n        if (node) {\r\n            this._deliverItem = node.getComponent(DeliverItem);\r\n            node.active = false;\r\n            this.node.addChild(node);\r\n        }\r\n\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        this.pillarCollider.on(\"onCollisionEnter\", this.onCollisionEnter, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.pillarCollider.off(\"onCollisionEnter\", this.onCollisionEnter, this);\r\n    }\r\n\r\n    //激活\r\n    public pillarActive() {\r\n        this._state = 1;\r\n        this.pillarCollider.node.active = true;\r\n        if (this._deliverItem) {\r\n            this._deliverItem.init(this.needNum);\r\n            this._deliverItem.node.active = true;\r\n        }\r\n\r\n    }\r\n\r\n    private pillarDie() {\r\n        this._state = 2;\r\n    }\r\n\r\n    public itemAdd() {\r\n        if (this._state === 1 && this._num < this.needNum) {\r\n            this._num++;\r\n            //更新展示展示\r\n            if (this._num >= this.needNum) {\r\n                this.pillarDie();\r\n            }\r\n            this._deliverItem?.addItem();\r\n        }\r\n    }\r\n\r\n    private onCollisionEnter(event: ICollisionEvent) {\r\n        //主角第一次靠近播放动画\r\n    }\r\n\r\n    public isUnlocked() {\r\n        return this._state == 2;\r\n    }\r\n\r\n    public getLeftNeedNum(): number {\r\n        return this.needNum - this._num;\r\n    }\r\n\r\n\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}