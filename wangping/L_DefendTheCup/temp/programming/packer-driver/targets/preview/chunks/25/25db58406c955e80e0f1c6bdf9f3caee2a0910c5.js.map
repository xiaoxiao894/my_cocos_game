{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_DefendTheCup/assets/JavaScript/Actor/Bullet.ts"],"names":["_decorator","Component","Vec3","ccclass","property","Bullet","PartnerManager","explosiveSpecialEffects","target","speed","_dir","_tempPos","update","deltaTime","isValid","node","active","currentPos","worldPosition","targetPos","subtract","distance","length","boundFunc","bind","name","normalize","scaleAndAdd","setWorldPosition","lookAt","euler","eulerAngles","clone","setRotationFromEuler","x","y","z"],"mappings":";;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,I,OAAAA,I;;;;;;;;;OAEhC;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;wBAGjBK,M,WADZF,OAAO,CAAC,QAAD,C,gBAAR,MACaE,MADb,SAC4BJ,SAD5B,CACsC;AAAA;AAAA;AAAA,eAC3BK,cAD2B,GACV,IADU;AAAA,eAE3BC,uBAF2B,GAED,IAFC;AAAA,eAG3BC,MAH2B,GAGL,IAHK;AAAA,eAI3BC,KAJ2B,GAIX,EAJW;AAAA,eAK1BC,IAL0B,GAKnB,IAAIR,IAAJ,EALmB;AAAA,eAM1BS,QAN0B,GAMf,IAAIT,IAAJ,EANe;AAAA;;AAQlCU,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,cAAI,CAAC,KAAKL,MAAN,IAAgB,CAAC,KAAKA,MAAL,CAAYM,OAAjC,EAA0C;AACtC,iBAAKC,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACA;AACH;;AAED,cAAMC,UAAU,GAAG,KAAKF,IAAL,CAAUG,aAA7B;AACA,cAAMC,SAAS,GAAG,KAAKX,MAAL,CAAYU,aAA9B;AAEAhB,UAAAA,IAAI,CAACkB,QAAL,CAAc,KAAKV,IAAnB,EAAyBS,SAAzB,EAAoCF,UAApC;;AACA,cAAMI,QAAQ,GAAG,KAAKX,IAAL,CAAUY,MAAV,EAAjB;;AAEA,cAAID,QAAQ,GAAG,GAAf,EAAoB;AAChB,iBAAKN,IAAL,CAAUC,MAAV,GAAmB,KAAnB,CADgB,CAEhB;;AACA,gBAAMO,SAAS,GAAG,KAAKhB,uBAAL,CAA6BiB,IAA7B,CAAkC,KAAKlB,cAAvC,CAAlB;AACAiB,YAAAA,SAAS,CAAC,KAAKf,MAAN,EAAc,KAAKO,IAAL,CAAUU,IAAxB,CAAT,CAJgB,CAKhB;AACA;;AACA;AACH;;AAEDvB,UAAAA,IAAI,CAACwB,SAAL,CAAe,KAAKhB,IAApB,EAA0B,KAAKA,IAA/B;AACAR,UAAAA,IAAI,CAACyB,WAAL,CAAiB,KAAKhB,QAAtB,EAAgCM,UAAhC,EAA4C,KAAKP,IAAjD,EAAuD,KAAKD,KAAL,GAAaI,SAApE;AACA,eAAKE,IAAL,CAAUa,gBAAV,CAA2B,KAAKjB,QAAhC;AAEA,eAAKI,IAAL,CAAUc,MAAV,CAAiBV,SAAjB;AACA,cAAMW,KAAK,GAAG,KAAKf,IAAL,CAAUgB,WAAV,CAAsBC,KAAtB,EAAd;AACA,eAAKjB,IAAL,CAAUkB,oBAAV,CAA+B,IAAI/B,IAAJ,CAAS4B,KAAK,CAACI,CAAf,EAAkBJ,KAAK,CAACK,CAAN,GAAU,EAA5B,EAAgCL,KAAK,CAACM,CAAtC,CAA/B;AACH;;AArCiC,O","sourcesContent":["import { _decorator, Component, Node, Vec3 } from 'cc';\r\nimport { DataManager } from '../Global/DataManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Bullet')\r\nexport class Bullet extends Component {\r\n    public PartnerManager = null;\r\n    public explosiveSpecialEffects = null;\r\n    public target: Node | null = null;\r\n    public speed: number = 10;\r\n    private _dir = new Vec3();\r\n    private _tempPos = new Vec3();\r\n\r\n    update(deltaTime: number) {\r\n        if (!this.target || !this.target.isValid) {\r\n            this.node.active = false;\r\n            return;\r\n        }\r\n\r\n        const currentPos = this.node.worldPosition;\r\n        const targetPos = this.target.worldPosition;\r\n\r\n        Vec3.subtract(this._dir, targetPos, currentPos);\r\n        const distance = this._dir.length();\r\n\r\n        if (distance < 0.3) {\r\n            this.node.active = false;\r\n            // 击中怪物， 播放动画\r\n            const boundFunc = this.explosiveSpecialEffects.bind(this.PartnerManager);\r\n            boundFunc(this.target, this.node.name);\r\n            // 处理命中怪物的逻辑\r\n            // DataManager.Instance.monsterManager.killMonsters([this.target]);\r\n            return;\r\n        }\r\n\r\n        Vec3.normalize(this._dir, this._dir);\r\n        Vec3.scaleAndAdd(this._tempPos, currentPos, this._dir, this.speed * deltaTime);\r\n        this.node.setWorldPosition(this._tempPos)\r\n\r\n        this.node.lookAt(targetPos);\r\n        const euler = this.node.eulerAngles.clone();\r\n        this.node.setRotationFromEuler(new Vec3(euler.x, euler.y + 90, euler.z));\r\n    }\r\n}\r\n\r\n"]}