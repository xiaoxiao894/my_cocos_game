{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_DefendTheCup/assets/JavaScript/UI/CardConManager.ts"],"names":["_decorator","Animation","Button","Component","director","EventHandler","instantiate","Label","Node","Prefab","tween","UIOpacity","Vec3","DataManager","CollisionEntityEnum","EntityTypeEnum","MathUtil","ItemAreaManager","PartnerManager","Actor","StateDefine","LanguageManager","ccclass","property","CardConManager","otherNode","opacity","_isCreatingCards","isUnlockDeliveryAreas6","maskBgOpacity","start","Instance","cardConManager","node","getComponent","addComponent","maskBg","active","createCards","children","length","removeAllChildren","actor","player","changState","Idle","stopMove","isDeactivateVirtualJoystick","to","easing","results","staticgetTwoDistinctRandom","cardDatas","forEach","cardData","index","scheduleOnce","cardPrefab","prefabMap","get","card","console","warn","cardNode","setParent","setPosition","addCardClickEvent","labelCom","getChildByName","string","text","t","ani","play","effect","sprite","spriteAni","once","EventType","FINISHED","soundManager","CardEjectSoundPlay","button","handler","target","component","customEventData","JSON","stringify","clickEvents","onCardClick","event","customData","parse","i","cardCon","ClickCardSoundPlay","addPartner","partner","name","call","prefab","partnerManager","init","worldPos","worldPosition","effectPrafab","TX_shengjiLZ","skillExplosion","getScene","addChild","setWorldPosition","x","y","z","anim","destroy","deliveryAreas6","parent","DeliveryAreas6","itemAreaManager","displayAni","CreatePartnerSoundPlay"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Button, Component, director, EventHandler, instantiate, Label, Node, Prefab, Sprite, tween, UIOpacity, Vec3 } from 'cc';\r\nimport { DataManager } from '../Global/DataManager';\r\nimport { CollisionEntityEnum, EntityTypeEnum } from '../Enum/Index';\r\nimport { MathUtil } from '../Util/MathUtil';\r\nimport { ItemAreaManager } from '../Area/ItemAreaManager';\r\nimport { PartnerManager } from '../Actor/PartnerManager';\r\nimport { Actor } from '../Actor/Actor';\r\nimport { StateDefine } from '../Actor/StateDefine';\r\nimport { LanguageManager } from '../Language/LanguageManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CardConManager')\r\nexport class CardConManager extends Component {\r\n    @property(Node)\r\n    maskBg: Node = null;\r\n\r\n    @property(Prefab)\r\n    bornEffect: Prefab = null;\r\n\r\n    otherNode = null;\r\n\r\n    opacity = null;\r\n\r\n    private _isCreatingCards = false;\r\n    private isUnlockDeliveryAreas6 = true;\r\n    private maskBgOpacity = null;\r\n    start() {\r\n        DataManager.Instance.cardConManager = this;\r\n\r\n        this.opacity = this.node.getComponent(UIOpacity) || this.node.addComponent(UIOpacity);\r\n\r\n        this.maskBgOpacity = this.maskBg.getComponent(UIOpacity) || this.maskBg.addComponent(UIOpacity);\r\n        this.maskBg.active = false;\r\n    }\r\n\r\n    // 生成两张卡片\r\n    createCards(otherNode) {\r\n        if (this._isCreatingCards) return;\r\n        this._isCreatingCards = true;\r\n\r\n        if (this.node.children.length > 0) this.node.removeAllChildren();\r\n\r\n        const actor = DataManager.Instance.player.node.getComponent(Actor);\r\n        actor.changState(StateDefine.Idle);\r\n        actor.stopMove();\r\n        DataManager.Instance.isDeactivateVirtualJoystick = true;\r\n        this.node.active = true;\r\n        this.otherNode = otherNode;\r\n\r\n        // 显示并渐显遮罩背景\r\n        this.maskBg.active = true;\r\n        this.maskBgOpacity.opacity = 0;\r\n        tween(this.maskBgOpacity)\r\n            .to(1, { opacity: 120 }, { easing: 'quadOut' })\r\n            .start();\r\n\r\n        const results = MathUtil.staticgetTwoDistinctRandom(DataManager.Instance.cardDatas);\r\n        if (!results) return;\r\n\r\n        results.forEach((cardData, index) => {\r\n            this.scheduleOnce(() => {\r\n                const cardPrefab = DataManager.Instance.prefabMap.get(cardData.card);\r\n                if (!cardPrefab) {\r\n                    console.warn('未找到卡片预制体:', cardData.card);\r\n                    return;\r\n                }\r\n\r\n                const cardNode = instantiate(cardPrefab);\r\n                cardNode.setParent(this.node);\r\n\r\n\r\n\r\n                // 设置位置（左右分布）\r\n                cardNode.setPosition(index === 0 ? -140 : 140, 0, 0);\r\n\r\n                // 添加点击事件\r\n                this.addCardClickEvent(cardNode, cardData);\r\n\r\n                const card = cardNode.children[0];\r\n                const labelCom = card.getChildByName(\"Label\").getComponent(Label);\r\n                if (labelCom?.string == \"Stagbeetle\") {\r\n                    const text = LanguageManager.t('Stagbeetle');\r\n                    if (text) {\r\n                        labelCom.string = text;\r\n                    }\r\n                } else if (labelCom?.string == \"Beetle\") {\r\n                    const text = LanguageManager.t('Beetle');\r\n                    if (text) {\r\n                        labelCom.string = text;\r\n                    }\r\n                } else if (labelCom?.string == \"Beetlewarrior\") {\r\n                    const text = LanguageManager.t('Beetlewarrior');\r\n                    if (text) {\r\n                        labelCom.string = text;\r\n                    }\r\n                }\r\n                const ani = card.getComponent(Animation);\r\n                if (ani) {\r\n                    ani.play(\"cardCS\");\r\n                }\r\n                const effect = card.getChildByName(\"Effect\");\r\n                if (effect) {\r\n                    const sprite = effect.getChildByName(\"Sprite\");\r\n\r\n                    if (sprite) {\r\n                        const spriteAni = sprite.getComponent(Animation);\r\n                        if (spriteAni) {\r\n                            spriteAni.play(\"Effect\");\r\n                            spriteAni.once(Animation.EventType.FINISHED, () => {\r\n                                sprite.active = false;\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n\r\n                DataManager.Instance.soundManager?.CardEjectSoundPlay();\r\n            }, index * 0.5)\r\n        });\r\n    }\r\n\r\n    addCardClickEvent(node: Node, cardData: any) {\r\n        const button = node.getComponent(Button) || node.addComponent(Button);\r\n\r\n        const handler = new EventHandler();\r\n        handler.target = this.node;\r\n        handler.component = \"CardConManager\";\r\n        handler.handler = 'onCardClick';\r\n        handler.customEventData = JSON.stringify(cardData);\r\n\r\n        button.clickEvents = [handler];\r\n    }\r\n\r\n    // 点击处理函数\r\n    onCardClick(event: Event, customData) {\r\n        customData = JSON.parse(customData);\r\n        // const cardIndex = DataManager.Instance.cardDatas.findIndex(item => {\r\n        //     return item.card == customData.card;\r\n        // })\r\n\r\n        const target = event.target;\r\n        target[`__isClick`] = true;\r\n\r\n        // if (cardIndex < 0) return;\r\n\r\n        // DataManager.Instance.cardDatas.splice(cardIndex, 1);\r\n\r\n        for (let i = 0; i < this.node.children.length; i++) {\r\n            const cardCon = this.node.children[i];\r\n            const card = cardCon.children[0];\r\n            const ani = card.getComponent(Animation);\r\n            if (ani) {\r\n                if (cardCon[`__isClick`]) {\r\n                    ani.play(\"cardXS\")\r\n                } else {\r\n                    ani.play(\"cardXS02\")\r\n                }\r\n            }\r\n        }\r\n\r\n        DataManager.Instance.soundManager.ClickCardSoundPlay();\r\n\r\n        this.scheduleOnce(() => {\r\n            this.addPartner(customData.partner)\r\n            this._isCreatingCards = false;\r\n        }, 1)\r\n    }\r\n\r\n    // 添加伙伴\r\n    addPartner(name: EntityTypeEnum) {\r\n        this.node.active = false;\r\n\r\n        tween(this.maskBgOpacity)\r\n            .to(1, { opacity: 0 }, { easing: 'quadIn' })\r\n            .call(() => {\r\n                this.maskBg.active = false;\r\n            })\r\n            .start();\r\n\r\n        const prefab = DataManager.Instance.prefabMap.get(name);\r\n        const partner = instantiate(prefab);\r\n        const partnerManager = partner.getComponent(PartnerManager) || partner.addComponent(PartnerManager);\r\n        partnerManager.init();\r\n        partner.setParent(this.otherNode);\r\n\r\n        const worldPos = partner.worldPosition;\r\n        const effectPrafab = DataManager.Instance.prefabMap.get(EntityTypeEnum.TX_shengjiLZ);\r\n        const skillExplosion = instantiate(effectPrafab);\r\n        director.getScene().addChild(skillExplosion);\r\n        skillExplosion.setWorldPosition(new Vec3(worldPos.x, worldPos.y + 1.5, worldPos.z));\r\n\r\n        const anim = skillExplosion?.getComponent(Animation);\r\n        if (anim) {\r\n            anim.play(`TX_shengjiLZ`);\r\n            anim.once(Animation.EventType.FINISHED, () => {\r\n                skillExplosion.destroy();\r\n            });\r\n        } else {\r\n            // 没动画时，延迟回收\r\n            this.scheduleOnce(() => {\r\n                skillExplosion.destroy();\r\n            }, 1);\r\n        }\r\n\r\n        // 解锁地块6\r\n        if (this.isUnlockDeliveryAreas6) {\r\n            this.isUnlockDeliveryAreas6 = false;\r\n\r\n            const deliveryAreas6 = this.otherNode.parent.getChildByName(CollisionEntityEnum.DeliveryAreas6);\r\n            if (deliveryAreas6) {\r\n                const itemAreaManager = deliveryAreas6.getComponent(ItemAreaManager);\r\n                itemAreaManager?.displayAni();\r\n            }\r\n        }\r\n\r\n        if (this.node.children.length > 0) this.node.removeAllChildren();\r\n\r\n        DataManager.Instance.isDeactivateVirtualJoystick = false;\r\n        DataManager.Instance.soundManager.CreatePartnerSoundPlay();\r\n    }\r\n}\r\n\r\n\r\n"]}