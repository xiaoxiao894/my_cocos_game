{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_DefendTheCup/assets/JavaScript/UI/GameEndManager.ts"],"names":["_decorator","Component","Label","Node","tween","UIOpacity","Vec3","DataManager","super_html_playable","LanguageManager","ccclass","property","GameEndManager","isExecuteClickButton","start","Instance","gameEndManager","downloadLabel","download","getChildByName","getComponent","text","t","string","node","active","onEnable","scheduleOnce","onClickButton","init","hand","opacityCom","bg","addComponent","opacity","to","icon","setScale","win","soundManager","WinSoundPlay","scale","delay","call","playFingerAndButtonAnim","repeatForever"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, tween, UIOpacity, Vec3 } from 'cc';\r\nimport { DataManager } from '../Global/DataManager';\r\nimport super_html_playable from '../Common/super_html_playable';\r\nimport { LanguageManager } from '../Language/LanguageManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameEndManager')\r\nexport class GameEndManager extends Component {\r\n    @property(Node)\r\n    bg: Node = null;\r\n\r\n    @property(Node)\r\n    icon: Node = null;\r\n\r\n    @property(Node)\r\n    download: Node = null;\r\n\r\n    @property(Node)\r\n    win: Node = null;\r\n\r\n    @property(Node)\r\n    hand: Node = null;\r\n\r\n    private isExecuteClickButton = false;\r\n\r\n    start() {\r\n        DataManager.Instance.gameEndManager = this;\r\n\r\n        const downloadLabel = this.download?.getChildByName(\"Label\")?.getComponent(Label);\r\n        const text = LanguageManager.t('Download');\r\n        if (downloadLabel && text) {\r\n            downloadLabel.string = text;\r\n        }\r\n\r\n        this.node.active = false;\r\n    }\r\n\r\n    onEnable() {\r\n        this.scheduleOnce(() => {\r\n            if (!this.isExecuteClickButton) {\r\n                this.isExecuteClickButton = true;\r\n                this.onClickButton();\r\n            }\r\n        }, 2);\r\n    }\r\n\r\n    init() {\r\n        this.hand.active = false;\r\n        this.node.active = true;\r\n        // 背景淡入\r\n        const opacityCom = this.bg.getComponent(UIOpacity) || this.bg.addComponent(UIOpacity);\r\n        opacityCom.opacity = 0;\r\n        tween(opacityCom)\r\n            .to(0.1, { opacity: 150 })\r\n            .start();\r\n\r\n        // 初始缩放\r\n        this.icon.setScale(0, 0, 0);\r\n        this.win.setScale(0, 1, 1);\r\n        this.download.setScale(0, 1, 1);\r\n\r\n        DataManager.Instance.soundManager.WinSoundPlay();\r\n\r\n        tween(this.icon)\r\n            .to(0.3, { scale: new Vec3(1.2, 1.2, 1.2) })\r\n            .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n            .start();\r\n\r\n        tween(this.download)\r\n            .delay(0.3)\r\n            .to(0.3, { scale: new Vec3(1.1, 1.1, 1.1) })\r\n            .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n            .start();\r\n\r\n        tween(this.win)\r\n            .delay(0.1)\r\n            .to(0.3, { scale: new Vec3(1.1, 1.1, 1.1) })\r\n            .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n            .call(() => {\r\n                this.hand.active = true;\r\n                this.playFingerAndButtonAnim();\r\n            })\r\n            .start();\r\n    }\r\n\r\n    // 手指+按钮循环提示动画\r\n    playFingerAndButtonAnim() {\r\n        // 手指动画（0.9 -> 1 循环）\r\n        tween(this.hand)\r\n            .repeatForever(\r\n                tween()\r\n                    .to(0.3, { scale: new Vec3(0.9, 0.9, 0.9) })\r\n                    .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n            )\r\n            .start();\r\n\r\n        // 按钮点击提示动画（1.0 -> 1.1 -> 1.0 循环）\r\n        // tween(this.download)\r\n        //     .repeatForever(\r\n        //         tween()\r\n        //             .to(0.3, { scale: new Vec3(1.1, 1.1, 1.1) })\r\n        //             .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n        //     )\r\n        //     .start();\r\n    }\r\n\r\n    onClickButton() {\r\n        this.isExecuteClickButton = true;\r\n        super_html_playable.download();\r\n    }\r\n}\r\n\r\n\r\n"]}