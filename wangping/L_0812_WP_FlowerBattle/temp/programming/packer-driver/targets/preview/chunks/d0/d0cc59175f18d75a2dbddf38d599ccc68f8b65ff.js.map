{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/Entitys/Player.ts"],"names":["_decorator","Animation","BoxCollider","Mat4","Quat","RigidBody","tween","v3","Vec3","Entity","PlayerTrigger","App","GlobeVariable","EventManager","EventType","SoundManager","ccclass","property","Player","entityName","entifyName","player","moveSpeed","rotateSpeed","attack","coinNum","coinStartNum","backpack","triggerNode","coinTween","coinHeightInterval","subtractCoin","num","instance","emit","CoinSub","calibrateCoinsPosition","onLoad","node","getChildByName","onDestroy","stop","start","initTrigger","jumpAni","console","log","characterSkeletalAnimation","play","continue","children","forEach","item","removeFromParent","destroy","removeAllChildren","i","poolManager","getNode","Coin","getComponent","enabled","parent","setPosition","update","dt","collectCoin","isStartGame","dropController","getAroundDrop","coin","worldPosition","coinFly","getGoldMineCoin","pos","sceneNode","effectParent","setWorldPosition","Instance","playAudio","getWorldPosition","clone","duration","controller","t","setParent","startRot","worldRotation","endRot","to","easing","onUpdate","isValid","oneMinusT","maxY","length","localTarget","worldPos","worldRot","getWorldRotation","worldScale","getWorldScale","worldMat","fromSRT","worldTarget","transformMat4","control","x","Math","max","y","z","lerpedEuler","w","setWorldRotation","call","finalWorldPos","scale","CoinAdd"],"mappings":"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","sourcesContent":["import { _decorator, Animation, BoxCollider, Collider, Component, find, ICollisionEvent, ITriggerEvent, Mat4, Node, Quat, RigidBody, tween, v3, Vec3 } from 'cc';\r\nimport Entity from './Entity';\r\nimport { VirtualInput } from '../UI/VirtuallInput';\r\nimport { PlayerTrigger } from './PlayerTrigger';\r\nimport { App } from '../App';\r\nimport { GlobeVariable } from '../core/GlobeVariable';\r\nimport { EventManager } from '../core/EventManager';\r\nimport { EventType } from '../core/EventType';\r\nimport { SoundManager } from '../core/SoundManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Player')\r\nexport class Player extends Entity {\r\n\r\n    @property(Animation)\r\n    attackAni: Animation = null;\r\n\r\n    entityName: string = GlobeVariable.entifyName.player;\r\n\r\n    // 移动速度\r\n    moveSpeed = 18;\r\n    // 旋转平滑系数\r\n    private rotateSpeed = 14.0;\r\n\r\n    attack: number = 1;\r\n\r\n    //初始给的金币数量\r\n    public coinNum = GlobeVariable.coinStartNum;\r\n\r\n    private backpack: Node = null;\r\n\r\n    //碰撞触发事件管理\r\n    private triggerNode: PlayerTrigger = new PlayerTrigger();\r\n\r\n    // 新增：保存金币动画的引用，用于取消\r\n    private coinTween: any = null;\r\n\r\n    subtractCoin(num: number) {\r\n        this.coinNum -= num;\r\n        EventManager.instance.emit(EventType.CoinSub, num);\r\n        this.calibrateCoinsPosition()\r\n    }\r\n\r\n    onLoad(): void {\r\n        super.onLoad();\r\n        this.backpack = this.node.getChildByName(\"backpack\");\r\n    }\r\n\r\n    // 新增：节点销毁时停止所有动画\r\n    onDestroy() {\r\n        if (this.coinTween) {\r\n            this.coinTween.stop();\r\n        }\r\n    }\r\n\r\n    protected start(): void {\r\n        this.triggerNode.initTrigger(this);\r\n    }\r\n\r\n    jumpAni(){\r\n        console.log('jumpAni 11111111');\r\n        this.characterSkeletalAnimation.play(\"Jump\");\r\n    }\r\n    continue() {\r\n        this.backpack.children.forEach((item) => {\r\n            item.removeFromParent();\r\n            item.destroy();\r\n        })\r\n        this.backpack.removeAllChildren();\r\n        this.coinNum = GlobeVariable.coinStartNum;\r\n        for (let i = 0; i < GlobeVariable.coinStartNum; i++) {\r\n            let node = App.poolManager.getNode(GlobeVariable.entifyName.Coin);\r\n            node.getComponent(BoxCollider).enabled = false;\r\n            node.getComponent(RigidBody).enabled = false;\r\n            node.parent = this.backpack;\r\n            node.setPosition(v3(0, i * 0.45, 0));\r\n        }\r\n    }\r\n\r\n    update(dt: number): void {\r\n        super.update(dt);\r\n        this.collectCoin();\r\n    }\r\n\r\n    //收集金币\r\n    private collectCoin() {\r\n        if (!GlobeVariable.isStartGame) {\r\n            return;\r\n        }\r\n        if (App.dropController && App.dropController.getAroundDrop) {\r\n            let coin: Node = App.dropController.getAroundDrop(this.node.worldPosition);\r\n            if (coin) {\r\n                coin.getComponent(BoxCollider).enabled = false;\r\n                coin.getComponent(RigidBody).enabled = false;\r\n                this.coinFly(coin);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /** 从金矿收集金币 */\r\n    public getGoldMineCoin(coin: Node, pos: Vec3) {\r\n        if (!coin) return; // 新增空值检查\r\n\r\n        coin.parent = App.sceneNode.effectParent;\r\n        coin.setWorldPosition(pos);\r\n        this.coinFly(coin);\r\n    }\r\n\r\n    private coinFly(coin: Node) {\r\n        if (!coin) return; // 新增空值检查\r\n\r\n        SoundManager.Instance.playAudio(\"jinbi_shiqu\");\r\n\r\n        const start = coin.getWorldPosition().clone();\r\n        const duration = 0.2;\r\n        const controller = { t: 0 };\r\n\r\n        coin.setParent(App.sceneNode.effectParent);\r\n        coin.setWorldPosition(start);\r\n\r\n        const startRot: Quat = coin.worldRotation.clone();\r\n        const endRot: Quat = this.backpack.worldRotation;\r\n\r\n        // 保存tween引用以便后续取消\r\n        this.coinTween = tween(controller)\r\n            .to(duration, { t: 1 }, {\r\n                easing: 'quadOut',\r\n                onUpdate: () => {\r\n                    // 关键修复：检查coin是否存在\r\n                    if (!coin || !coin.isValid) return;\r\n\r\n                    const t = controller.t;\r\n                    const oneMinusT = 1 - t;\r\n\r\n                    let maxY = this.backpack.children.length * 0.45;\r\n                    const localTarget = new Vec3(0, maxY, 0);\r\n\r\n                    const worldPos = this.backpack.getWorldPosition();\r\n                    const worldRot = this.backpack.getWorldRotation();\r\n                    const worldScale = this.backpack.getWorldScale();\r\n                    const worldMat = new Mat4();\r\n                    Mat4.fromSRT(worldMat, worldRot, worldPos, worldScale);\r\n                    const worldTarget = Vec3.transformMat4(new Vec3(), localTarget, worldMat);\r\n\r\n                    const control = new Vec3(\r\n                        (start.x + worldTarget.x) / 2,\r\n                        Math.max(start.y, worldTarget.y) + 2,\r\n                        (start.z + worldTarget.z) / 2\r\n                    );\r\n\r\n                    const pos = new Vec3(\r\n                        oneMinusT * oneMinusT * start.x + 2 * oneMinusT * t * control.x + t * t * worldTarget.x,\r\n                        oneMinusT * oneMinusT * start.y + 2 * oneMinusT * t * control.y + t * t * worldTarget.y,\r\n                        oneMinusT * oneMinusT * start.z + 2 * oneMinusT * t * control.z + t * t * worldTarget.z\r\n                    );\r\n\r\n                    // 只在coin有效时设置位置\r\n                    coin.setWorldPosition(pos);\r\n\r\n                    const lerpedEuler = new Quat(\r\n                        startRot.x * oneMinusT + endRot.x * t,\r\n                        startRot.y * oneMinusT + endRot.y * t,\r\n                        startRot.z * oneMinusT + endRot.z * t,\r\n                        startRot.w * oneMinusT + endRot.w * t\r\n                    );\r\n\r\n                    // 只在coin有效时设置旋转\r\n                    coin.setWorldRotation(lerpedEuler);\r\n                }\r\n            })\r\n            .call(() => {\r\n                // 检查coin是否仍然有效\r\n                if (!coin || !coin.isValid) return;\r\n\r\n                const finalWorldPos = coin.getWorldPosition().clone();\r\n                coin.setParent(this.backpack);\r\n                coin.setWorldPosition(finalWorldPos);\r\n                coin.setWorldRotation(endRot);\r\n\r\n                tween(coin)\r\n                    .to(0.15, { scale: new Vec3(8.6, 8.6, 8.6) }, { easing: 'quadOut' })\r\n                    .to(0.05, { scale: new Vec3(8, 8, 8) }, { easing: 'quadOut' })\r\n                    .start();\r\n\r\n                this.coinNum++;\r\n                EventManager.instance.emit(EventType.CoinAdd, 1);\r\n                this.calibrateCoinsPosition();\r\n            })\r\n            .start();\r\n    }\r\n\r\n    private coinHeightInterval: number = 0.45;\r\n    /**\r\n     * 校准所有金币的位置，解决堆叠断层问题\r\n     * 循环遍历背包中的所有金币，按索引重新设置高度\r\n     */\r\n    private calibrateCoinsPosition(): void {\r\n        // if (!this.backpack) return;\r\n\r\n        // // 获取所有金币子节点\r\n        // const coins = this.backpack.children;\r\n\r\n        // // 遍历并重新设置每个金币的高度\r\n        // coins.forEach((coin: Node, index: number) => {\r\n        //     // 保持x和z坐标不变，只调整y坐标\r\n        //     const localPos = coin.getPosition();\r\n        //     const targetY = index * this.coinHeightInterval;\r\n\r\n        //     // 如果当前高度与目标高度差距较大，使用动画平滑过渡\r\n        //     if (Math.abs(localPos.y - targetY) > 0.01) {\r\n        //         tween(coin)\r\n        //             .to(0.1, { position: new Vec3(localPos.x, targetY, localPos.z) })\r\n        //             .start();\r\n        //     } else {\r\n        //         // 差距小时直接设置，避免不必要的动画\r\n        //         coin.setPosition(localPos.x, targetY, localPos.z);\r\n        //     }\r\n        // });\r\n    }\r\n    // private playAttackSound() {\r\n    //     SoundManager.Instance.playAudio(\"gongji\");\r\n    // }\r\n\r\n    // private playAttackAni() {\r\n    //     this.attackAni.node.active = true;\r\n    //     this.attackAni.play();\r\n    // }\r\n\r\n}\r\n\r\n\r\n"]}