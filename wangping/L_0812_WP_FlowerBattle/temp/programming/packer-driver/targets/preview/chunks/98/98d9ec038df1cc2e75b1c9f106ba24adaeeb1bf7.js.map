{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/Entitys/DropController.ts"],"names":["DropController","tween","Vec3","BoxCollider","RigidBody","App","GlobeVariable","_dropList","Instance","_instance","getDropList","continueGame","forEach","item","removeFromParent","destroy","dropItem","pos","node","poolManager","getNode","entifyName","Coin","sceneNode","coinParent","addChild","setWorldPosition","startY","y","peakY","bounceY","getComponent","enabled","to","position","x","z","easing","call","push","start","getAroundDrop","i","length","drop","dropPos","worldPosition","clone","dx","dz","distSqrXZ","maxSquareDis","splice","drops","unshift"],"mappings":";;;wIAOqBA,c;;;;;;;;;;;;;;;;;;;AAPZC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAYC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,S,OAAAA,S;;AAChCC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;;;AAET;AACA;AACA;yBACqBN,c,GAAN,MAAMA,cAAN,CAAqB;AAAA;AAEhC;AAFgC,eAGxBO,SAHwB,GAGJ,EAHI;AAAA;;AAON,mBAARC,QAAQ,GAAG;AACzB,cAAI,KAAKC,SAAL,IAAkB,IAAtB,EAA4B;AACxB,iBAAKA,SAAL,GAAiB,IAAIT,cAAJ,EAAjB;AACH;;AACD,iBAAO,KAAKS,SAAZ;AACH;;AACMC,QAAAA,WAAW,GAAG;AACjB,iBAAO,KAAKH,SAAZ;AACH;;AACDI,QAAAA,YAAY,GAAG;AACX,eAAKJ,SAAL,CAAeK,OAAf,CAAwBC,IAAD,IAAU;AAC7BA,YAAAA,IAAI,CAACC,gBAAL;AACAD,YAAAA,IAAI,CAACE,OAAL;AACH,WAHD;;AAIA,eAAKR,SAAL,GAAiB,EAAjB;AACH,SAtB+B,CAwBhC;;;AACOS,QAAAA,QAAQ,CAACC,GAAD,EAAY;AACvB,cAAIC,IAAI,GAAG;AAAA;AAAA,0BAAIC,WAAJ,CAAgBC,OAAhB,CAAwB;AAAA;AAAA,8CAAcC,UAAd,CAAyBC,IAAjD,CAAX;AACA;AAAA;AAAA,0BAAIC,SAAJ,CAAcC,UAAd,CAAyBC,QAAzB,CAAkCP,IAAlC;AACAA,UAAAA,IAAI,CAACQ,gBAAL,CAAsBT,GAAtB,EAHuB,CAKvB;;AACA,cAAMU,MAAM,GAAGV,GAAG,CAACW,CAAnB;AACA,cAAMC,KAAK,GAAGF,MAAM,GAAG,CAAvB,CAPuB,CAOO;;AAC9B,cAAMG,OAAO,GAAGH,MAAM,GAAG,CAAzB,CARuB,CAQO;;AAC9BT,UAAAA,IAAI,CAACa,YAAL,CAAkB5B,WAAlB,EAA+B6B,OAA/B,GAAyC,IAAzC;AACAd,UAAAA,IAAI,CAACa,YAAL,CAAkB3B,SAAlB,EAA6B4B,OAA7B,GAAuC,IAAvC;AACA/B,UAAAA,KAAK,CAACiB,IAAD,CAAL,CACKe,EADL,CACQ,IADR,EACc;AAAEC,YAAAA,QAAQ,EAAE,IAAIhC,IAAJ,CAASe,GAAG,CAACkB,CAAb,EAAgBN,KAAhB,EAAuBZ,GAAG,CAACmB,CAA3B;AAAZ,WADd,EAC2D;AAAEC,YAAAA,MAAM,EAAE;AAAV,WAD3D,EACoF;AADpF,WAEKJ,EAFL,CAEQ,GAFR,EAEa;AAAEC,YAAAA,QAAQ,EAAE,IAAIhC,IAAJ,CAASe,GAAG,CAACkB,CAAb,EAAgBL,OAAhB,EAAyBb,GAAG,CAACmB,CAA7B;AAAZ,WAFb,EAE4D;AAAEC,YAAAA,MAAM,EAAE;AAAV,WAF5D,EAEqF;AAFrF,WAGKJ,EAHL,CAGQ,IAHR,EAGc;AAAEC,YAAAA,QAAQ,EAAE,IAAIhC,IAAJ,CAASe,GAAG,CAACkB,CAAb,EAAgBL,OAAO,GAAG,CAA1B,EAA6Bb,GAAG,CAACmB,CAAjC;AAAZ,WAHd,EAGiE;AAAEC,YAAAA,MAAM,EAAE;AAAV,WAHjE,EAGwF;AAHxF,WAIKJ,EAJL,CAIQ,IAJR,EAIc;AAAEC,YAAAA,QAAQ,EAAE,IAAIhC,IAAJ,CAASe,GAAG,CAACkB,CAAb,EAAgBL,OAAhB,EAAyBb,GAAG,CAACmB,CAA7B;AAAZ,WAJd,EAI6D;AAAEC,YAAAA,MAAM,EAAE;AAAV,WAJ7D,EAIqF;AACjF;AACA;AANJ,WAOKC,IAPL,CAOU,MAAM;AACR;AACA;AACA,iBAAK/B,SAAL,CAAegC,IAAf,CAAoBrB,IAApB;AACH,WAXL,EAYKsB,KAZL;AAaH;;AAEMC,QAAAA,aAAa,CAACxB,GAAD,EAAY;AAC5B,eAAK,IAAIyB,CAAC,GAAG,KAAKnC,SAAL,CAAeoC,MAAf,GAAwB,CAArC,EAAwCD,CAAC,IAAI,CAA7C,EAAgDA,CAAC,EAAjD,EAAqD;AACjD,gBAAIE,IAAI,GAAG,KAAKrC,SAAL,CAAemC,CAAf,CAAX;AACA,gBAAMG,OAAO,GAAGD,IAAI,CAACE,aAAL,CAAmBC,KAAnB,EAAhB;AACA,gBAAMC,EAAE,GAAGH,OAAO,CAACV,CAAR,GAAYlB,GAAG,CAACkB,CAA3B;AACA,gBAAMc,EAAE,GAAGJ,OAAO,CAACT,CAAR,GAAYnB,GAAG,CAACmB,CAA3B;AACA,gBAAMc,SAAS,GAAGF,EAAE,GAAGA,EAAL,GAAUC,EAAE,GAAGA,EAAjC,CALiD,CAOjD;;AACA,gBAAIC,SAAS,IAAI;AAAA;AAAA,gDAAcC,YAA/B,EAA6C;AACzC,mBAAK5C,SAAL,CAAe6C,MAAf,CAAsBV,CAAtB,EAAyB,CAAzB,EADyC,CAEzC;;;AACA,kBAAMW,KAAa,GAAG,KAAK9C,SAAL,CAAe6C,MAAf,CAAsBV,CAAtB,EAAyB,KAAKnC,SAAL,CAAeoC,MAAf,GAAwBD,CAAjD,CAAtB;;AACA,mBAAKnC,SAAL,CAAe+C,OAAf,CAAuB,GAAGD,KAA1B;;AACA,qBAAOT,IAAP;AACH;AACJ;;AACD,iBAAO,IAAP;AACH;;AArE+B,O;;AAAf5C,MAAAA,c,CAKHS,S,GAA4B,I","sourcesContent":["import { tween, Vec3, Node, BoxCollider, RigidBody } from \"cc\";\r\nimport { App } from \"../App\";\r\nimport { GlobeVariable } from \"../core/GlobeVariable\";\r\n\r\n/**\r\n * @class DropController 掉落物管理类\r\n */\r\nexport default class DropController {\r\n\r\n    /** 可拾取掉落物列表 */\r\n    private _dropList: Node[] = [];\r\n\r\n    public static _instance: DropController = null;\r\n\r\n    public static get Instance() {\r\n        if (this._instance == null) {\r\n            this._instance = new DropController();\r\n        }\r\n        return this._instance;\r\n    }\r\n    public getDropList() {\r\n        return this._dropList;\r\n    }\r\n    continueGame() {\r\n        this._dropList.forEach((item) => {\r\n            item.removeFromParent();\r\n            item.destroy();\r\n        })\r\n        this._dropList = [];\r\n    }\r\n\r\n    // 金币掉落\r\n    public dropItem(pos: Vec3) {\r\n        let node = App.poolManager.getNode(GlobeVariable.entifyName.Coin);\r\n        App.sceneNode.coinParent.addChild(node);\r\n        node.setWorldPosition(pos);\r\n\r\n        // 原始位置\r\n        const startY = pos.y;\r\n        const peakY = startY + 7;     // 第一次跃起高度\r\n        const bounceY = startY + 1;   // 回落后的弹跳高度\r\n        node.getComponent(BoxCollider).enabled = true;\r\n        node.getComponent(RigidBody).enabled = true;\r\n        tween(node)\r\n            .to(0.15, { position: new Vec3(pos.x, peakY, pos.z) }, { easing: 'quadOut' })   // 向上弹起\r\n            .to(0.1, { position: new Vec3(pos.x, bounceY, pos.z) }, { easing: 'quadIn' })    // 回落\r\n            .to(0.05, { position: new Vec3(pos.x, bounceY + 2, pos.z) }, { easing: 'quadOut' }) // 二次弹起\r\n            .to(0.05, { position: new Vec3(pos.x, bounceY, pos.z) }, { easing: 'quadIn' })   // 回到地面\r\n            //     // .to(0.05, { position: new Vec3(pos.x, bounceY, pos.z) }, { easing: 'quadOut' }) // 二次弹起\r\n            //     // .to(0.05, { position: new Vec3(pos.x, startY, pos.z) }, { easing: 'quadIn' })   // 回到地面\r\n            .call(() => {\r\n                //  node.getComponent(BoxCollider).enabled = false;\r\n                // node.getComponent(RigidBody).enabled = false;\r\n                this._dropList.push(node);\r\n            })\r\n            .start();\r\n    }\r\n\r\n    public getAroundDrop(pos: Vec3) {\r\n        for (let i = this._dropList.length - 1; i >= 0; i--) {\r\n            let drop = this._dropList[i];\r\n            const dropPos = drop.worldPosition.clone();\r\n            const dx = dropPos.x - pos.x;\r\n            const dz = dropPos.z - pos.z;\r\n            const distSqrXZ = dx * dx + dz * dz;\r\n\r\n            // 范围内\r\n            if (distSqrXZ <= GlobeVariable.maxSquareDis) {\r\n                this._dropList.splice(i, 1);\r\n                //范围外掉落物放到最前边\r\n                const drops: Node[] = this._dropList.splice(i, this._dropList.length - i);\r\n                this._dropList.unshift(...drops);\r\n                return drop;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n}"]}