{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/Guide/GuideManager.ts"],"names":["_decorator","Node","Vec3","App","Arrow3D","ArroePath","GlobeVariable","ccclass","property","GuideManager","guideCurStep","guidePhase","executingStep","arrowPath","arrow3dComp","guideList","guideStepJson","currentTarget","Instance","_instance","continueGame","sceneNode","forEach","node","name","arrow3d","guidArrow3D","setParent","guideParent","getComponent","setActive","jsonTablePhase2","init","jsonTablePhase1","worldPosition","clone","setGuideStepCompLate","num","isGuideComplate","setNextGuideStep","nexStep","nextStep","extendNext","nexPhase","checkRange","parent","coinParent","minDis","Number","MAX_VALUE","minCoin","coinList","children","i","length","coin","isValid","randomIndex","Math","floor","random","pos","moveEndBlockPos","selfPos","forward","toTarget","subtract","isInFront","dot","enemyPos","playerPos","playerController","getPlayer","distance","update","dt","isCameraMoveEnd","currentStep","showArrow","targetPos","active","playFloatingEffect","vv3","x","y","z","createArrowPathTo","hideArrow","coinNum","handOverNam","handOver","lockCoin","handVoer","maxCoin","curCoin","isBlock","step2","handOverNam1","lockCoin1","lockCoin2","blockLockNum","mapShowController","reunBlock1","step22","lockCoin22","step6","lockCoin3","handOverNam2","lockCoin11","beetleLockNum","retunBeetle1"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3 } from 'cc';\r\nimport { App } from '../App';\r\nimport { Arrow3D } from './Arrow3D';\r\nimport { ArroePath } from './ArroePath';\r\nimport { GlobeVariable } from '../core/GlobeVariable';\r\nimport { EnemySpider } from '../Entitys/EnemySpider';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GuideManager')\r\nexport class GuideManager {\r\n    //引导当前步骤\r\n    private guideCurStep: number = 1;\r\n    //引导阶段\r\n    public guidePhase: number = 1;\r\n\r\n    //引导当前执行到的步骤\r\n    public executingStep: number = 0;\r\n\r\n    private static _instance: GuideManager = null;\r\n\r\n    private arrowPath: ArroePath = null;\r\n    arrow3dComp: Arrow3D = null;\r\n\r\n    private guideList: Record<string, Node> = {};//引导节点 索引位置\r\n    private guideStepJson: any = {};\r\n    public static get Instance() {\r\n        if (this._instance == null) {\r\n            this._instance = new GuideManager();\r\n        }\r\n        return this._instance;\r\n\r\n    }\r\n    continueGame() {\r\n        this.guideCurStep = 1;\r\n        this.executingStep = 0;\r\n        this.guidePhase = 1;\r\n        this.guideList = {};\r\n        App.sceneNode.guideList.forEach((node: Node) => {\r\n            if (node.name) { // 假设节点有唯一名称属性（如 \"UI_jianta\"）\r\n                this.guideList[node.name] = node;\r\n            }\r\n        });\r\n\r\n        let arrow3d = App.guidArrow3D;\r\n        arrow3d.setParent(App.sceneNode.guideParent);\r\n        this.arrow3dComp = arrow3d.getComponent(Arrow3D);\r\n        this.arrow3dComp.setActive(true);\r\n        this.arrowPath = new ArroePath();\r\n        this.jsonTablePhase2();\r\n    }\r\n\r\n    init() {\r\n        //this.guideList = App.sceneNode.guideList;\r\n        this.guideList = {};\r\n        App.sceneNode.guideList.forEach((node: Node) => {\r\n            if (node.name) { // 假设节点有唯一名称属性（如 \"UI_jianta\"）\r\n                this.guideList[node.name] = node;\r\n            }\r\n        });\r\n\r\n        let arrow3d = App.guidArrow3D;\r\n        arrow3d.setParent(App.sceneNode.guideParent);\r\n        this.arrow3dComp = arrow3d.getComponent(Arrow3D);\r\n        this.arrow3dComp.setActive(true);\r\n        this.arrowPath = new ArroePath();\r\n        this.jsonTablePhase1();\r\n    }\r\n    jsonTablePhase2() {\r\n        let guideStepJson = {\r\n            1: {\r\n                \"targetPos\": this.guideList[\"UI_jianta1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_jianta1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 2,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_jianta\",\r\n            },\r\n            2: {\r\n                \"targetPos\": this.guideList[\"UI_juma1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_juma1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 3,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_juma\",\r\n            },\r\n            3: {\r\n                \"targetPos\": this.guideList[\"UI_paota1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_paota1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 4,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_paota\",\r\n            },\r\n            4: {\r\n                \"targetPos\": this.guideList[\"UI_shirenhua1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_shirenhua1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 5,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_shirenhua\",\r\n            },\r\n            5: {\r\n                \"targetPos\": this.guideList[\"UI_jiachong1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_jiachong1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 6,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_jiachong\",\r\n            },\r\n            6: {\r\n                \"targetPos\": this.guideList[\"UI_juma-0011\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_juma-0011\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 0,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_juma-001\",\r\n            },\r\n            7: {\r\n                \"targetPos\": this.guideList[\"UI_jiachong-0011\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_jiachong-0011\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 0,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_jiachong-001\",\r\n            },\r\n\r\n\r\n        }\r\n        this.guideStepJson = guideStepJson;\r\n    }\r\n    jsonTablePhase1() {\r\n        let guideStepJson = {\r\n            1: {\r\n                \"targetPos\": this.guideList[\"UI_jianta1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_jianta1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 2,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_jianta\",\r\n            },\r\n            2: {\r\n                \"targetPos\": this.guideList[\"UI_juma1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_juma1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 3,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_juma\",\r\n            },\r\n            3: {\r\n                \"targetPos\": this.guideList[\"UI_paota1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_paota1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 4,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_paota\",\r\n            },\r\n            4: {\r\n                \"targetPos\": this.guideList[\"UI_shirenhua1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_shirenhua1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 5,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_shirenhua\",\r\n            },\r\n            5: {\r\n                \"targetPos\": this.guideList[\"UI_jiachong1\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_jiachong1\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 6,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_jiachong\",\r\n            },\r\n            6: {\r\n                \"targetPos\": this.guideList[\"UI_juma-0011\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_juma-0011\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 0,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_juma-001\",\r\n            },\r\n            7: {\r\n                \"targetPos\": this.guideList[\"UI_jiachong-0011\"].worldPosition.clone(),\r\n                \"targetNode\": this.guideList[\"UI_jiachong-0011\"],\r\n                \"isGuideComplate\": false,\r\n                \"nextStep\": 0,\r\n                \"extendNext\": 0,\r\n                \"handOver\": \"UI_jiachong-001\",\r\n            },\r\n\r\n\r\n        }\r\n        this.guideStepJson = guideStepJson;\r\n    }\r\n\r\n\r\n    setGuideStepCompLate(num: number) {\r\n        this.guideStepJson[num].isGuideComplate = true;\r\n    }\r\n    setNextGuideStep(num: number) {\r\n        this.guideCurStep = num;\r\n\r\n    }\r\n    nexStep(nextStep: number = 0) {\r\n        if (nextStep == 0) {\r\n            this.guideCurStep = this.guideStepJson[this.guideCurStep].nextStep;\r\n        } else {\r\n            this.guideCurStep = this.guideStepJson[this.guideCurStep].extendNext;\r\n        }\r\n    }\r\n    nexPhase() {\r\n        this.guidePhase += 1;\r\n    }\r\n    // 检查最近的敌人（优先锁定当前目标，死亡后再更新）\r\n    private currentTarget: Node = null;\r\n    // resetTargetEnemy(){\r\n    //     this.currentTargetEnemy = null;\r\n    // }\r\n    checkRange() {\r\n        // 1. 先检查当前锁定的敌人是否有效（存在且未死亡）\r\n        if (this.currentTarget && this.currentTarget.parent == App.sceneNode.coinParent) {\r\n\r\n            return this.currentTarget;\r\n        }\r\n\r\n        // 2. 若当前目标无效，重新查找最近的存活敌人\r\n        let minDis = Number.MAX_VALUE;\r\n        let minCoin: Node = null;\r\n        let coinList = App.sceneNode.coinParent.children;\r\n\r\n        for (let i = 0; i < coinList.length; i++) {\r\n            const coin = coinList[i];\r\n            // 跳过已销毁的节点\r\n            if (!coin.isValid) continue;\r\n\r\n\r\n            const randomIndex = Math.floor(Math.random() * 4);\r\n            let pos = App.sceneNode.moveEndBlockPos.children[randomIndex].worldPosition\r\n            let selfPos = coin.worldPosition.clone();\r\n            // // 计算两点到世界原点的距离\r\n            // const posDistance = pos.length();\r\n            // const selfDistance = selfPos.length();\r\n            // const isFartherFromOrigin = posDistance > selfDistance;\r\n            // if (isFartherFromOrigin) {\r\n            //     this.node.setWorldPosition(pos);\r\n            // }\r\n            // 获取自身前方向量（假设Z轴为前）\r\n            const forward = coin.forward;\r\n            // 计算目标相对于自身的向量\r\n            const toTarget = pos.clone().subtract(selfPos);\r\n            // 点积判断是否在前方（大于0为前方）\r\n            const isInFront = toTarget.dot(forward) < 1.5;\r\n            if (isInFront) {\r\n                continue;\r\n            }\r\n            // 计算与玩家的距离\r\n            const enemyPos = coin.worldPosition.clone();\r\n            const playerPos = App.playerController.getPlayer().node.worldPosition.clone();\r\n            const distance = enemyPos.subtract(playerPos).length();\r\n\r\n            // 记录最近的敌人\r\n            if (distance < minDis) {\r\n                minDis = distance;\r\n                minCoin = coin;\r\n            }\r\n        }\r\n\r\n        // 3. 更新当前锁定的敌人\r\n        this.currentTarget = minCoin;\r\n\r\n        // 4. 返回目标位置（若无敌人则返回玩家位置）\r\n        return minCoin;\r\n\r\n    }\r\n\r\n    update(dt) {\r\n        if (!GlobeVariable.isCameraMoveEnd) return;\r\n        // 无需引导时直接返回\r\n        if (this.guideCurStep === -1 || this.guideCurStep === 0) return;\r\n\r\n        // 缓存当前步骤数据\r\n        const currentStep = this.guideStepJson[this.guideCurStep];\r\n        // 提取箭头控制通用方法\r\n        const showArrow = (targetPos) => {\r\n            this.arrow3dComp.setActive(true);\r\n            App.sceneNode.guideParent.active = true;\r\n            this.arrow3dComp?.playFloatingEffect(dt, targetPos);\r\n            let vv3 = new Vec3(targetPos.x, targetPos.y+2, targetPos.z);\r\n            this.arrowPath?.createArrowPathTo(vv3);\r\n        };\r\n        const hideArrow = () => {\r\n            App.sceneNode.guideParent.active = false;\r\n            this.arrow3dComp.setActive(false);\r\n        }\r\n\r\n        switch (this.guidePhase) {\r\n            case 1: // 第一阶段：引导解锁箭塔\r\n                if (!currentStep.isGuideComplate && App.playerController.getPlayer().coinNum > 0) {\r\n                    showArrow(currentStep.targetPos);\r\n                } else {\r\n                    hideArrow();\r\n                }\r\n                break;\r\n\r\n            case 2: // 第二阶段：引导解锁拒马\r\n                const handOverNam = currentStep.handOver;\r\n                const lockCoin = GlobeVariable.handVoer[handOverNam].maxCoin - GlobeVariable.handVoer[handOverNam].curCoin;\r\n\r\n                if (!currentStep.isGuideComplate && App.playerController.getPlayer().coinNum >= lockCoin && !GlobeVariable.isBlock) {\r\n                    showArrow(currentStep.targetPos);\r\n                } else {\r\n                    const targetPos = this.checkRange();\r\n                    targetPos instanceof Node ? showArrow(targetPos.worldPosition.clone()) : hideArrow();\r\n                }\r\n                break;\r\n\r\n            case 3: // 第三阶段：引导拒马炮塔\r\n            case 4: // 第四阶段：引导甲虫兵营\r\n                const step2 = this.guideStepJson[2];\r\n                const handOverNam1 = currentStep.handOver;\r\n                const lockCoin1 = GlobeVariable.handVoer[handOverNam1].maxCoin - GlobeVariable.handVoer[handOverNam1].curCoin;\r\n                const lockCoin2 = GlobeVariable.handVoer[step2.handOver].maxCoin - GlobeVariable.handVoer[step2.handOver].curCoin;\r\n\r\n                if (GlobeVariable.blockLockNum < 2 && App.mapShowController.reunBlock1() && App.playerController.getPlayer().coinNum >= lockCoin2) {\r\n                    showArrow(step2.targetPos);\r\n                } else if (!currentStep.isGuideComplate && App.playerController.getPlayer().coinNum >= lockCoin1) {\r\n                    showArrow(currentStep.targetPos);\r\n                } else {\r\n                    const targetPos = this.checkRange();\r\n                    targetPos instanceof Node ? showArrow(targetPos.worldPosition.clone()) : hideArrow();\r\n                }\r\n                break;\r\n            case 5: // 第五阶段：引导之终点拒马\r\n\r\n                const step22 = this.guideStepJson[2];\r\n                const lockCoin22 = GlobeVariable.handVoer[step22.handOver].maxCoin - GlobeVariable.handVoer[step22.handOver].curCoin;\r\n                const step6 = this.guideStepJson[7];\r\n                const lockCoin3 = GlobeVariable.handVoer[step6.handOver].maxCoin - GlobeVariable.handVoer[step6.handOver].curCoin;\r\n\r\n                const handOverNam2 = currentStep.handOver;\r\n                const lockCoin11 = GlobeVariable.handVoer[handOverNam2].maxCoin - GlobeVariable.handVoer[handOverNam2].curCoin;\r\n                // if (GlobeVariable.blockLockNum < 2 && App.mapShowController.reunBlock1() && App.playerController.getPlayer().coinNum >= lockCoin22) {\r\n                //     showArrow(step22.targetPos);\r\n                // } else \r\n\r\n                if (GlobeVariable.beetleLockNum < 2 && App.mapShowController.retunBeetle1() && App.playerController.getPlayer().coinNum >= lockCoin3) {\r\n                    showArrow(step6.targetPos);\r\n                }\r\n                else if (GlobeVariable.beetleLockNum >= 2 && !currentStep.isGuideComplate && App.playerController.getPlayer().coinNum >= lockCoin11) {\r\n                    showArrow(currentStep.targetPos);\r\n                }\r\n                else {\r\n                    const targetPos = this.checkRange();\r\n                    targetPos instanceof Node ? showArrow(targetPos.worldPosition.clone()) : hideArrow();\r\n                }\r\n\r\n                break;\r\n\r\n\r\n\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}