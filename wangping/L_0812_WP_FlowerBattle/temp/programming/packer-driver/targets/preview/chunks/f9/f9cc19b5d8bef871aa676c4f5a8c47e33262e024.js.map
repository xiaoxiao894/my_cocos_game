{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/Guide/ArroePath.ts"],"names":["_decorator","Component","Quat","Vec3","App","GlobeVariable","ccclass","property","ArroePath","tooltip","arrowNodes","createArrowPathTo","targetPos","player","playerController","getPlayer","node","start","worldPosition","dir","subtract","totalLength","length","setArrowCount","count","Math","floor","spacing","normalize","i","arrow","pos","scaleAndAdd","setWorldPosition","rot","fromViewUp","UP","setWorldRotation","targetCount","poolManager","getNode","entifyName","Guid_ArrowPath","setParent","sceneNode","guideParent","push","pop","returnNode","removeFromParent","clearArrows","forEach","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Quat, Vec3 } from 'cc';\r\nimport { App } from '../App';\r\nimport { GlobeVariable } from '../core/GlobeVariable';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ArroePath')\r\nexport class ArroePath extends Component {\r\n\r\n    @property({ tooltip: \"箭头间距\" })\r\n    spacing: number = 3.0;\r\n\r\n    arrowNodes: Node[] = [];\r\n    createArrowPathTo(targetPos: Vec3) {\r\n        const player = App.playerController.getPlayer().node;\r\n        if (!player) return;\r\n\r\n        const start = player.worldPosition;\r\n        const dir = new Vec3();\r\n        Vec3.subtract(dir, targetPos, start);\r\n        const totalLength = dir.length();\r\n\r\n        if (totalLength < 0.01) {\r\n            this.setArrowCount(0);\r\n            return;\r\n        }\r\n\r\n        const count = Math.floor(totalLength / this.spacing);\r\n        this.setArrowCount(count);\r\n\r\n        dir.normalize();\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            const arrow = this.arrowNodes[i];\r\n            let pos = new Vec3();\r\n            Vec3.scaleAndAdd(pos, start, dir, this.spacing * (i + 1)); // 避免从脚下起始\r\n          //  pos.y = 1;\r\n            arrow.setWorldPosition(pos);\r\n\r\n            const rot = new Quat();\r\n            Quat.fromViewUp(rot, dir, Vec3.UP);\r\n            arrow.setWorldRotation(rot);\r\n        }\r\n    }\r\n\r\n    setArrowCount(targetCount: number) {\r\n\r\n        while (this.arrowNodes.length < targetCount) {\r\n            const arrow = App.poolManager.getNode(GlobeVariable.entifyName.Guid_ArrowPath);\r\n            arrow.setParent(App.sceneNode.guideParent);\r\n            this.arrowNodes.push(arrow);\r\n        }\r\n\r\n        while (this.arrowNodes.length > targetCount) {\r\n            const arrow = this.arrowNodes.pop()!;\r\n            App.poolManager.returnNode(arrow);\r\n            arrow.removeFromParent();\r\n        }\r\n    }\r\n    /** 清除所有箭头 */\r\n    clearArrows() {\r\n        if (this.arrowNodes.length === 0) return;\r\n\r\n        this.arrowNodes.forEach(arrow => {\r\n            App.poolManager.returnNode(arrow);\r\n            arrow.removeFromParent();\r\n        });\r\n        this.arrowNodes.length = 0;\r\n    }\r\n\r\n    // 组件销毁时清理资源\r\n    onDestroy() {\r\n        this.clearArrows();\r\n    }\r\n}\r\n\r\n\r\n"]}