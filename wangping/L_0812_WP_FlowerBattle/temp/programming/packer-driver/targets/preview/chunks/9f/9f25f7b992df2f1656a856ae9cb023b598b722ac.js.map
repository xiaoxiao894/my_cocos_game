{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/GameManager.ts"],"names":["_decorator","App","Simulator","GlobeVariable","RVOObstacles","Vector2","Flower","EventManager","EventType","PlayerAttackFlower","ccclass","property","GameManager","isStatrGame","delayedTime","addTime","beetleDelayedTime","beetleAddTime","blockTime","blockDelayedTime","temp","continueGame","characterData","dataManager","getCharacterById","attackInterval","maxNum","beetleNumLimit","mapShowController","playerController","dropController","guideManager","sceneNode","enemyParent","children","forEach","item","removeFromParent","destroy","bloodParent","effectParent","coinParent","removeAllChildren","enemyController","guideParent","flower","getComponent","attackFlower","GameEnd","active","isGameEnd","isStartGame","initEnemyBirthPosCurUnm","isBlock","isFirstBlock","blockLockNum","blockRest","blockIndex","restQueue","rvoRestTime","rvoRestTimeLimit","beetleIsMove","beetleIsMoveEnemy","isBeetleGuild","beetleLockNum","enemySpiderNumBig","curEnemySpiderNum","bigHp","beetleCurNum","globCoinNum","coinStartNum","g_curArea","playerLevel","instance","emit","ContinueCoin","startGame","init","setAgentDefaults","addRvoObstacle","obstacleParrent","addOneObstacle","processObstacles","update","dt","restBlock1","getEnemyList","length","getEnemyRvoList","allEnemyNumLimit","produceEnemySpider","run","beetleController","setTimeout","showBeetleBubble","creatBeetleByLevel","creatEnemyByLevel"],"mappings":"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","sourcesContent":["import { _decorator } from 'cc';\r\nimport { App } from './App';\r\nimport { Simulator } from './RVO/Simulator';\r\nimport { GlobeVariable } from './core/GlobeVariable';\r\nimport RVOObstacles from './RVO/RVOObstacles';\r\nimport { Vector2 } from './RVO/Common';\r\nimport { Flower } from './Entitys/Flower';\r\nimport { EventManager } from './core/EventManager';\r\nimport { EventType } from './core/EventType';\r\nimport { PlayerAttackFlower } from './Entitys/PlayerAttackFlower';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager {\r\n    private isStatrGame = false;\r\n    private delayedTime: number = 0.8;\r\n    private addTime: number = 0\r\n\r\n    private beetleDelayedTime: number = 0.3;\r\n    private beetleAddTime: number = 0\r\n\r\n    private blockTime: number = 0;\r\n    private blockDelayedTime: number = 1;\r\n\r\n\r\n    continueGame() {\r\n        //  this.isStatrGame = false;\r\n\r\n        this.delayedTime = 0.6;\r\n        this.addTime = 0\r\n        let characterData = App.dataManager.getCharacterById(4);\r\n        if (characterData) {\r\n            this.beetleDelayedTime = characterData.attackInterval;\r\n            this.beetleAddTime = characterData.attackInterval\r\n        }\r\n        if (characterData.maxNum != -1) {\r\n            GlobeVariable.beetleNumLimit = characterData.maxNum;\r\n        }\r\n        this.blockTime = 0;\r\n        this.blockDelayedTime = 1;\r\n\r\n        \r\n        App.mapShowController.continueGame();\r\n        App.playerController.continueGame();\r\n        App.dropController.continueGame();\r\n        App.guideManager.continueGame();\r\n        GlobeVariable.continueGame();\r\n        App.sceneNode.enemyParent.children.forEach((item) => {\r\n            item.removeFromParent();\r\n            item.destroy();\r\n        })\r\n        App.sceneNode.bloodParent.children.forEach((item) => {\r\n            item.removeFromParent();\r\n            item.destroy();\r\n        })\r\n        App.sceneNode.effectParent.children.forEach((item) => {\r\n            item.removeFromParent();\r\n            item.destroy();\r\n        })\r\n        App.sceneNode.coinParent.children.forEach((item) => {\r\n            item.removeFromParent();\r\n            item.destroy();\r\n        })\r\n        App.sceneNode.enemyParent.removeAllChildren();\r\n        App.enemyController.continueGame();\r\n        App.sceneNode.coinParent.removeAllChildren();\r\n        App.sceneNode.effectParent.removeAllChildren();\r\n        App.sceneNode.guideParent.removeAllChildren();\r\n        App.sceneNode.flower.getComponent(Flower).continueGame();\r\n        App.sceneNode.attackFlower.getComponent(PlayerAttackFlower).continueGame();\r\n        App.sceneNode.GameEnd.active = false;\r\n        GlobeVariable.isGameEnd = false;\r\n        App.sceneNode.enemyParent.active = false;\r\n        GlobeVariable.isStartGame = false;\r\n        //拦截拒马是否存在\r\n        GlobeVariable.initEnemyBirthPosCurUnm = 0;\r\n        GlobeVariable.isBlock = false;\r\n        GlobeVariable.isFirstBlock = true;\r\n        GlobeVariable.blockLockNum = 0;\r\n        GlobeVariable.blockRest = true; //拒马交付区域是否显示\r\n        GlobeVariable.blockIndex = 0;\r\n        GlobeVariable.restQueue = false;\r\n        GlobeVariable.rvoRestTime = 0.6;\r\n        GlobeVariable.rvoRestTimeLimit = 0.6;\r\n        GlobeVariable.beetleIsMove = false;\r\n        GlobeVariable.beetleIsMoveEnemy = false;\r\n        //甲虫的引导是否结束 结束第一次时候移动想镜头\r\n        GlobeVariable.isBeetleGuild = false;\r\n        GlobeVariable.beetleLockNum = 0;\r\n        GlobeVariable.enemySpiderNumBig = 10;\r\n        GlobeVariable.curEnemySpiderNum = 1;\r\n        GlobeVariable.bigHp = 5;\r\n        GlobeVariable.beetleNumLimit = 10;\r\n        GlobeVariable.beetleCurNum = 0;\r\n        GlobeVariable.globCoinNum = 0;\r\n        //金币初始数量\r\n        GlobeVariable.coinStartNum = 5;\r\n        //当前碰撞的区域\r\n        GlobeVariable.g_curArea = 1;\r\n        GlobeVariable.playerLevel = 0;\r\n        EventManager.instance.emit(EventType.ContinueCoin);\r\n\r\n        this.startGame();\r\n\r\n    }\r\n    startGame() {\r\n        App.guideManager.init();\r\n        this.isStatrGame = true;\r\n        //     App.palingAttack.setPaling(1);\r\n        Simulator.instance.setAgentDefaults(60, 3, 1, 0.1, 14, 80, new Vector2(0, 0));\r\n        this.addRvoObstacle();\r\n        let characterData = App.dataManager.getCharacterById(4);\r\n        if (characterData) {\r\n            this.beetleDelayedTime = characterData.attackInterval;\r\n            this.beetleAddTime = characterData.attackInterval;\r\n        }\r\n        if (characterData.maxNum != -1) {\r\n            GlobeVariable.beetleNumLimit = characterData.maxNum;\r\n        }\r\n\r\n    }\r\n    // 添加障碍物\r\n    addRvoObstacle() {\r\n        const obstacleParrent = App.sceneNode.obstacleParrent;\r\n        obstacleParrent.children.forEach((item) => {\r\n            RVOObstacles.addOneObstacle(item);\r\n\r\n        })\r\n\r\n        // RVOObstacles.addOneObstacle(level_1);  \r\n        Simulator.instance.processObstacles();\r\n    }\r\n    private temp = 1; //当前出生的怪物数量\r\n    update(dt: number) {\r\n        if (GlobeVariable.isGameEnd) return;\r\n        if (!GlobeVariable.blockRest) {\r\n\r\n            this.blockTime += dt;\r\n            if (this.blockTime >= this.blockDelayedTime) {\r\n                this.blockTime = 0;\r\n                GlobeVariable.blockRest = true;\r\n                App.mapShowController.restBlock1();\r\n            }\r\n\r\n        }\r\n        if (this.isStatrGame) {\r\n            this.addTime += dt;\r\n            //间隔多少秒创建一波怪\r\n            if (this.addTime >= this.delayedTime) {\r\n                this.addTime = 0;\r\n                this.temp++;\r\n                if ((App.enemyController.getEnemyList().length + App.enemyController.getEnemyRvoList().length) >= GlobeVariable.allEnemyNumLimit) return;\r\n                // if (!GlobeVariable.beetleIsMoveEnemy) {\r\n                this.produceEnemySpider();\r\n                // }\r\n\r\n            }\r\n            // rvo 更新逻辑坐标\r\n            Simulator.instance.run(dt);\r\n\r\n            App.enemyController.update(dt);\r\n            // this.playerAttackEnemy();\r\n            App.playerController.update(dt);\r\n            App.beetleController.update(dt);\r\n            App.guideManager.update(dt);\r\n        }\r\n\r\n        if (GlobeVariable.beetleIsMove) {\r\n            GlobeVariable.beetleIsMoveEnemy = true;\r\n            this.beetleAddTime += dt;\r\n            if (this.beetleAddTime >= this.beetleDelayedTime) {\r\n                this.beetleAddTime = 0;\r\n                if (GlobeVariable.beetleCurNum >= GlobeVariable.beetleNumLimit) {\r\n                    // GlobeVariable.beetleNumLimit = 10;\r\n                    GlobeVariable.beetleCurNum = 0;\r\n                    GlobeVariable.beetleIsMove = false;\r\n                    setTimeout(() => {\r\n                        App.mapShowController.showBeetleBubble();\r\n                    }, 300);\r\n                }\r\n                App.beetleController.creatBeetleByLevel();\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    produceEnemySpider() {\r\n        App.enemyController.creatEnemyByLevel(1);\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}