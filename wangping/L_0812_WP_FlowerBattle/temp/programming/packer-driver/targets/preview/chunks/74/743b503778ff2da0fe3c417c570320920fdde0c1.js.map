{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/Entitys/Flowertest.ts"],"names":["_decorator","Component","Animation","SkeletalAnimation","ParticleSystem","Material","SkinnedMeshRenderer","BooldPaling","App","GlobeVariable","GameEndManager","ccclass","property","Flowertest","type","tooltip","hp","isDie","start","init","flowerMesh","materials","materialWhite","hitAniScal","play","scheduleOnce","material0","material1","material2","booldPaling","getBloodHpMax","continueGame","flowerAni","hit","attack","subscribeBool","flowerTx","poolManager","getNode","entifyName","FlowerTx","parent","hitParticle","node","setPosition","position","active","particle","getComponent","stop","clear","removeFromParent","returnNode","getState","isPlaying","speed","getBloodHp","once","EventType","FINISHED","sceneNode","GameEnd","showGameEnd","isGameEnd","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Animation, SkeletalAnimation, ParticleSystem, Camera, Material, SkinnedMeshRenderer } from 'cc';\r\nimport { BooldPaling } from '../BooldPaling';\r\nimport { App } from '../App';\r\nimport { GlobeVariable } from '../core/GlobeVariable';\r\nimport { GameEndManager } from '../UI/GameEndManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Flowertest')\r\nexport class Flowertest extends Component {\r\n\r\n    \r\n    @property({ type: BooldPaling, tooltip: \"血条\" })\r\n    booldPaling: BooldPaling = null;\r\n\r\n    @property({ type: SkeletalAnimation, tooltip: \"动画\" })\r\n    flowerAni: SkeletalAnimation = null;\r\n\r\n    @property({ type: ParticleSystem, tooltip: \"动画\" })\r\n    hitParticle: ParticleSystem = null;\r\n\r\n    @property({ type: Animation, tooltip: \"动画\" })\r\n    hitAni: Animation = null;\r\n\r\n    @property({ type: Animation, tooltip: \"动画\" })\r\n    birthAni: Animation = null;\r\n\r\n    // @property({ type: Camera, tooltip: \"动画\" })\r\n    // birthCamera: Camera = null;\r\n\r\n\r\n    @property(Material)\r\n    material0: Material = null;\r\n\r\n    \r\n    @property(Material)\r\n    material1: Material = null;\r\n\r\n    \r\n    @property(Material)\r\n    material2: Material = null;\r\n\r\n    @property(Material)\r\n    materialWhite: Material = null;\r\n\r\n    @property(SkinnedMeshRenderer)\r\n    flowerMesh: SkinnedMeshRenderer = null;\r\n\r\n    @property({ type: Animation, tooltip: \"受击缩放动画\" })\r\n    hitAniScal: Animation = null;\r\n\r\n    private hp: number = 1000;\r\n\r\n    private isDie: boolean = false;\r\n\r\n    start() {\r\n        this.init();\r\n        this.flowerMesh.materials = [this.materialWhite, this.materialWhite, this.materialWhite];\r\n        this.hitAniScal.play(\"HitAni\");\r\n        this.scheduleOnce(() => {\r\n            this.flowerMesh.materials = [this.material0, this.material1, this.material2];\r\n        }, 0)\r\n    }\r\n\r\n    init() {\r\n        this.hp = this.booldPaling.getBloodHpMax();\r\n        this.scheduleOnce(() => {\r\n          \r\n        //    this.flowerAni.play(\"Chushi_MeiGuiHua\");\r\n        //    this.birthAni.play(\"kaichangAni\");\r\n        //   // this.birthCamera.getComponent(Animation).enabled = true;\r\n        //    this.birthAni.once(Animation.EventType.FINISHED, () => {\r\n        //      // this.birthCamera.getComponent(Animation).enabled = false;\r\n        //       //this.birthCamera.node.active = false;\r\n        //       this.flowerAni.play(\"Chushi_MeiGuiHua_reverse\");\r\n        //       this.flowerAni.once(Animation.EventType.FINISHED, () => {\r\n        //           this.flowerAni.play(\"Idel_MeiGuiHua\");\r\n        //       }, this)\r\n            \r\n        //    }, this)\r\n            \r\n        }, 0.5)\r\n        \r\n        // this.hitAni.play(\"hua\");\r\n    }\r\n  //  brithAniFuc(){\r\n        //  this.birthAni.play(\"kaichangAni\");\r\n        //  this.birthCamera.getComponent(Animation).enabled = true;\r\n        //  this.birthAni.once(Animation.EventType.FINISHED, () => {\r\n        //     this.birthCamera.getComponent(Animation).enabled = false;\r\n        //     this.birthCamera.node.active = false;\r\n        //     this.flowerAni.play(\"Chushi_MeiGuiHua_reverse\");\r\n        //     this.flowerAni.once(Animation.EventType.FINISHED, () => {\r\n        //         this.flowerAni.play(\"Idel_MeiGuiHua\");\r\n        //     }, this)\r\n          \r\n        //  }, this)\r\n   // }\r\n    continueGame() {\r\n        this.isDie = false;\r\n        this.booldPaling.continueGame();\r\n        this.hp = this.booldPaling.getBloodHpMax();\r\n        this.flowerAni.play(\"Idel_MeiGuiHua\");\r\n\r\n    }\r\n    hit(attack: number) {\r\n        this.booldPaling.subscribeBool(attack);\r\n        let flowerTx = App.poolManager.getNode(GlobeVariable.entifyName.FlowerTx);\r\n        flowerTx.parent = this.hitParticle.node.parent\r\n        flowerTx.setPosition(this.hitParticle.node.position);\r\n        flowerTx.active = true;\r\n        let particle = flowerTx.getComponent(ParticleSystem);\r\n        if (particle)\r\n            particle.play()\r\n\r\n        this.scheduleOnce(() => {\r\n            if (particle) {\r\n                // 1. 停止粒子播放\r\n                particle.stop();\r\n                // 3. 可选：手动清除所有粒子（根据引擎特性）\r\n                particle.clear();\r\n                flowerTx.active = false;\r\n                flowerTx.removeFromParent()\r\n                App.poolManager.returnNode(flowerTx, GlobeVariable.entifyName.FlowerTx);\r\n            }\r\n\r\n\r\n        }, 1.5)\r\n        this.flowerMesh.materials = [this.materialWhite, this.materialWhite, this.materialWhite];\r\n        this.hitAniScal.play(\"HitAni\");\r\n        this.scheduleOnce(() => {\r\n            this.flowerMesh.materials = [this.material0, this.material1, this.material2];\r\n        }, 0.1)\r\n        // if (this.booldPaling.getBloodHp() > this.hp / 2) {\r\n        //     this.flowerAni.getState(\"Idel_MeiGuiHua\").speed = 2;\r\n        //     this.scheduleOnce(() => {\r\n        //         this.flowerAni.getState(\"Idel_MeiGuiHua\").speed = 1;\r\n        //     }, 0.5)\r\n        // }\r\n        if (this.flowerAni.getState(\"Idel_MeiGuiHua\").isPlaying) {\r\n            this.flowerAni.getState(\"Idel_MeiGuiHua\").speed = 2;\r\n            this.scheduleOnce(() => {\r\n                this.flowerAni.getState(\"Idel_MeiGuiHua\").speed = 1;\r\n            }, 0.5)\r\n        } else if (this.flowerAni.getState(\"Idel_DieAway_MeiGuiHua\").isPlaying) {\r\n            this.flowerAni.getState(\"Idel_DieAway_MeiGuiHua\").speed = 3;\r\n            this.scheduleOnce(() => {\r\n                this.flowerAni.getState(\"Idel_DieAway_MeiGuiHua\").speed = 1;\r\n            }, 0.5)\r\n        }\r\n        if (this.booldPaling.getBloodHp() == this.hp / 2) {\r\n            this.flowerAni.play(\"DieAway_MeiGuiHua\");\r\n            this.scheduleOnce(() => {\r\n                this.flowerAni.play(\"Idel_DieAway_MeiGuiHua\");\r\n            }, 1.5)\r\n        } else if (this.booldPaling.getBloodHp() <= 0 && !this.isDie) {\r\n            this.isDie = true\r\n            this.flowerAni.play(\"Die_MeiGuiHua\");\r\n            this.flowerAni.once(Animation.EventType.FINISHED, () => {\r\n                App.sceneNode.GameEnd.active = true;\r\n                App.sceneNode.GameEnd.getComponent(GameEndManager).showGameEnd(0);\r\n                GlobeVariable.isGameEnd = true;\r\n\r\n            }, this);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}