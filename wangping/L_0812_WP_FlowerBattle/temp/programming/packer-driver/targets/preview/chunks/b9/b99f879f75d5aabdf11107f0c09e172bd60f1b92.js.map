{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/core/CameraMain.ts"],"names":["_decorator","Camera","Component","Node","v3","Vec3","GlobeVariable","ccclass","property","tempPos","tempCurrentPos","CameraMain","initialDirection","start","init","target","subtract","node","worldPosition","isCameraMove","update","dt","camera","add","getWorldPosition","lerp","smoothFactor","setWorldPosition"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAmBC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,I,OAAAA,I;;AACtDC,MAAAA,a,iBAAAA,a;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U,GAE9B;;AACIS,MAAAA,O,GAAgBL,EAAE,E;AAClBM,MAAAA,c,GAAuBN,EAAE,E;;4BAEhBO,U,WADZJ,OAAO,CAAC,YAAD,C,UAIHC,QAAQ,CAACL,IAAD,C,UAGRK,QAAQ,CAACP,MAAD,C,2BAPb,MACaU,UADb,SACgCT,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAUT;AAVS,eAYtCU,gBAZsC,GAYbR,EAAE,EAZW;AAAA;;AActCS,QAAAA,KAAK,GAAG,CACJ;AACH;;AAEDC,QAAAA,IAAI,GAAG;AACH,cAAI,KAAKC,MAAT,EAAiB;AACbV,YAAAA,IAAI,CAACW,QAAL,CAAc,KAAKJ,gBAAnB,EAAqC,KAAKK,IAAL,CAAUC,aAA/C,EAA8D,KAAKH,MAAL,CAAYG,aAA1E;AACA;AAAA;AAAA,gDAAcC,YAAd,GAA6B,IAA7B;AACH;AACJ;;AAEDC,QAAAA,MAAM,CAACC,EAAD,EAAa;AACf,cAAI;AAAA;AAAA,8CAAcF,YAAd,IAA8B,KAAKJ,MAAnC,IAA6C,KAAKO,MAAtD,EAA8D;AAC1D;AACAjB,YAAAA,IAAI,CAACkB,GAAL,CAASd,OAAT,EAAkB,KAAKM,MAAL,CAAYG,aAA9B,EAA6C,KAAKN,gBAAlD,EAF0D,CAI1D;;AACA,iBAAKU,MAAL,CAAYL,IAAZ,CAAiBO,gBAAjB,CAAkCd,cAAlC,EAL0D,CAO1D;;AACAL,YAAAA,IAAI,CAACoB,IAAL,CAAUf,cAAV,EAA0BA,cAA1B,EAA0CD,OAA1C,EAAmD,KAAKiB,YAAxD,EAR0D,CAU1D;;AACA,iBAAKJ,MAAL,CAAYL,IAAZ,CAAiBU,gBAAjB,CAAkCjB,cAAlC;AACH;AACJ;;AAvCqC,O;;;;;iBAIhB,I;;;;;;;iBAGE,I;;uFAEvBF,Q;;;;;iBACsB,G","sourcesContent":["import { _decorator, Camera, Component, Node, Quat, tween, v3, Vec3 } from 'cc';\r\nimport { GlobeVariable } from './GlobeVariable';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n//let tempPos: Vec3 = v3();\r\nlet tempPos: Vec3 = v3();\r\nlet tempCurrentPos: Vec3 = v3();\r\n@ccclass('CameraMain')\r\nexport class CameraMain extends Component {\r\n\r\n\r\n    @property(Node)\r\n    target: Node | null = null;\r\n\r\n    @property(Camera)  // 修复缺少@符号的问题\r\n    camera: Camera | null = null;\r\n\r\n    @property\r\n    smoothFactor: number = 0.8;  // 平滑因子，值越小过渡越平滑\r\n\r\n    initialDirection: Vec3 = v3();\r\n\r\n    start() {\r\n        // Vec3.subtract(this.initialDirection, this.node.worldPosition, this.target!.worldPosition);\r\n    }\r\n\r\n    init() {\r\n        if (this.target) {\r\n            Vec3.subtract(this.initialDirection, this.node.worldPosition, this.target.worldPosition);\r\n            GlobeVariable.isCameraMove = true;\r\n        }\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (GlobeVariable.isCameraMove && this.target && this.camera) {\r\n            // 计算目标位置\r\n            Vec3.add(tempPos, this.target.worldPosition, this.initialDirection);\r\n\r\n            // 获取当前相机位置\r\n            this.camera.node.getWorldPosition(tempCurrentPos);\r\n\r\n            // 使用线性插值平滑过渡到目标位置\r\n            Vec3.lerp(tempCurrentPos, tempCurrentPos, tempPos, this.smoothFactor);\r\n\r\n            // 设置相机位置\r\n            this.camera.node.setWorldPosition(tempCurrentPos);\r\n        }\r\n    }\r\n}\r\n"]}