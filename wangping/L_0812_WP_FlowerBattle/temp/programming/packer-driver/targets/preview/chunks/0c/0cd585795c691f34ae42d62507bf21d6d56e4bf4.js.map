{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/UI/CoinComponent.ts"],"names":["_decorator","Color","Component","Label","Node","tween","Vec3","EventManager","EventType","GlobeVariable","ccclass","property","CoinComponent","_coinNum","_breathTween","start","coinStartNum","updateCoinNum","onEnable","instance","on","CoinAdd","coinAdd","CoinSub","coinSub","ContinueCoin","continueCoin","onDisable","off","num","playBreathAni","coinNum","string","String","Math","max","isAdd","stop","color","fromHEX","tweenAni","breathNode","to","scale","easing","call"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Color, color, Component, instantiate, Label, Node, Quat, Tween, tween,  Vec3, } from 'cc';\r\nimport { EventManager } from '../core/EventManager';\r\nimport { EventType } from '../core/EventType';\r\nimport { GlobeVariable } from '../core/GlobeVariable';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CoinComponent')\r\nexport class CoinComponent extends Component {\r\n\r\n    @property(Label)\r\n    coinNum: Label = null;\r\n\r\n    @property(Node)\r\n    breathNode: Node = null;\r\n\r\n    private _coinNum:number = 0;\r\n\r\n\r\n\r\n    private _breathTween: Tween<Node> | null = null;\r\n\r\n    start() {\r\n        this._coinNum =GlobeVariable.coinStartNum;\r\n        this.updateCoinNum();\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventManager.instance.on(EventType.CoinAdd, this.coinAdd, this);\r\n        EventManager.instance.on(EventType.CoinSub, this.coinSub, this);\r\n        EventManager.instance.on(EventType.ContinueCoin, this.continueCoin, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventManager.instance.off(EventType.CoinAdd, this.coinAdd, this);\r\n        EventManager.instance.off(EventType.CoinSub, this.coinSub, this);\r\n        EventManager.instance.off(EventType.ContinueCoin, this.continueCoin, this);\r\n    }\r\n\r\n    private continueCoin() {\r\n        this._coinNum = GlobeVariable.coinStartNum;\r\n        this.updateCoinNum();\r\n    }\r\n\r\n    private coinAdd(num:number) {\r\n        this._coinNum += num;\r\n        this.updateCoinNum();\r\n        this.playBreathAni(true);\r\n    }\r\n\r\n    private coinSub(num:number) {\r\n        this._coinNum -= num;\r\n        this.updateCoinNum();\r\n        this.playBreathAni(false);\r\n    }\r\n\r\n    private updateCoinNum() {\r\n\r\n        this.coinNum.string = String(Math.max(0, this._coinNum));\r\n    }\r\n\r\n    // 公用呼吸动画方法（防叠加）\r\n    private playBreathAni(isAdd:boolean) {\r\n        if (this._breathTween) {\r\n            this._breathTween.stop(); // 停止之前的动画\r\n        }\r\n        if(isAdd){\r\n            this.coinNum.color = new Color().fromHEX('#00ff00');\r\n        }else{\r\n            this.coinNum.color = new Color().fromHEX('#ff0000');\r\n        }\r\n        const tweenAni = tween(this.breathNode)\r\n            .to(0.08, { scale: new Vec3(1.1, 1.1, 1.1) }, { easing: 'quadOut' })\r\n            .to(0.08, { scale: new Vec3(1, 1, 1) }, { easing: 'quadIn' })\r\n            .call(()=>{\r\n                this.coinNum.color = new Color().fromHEX('#FFFFFF');\r\n            })\r\n            .start();\r\n\r\n        this._breathTween = tweenAni;\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}