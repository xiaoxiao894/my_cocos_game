{"version":3,"sources":["file:///D:/Cocos/PlayAble/L_0812_WP_FlowerBattle/assets/JavaScript/UI/GameEndManager.ts"],"names":["_decorator","Component","Label","Node","tween","UIOpacity","Vec3","super_html_playable","SoundManager","LanguageManager","App","ccclass","property","GameEndManager","type","updateLabelText","node","label","getChildByName","getComponent","text","t","string","start","active","init","playFingerAndButtonAnim","download","download1","continue","Instance","playAudio","showGameEnd","hand","setPosition","opacityCom","bg","addComponent","opacity","to","icon","setScale","scale","delay","call","repeatForever","platformBtnEvent","console","log","continueGame","gameManager"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, tween, UIOpacity, Vec3 } from 'cc';\r\nimport super_html_playable from '../core/super_html_playable';\r\nimport { SoundManager } from '../core/SoundManager';\r\nimport { LanguageManager } from '../Language/LanguageManager';\r\nimport { App } from '../App';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameEndManager')\r\nexport class GameEndManager extends Component {\r\n    @property(Node)\r\n    bg: Node = null;\r\n\r\n    @property(Node)\r\n    icon: Node = null;\r\n\r\n    @property(Node)\r\n    download: Node = null;\r\n\r\n    @property(Node)\r\n    download1: Node = null;\r\n\r\n    @property(Node)\r\n    continue: Node = null;\r\n\r\n    // @property(Node)\r\n    // win: Node = null;\r\n\r\n    @property(Node)\r\n    hand: Node = null;\r\n\r\n    private type: number = 1;\r\n\r\n    start() {\r\n\r\n        this.node.active = false;\r\n        this.init();\r\n        this.playFingerAndButtonAnim();\r\n        // 调用函数处理各个节点\r\n        this.updateLabelText(this.download);\r\n        this.updateLabelText(this.download1);\r\n        this.updateLabelText(this.continue);\r\n        if (this.type == 1) {\r\n            this.download1.active = false;\r\n            this.continue.active = false;\r\n            this.download.active = true;\r\n            SoundManager.Instance.playAudio(\"win\");\r\n        } else {\r\n            this.download.active = false;\r\n            this.continue.active = true;\r\n            this.download1.active = true;\r\n            SoundManager.Instance.playAudio(\"fail\");\r\n        }\r\n        \r\n    }\r\n    showGameEnd(type: number = 1) {\r\n        this.node.active = true;\r\n        this.type = type;\r\n        if (type == 1) {\r\n            this.download1.active = false;\r\n            this.continue.active = false;\r\n            this.download.active = true;\r\n            SoundManager.Instance.playAudio(\"win\");\r\n        } else {\r\n            this.download.active = false;\r\n            this.continue.active = true;\r\n            this.download1.active = true;\r\n            SoundManager.Instance.playAudio(\"fail\");\r\n        }\r\n        if(this.type == 1){\r\n            this.hand.setPosition(new Vec3(117.659, -281.833, 0));\r\n        }else{\r\n            this.hand.setPosition(new Vec3(248.414, -281.833, 0));\r\n        }\r\n    }\r\n    // 封装处理标签语言转换的函数\r\n    updateLabelText = (node) => {\r\n        if (!node) return;\r\n\r\n        const label = node.getChildByName(\"Label\")?.getComponent(Label);\r\n        if (label) {\r\n            const text = LanguageManager.t(label.string);\r\n            if (text) label.string = text;\r\n        }\r\n    };\r\n\r\n    init() {\r\n        this.hand.active = false;\r\n        this.node.active = true;\r\n        if(this.type == 1){\r\n            this.hand.setPosition(new Vec3(117.659, -281.833, 0));\r\n        }else{\r\n            this.hand.setPosition(new Vec3(248.414, -281.833, 0));\r\n        }\r\n        // 背景淡入\r\n        const opacityCom = this.bg.getComponent(UIOpacity) || this.bg.addComponent(UIOpacity);\r\n        opacityCom.opacity = 0;\r\n        tween(opacityCom)\r\n            .to(0.1, { opacity: 150 })\r\n            .start();\r\n\r\n        // 初始缩放\r\n        this.icon.setScale(0, 0, 0);\r\n        this.download.setScale(0, 1, 1);\r\n\r\n        tween(this.icon)\r\n            .to(0.25, { scale: new Vec3(1.2, 1.2, 1.2) })\r\n            .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n            .start();\r\n\r\n        tween(this.download)\r\n            .delay(0.25)\r\n            .to(0.25, { scale: new Vec3(1.1, 1.1, 1.1) })\r\n            .to(0.3, { scale: new Vec3(1, 1, 1) })\r\n            .call(\r\n                () => {\r\n                    this.hand.active = true;\r\n                }\r\n            )\r\n            .start();\r\n\r\n    }\r\n\r\n    // 手指+按钮循环提示动画\r\n    playFingerAndButtonAnim() {\r\n        // this.hand.active = true;\r\n        // 手指动画（0.9 -> 1 循环）\r\n        tween(this.hand)\r\n            .repeatForever(\r\n                tween()\r\n                    .to(0.3, { scale: new Vec3(0.4, 0.4, 0.4) })\r\n                    .to(0.3, { scale: new Vec3(0.5, 0.5, 0.5) })\r\n            )\r\n            .start();\r\n    }\r\n    platformBtnEvent() {\r\n        console.log(\"点击下载\");\r\n        super_html_playable.download();\r\n    }\r\n\r\n    continueGame() {\r\n        console.log(\"从新开始游戏\");\r\n        App.gameManager.continueGame();\r\n        this.type = 1;\r\n    }\r\n}\r\n\r\n\r\n"]}