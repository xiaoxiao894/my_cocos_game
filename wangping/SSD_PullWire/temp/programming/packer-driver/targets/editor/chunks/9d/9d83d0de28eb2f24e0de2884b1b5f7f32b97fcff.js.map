{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_PullWire/assets/JavaScript/Guide/ArrowItem.ts"],"names":["_decorator","Component","Node","tween","v3","Vec3","EventManager","EventName","ccclass","property","ArrowItem","_targetVec","_heightOffset","_selfEulerY","_rotateSpeed","_isTweeningShow","_isTweeningHide","_isArrowVisible","start","onEnable","inst","on","ArrowTargetVectorUpdate","updateTargetVec","onDisable","off","update","dt","time","Date","now","speed","amplitude","floatY","Math","sin","arrow","setWorldPosition","x","y","z","setRotationFromEuler","playScaleTween","active","setScale","to","scale","easing","call","console","log","stopScaleTween","pos"],"mappings":"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","sourcesContent":["import { _decorator, BatchingUtility, Component, Node, tween, v3, Vec3 } from 'cc';\r\nimport { EventManager } from '../Global/EventManager';\r\nimport { EventName } from '../Common/Enum';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ArrowItem')\r\nexport class ArrowItem extends Component {\r\n    \r\n    private _targetVec: Vec3 = null;\r\n    private readonly _heightOffset: number = 4;\r\n    private _selfEulerY: number = 0;\r\n    private readonly _rotateSpeed: number = 140;\r\n\r\n    private _isTweeningShow: boolean = false;\r\n    private _isTweeningHide: boolean = false;\r\n    private _isArrowVisible: boolean = false;\r\n\r\n    @property(Node)\r\n    arrow:Node = null;\r\n\r\n    start() {\r\n        \r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventManager.inst.on(EventName.ArrowTargetVectorUpdate, this.updateTargetVec, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventManager.inst.off(EventName.ArrowTargetVectorUpdate, this.updateTargetVec, this);\r\n    }\r\n\r\n    update(dt: number) {\r\n        if(!this._targetVec){\r\n            return;\r\n        }\r\n        const time = Date.now();\r\n        const speed = 0.05;\r\n        const amplitude = 0.5;\r\n        const floatY = Math.sin(time*0.1 * speed) * amplitude;\r\n\r\n        this.arrow.setWorldPosition(new Vec3(\r\n            this._targetVec.x,\r\n            this._targetVec.y + this._heightOffset + floatY,\r\n            this._targetVec.z\r\n        ));\r\n        this._selfEulerY += this._rotateSpeed * dt;\r\n        this._selfEulerY %= 360;\r\n        this.arrow.setRotationFromEuler(180, this._selfEulerY, 0);\r\n\r\n        if(!this._isTweeningShow&&!this._isTweeningHide&&!this._isArrowVisible&&this._targetVec){\r\n            this.playScaleTween();\r\n        }\r\n        //console.log(\"_targetVec\",this._targetVec);\r\n\r\n\r\n    }\r\n\r\n    playScaleTween() {\r\n        if (this._isTweeningShow||this._isTweeningHide) return;\r\n        this.arrow.active = true;\r\n        this._isTweeningShow = true;\r\n        this._isArrowVisible = true;\r\n        this.arrow.setScale(v3(0.1, 0.1, 0.1));\r\n        tween(this.arrow)\r\n            .to(0.25, { scale: v3(3.2, 3.2, 3.2) }, { easing: 'quadOut' })\r\n            .to(0.15, { scale: v3(3, 3, 3) }, { easing: 'quadIn' })\r\n            .call(() => {\r\n                this._isTweeningShow = false;\r\n                console.log(\"playScaleTween\",this.arrow.scale);\r\n            })\r\n            .start();\r\n    }\r\n\r\n    stopScaleTween() {\r\n        if (this._isTweeningShow || this._isTweeningHide) return;\r\n\r\n        this._isTweeningHide = true;\r\n\r\n        tween(this.arrow)\r\n            .to(0.25, { scale: v3(0, 0, 0) }, {\r\n                easing: 'quadOut'\r\n            })\r\n            .call(\r\n                () => {\r\n                    this._isTweeningHide = false;\r\n                    this._isArrowVisible = false;\r\n                    this.arrow.active =false;\r\n                    console.log(\"stopScaleTween\",this.arrow.scale);\r\n                }\r\n            )\r\n            .start();\r\n    }\r\n\r\n    /** 更新目标位置 */\r\n    private updateTargetVec(pos:Vec3){\r\n        this._targetVec = pos;\r\n        if(this._isArrowVisible){\r\n            this.stopScaleTween();\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}