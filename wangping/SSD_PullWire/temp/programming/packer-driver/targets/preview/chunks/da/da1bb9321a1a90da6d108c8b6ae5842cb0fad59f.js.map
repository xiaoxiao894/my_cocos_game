{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_PullWire/assets/JavaScript/core/MapBeastB/MapBeastB.ts"],"names":["_decorator","Component","Node","SkeletalAnimation","Vec3","Animation","tween","eventMgr","EventType","CloudEffct","coinEffect","DataManager","CloudParticleEffect","ccclass","property","MapBeastB","isStart","isDrumAni","drumDuration","drumTime","coinNum","mapCoinNum","playPalingAnimation","start","palingNode","getComponent","animState","getState","defaultClip","name","time","sample","pause","onInitEvent","on","MapBeastB_start","MapBeastBStart","MapBeastB_cloudFadeOut","beastBFadeOut","MapBeastB_cloudFadeIn","beastBFadeIn","MapBeastB1_cloudFadeOut","beastBFadeOutOneOne","MapBeastB1_cloudFadeIn","beastBFadeInOneOne","onLoad","initPaling","cloudParticleOuter","cloudFadeEffct","cloudParticleCentrality","cloudParticleOuter1","cloudParticleCentrality1","isFade","cloudNode","siblings","children","length","console","warn","forEach","sibling","index","startEffect","Instance","soundManager","playSocketSound","scheduleOnce","playElectricSound","playLockSound","addCoin","palingEffctCallBack","allEffect","mapEffect","play","oilPump","levelUp","active","anim","once","FINISHED","playUpgradeSound","levelUpParticle","animParticle","mapCoinNode","setCoinNum","playEffect","beastContainer","mainCamera","node","to","worldPosition","call","palingEffctTo","playPalingSound","update","deltaTime","oilAnimation","coinNode"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, SkeletalAnimation, Vec3, Animation, tween } from 'cc';\r\nimport { GroundParent } from '../GroundParent';\r\nimport { eventMgr } from '../EventManager';\r\nimport { EventType } from '../EventType';\r\nimport { PalingAnimation } from '../PalingAnimation';\r\nimport { MapBeast } from '../MapBeast/MapBeast';\r\nimport { EnemyBase } from '../MapBeast/EnemyBase';\r\nimport { CloudEffct } from '../CloudEffct';\r\nimport { OilDrumEffect } from '../MapBeast/OilDrumEffect';\r\nimport { coinEffect } from '../coinEffect';\r\nimport { DataManager } from '../../Global/DataManager';\r\nimport { CloudParticleEffect } from '../CloudParticleEffect';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MapBeastB')\r\nexport class MapBeastB extends Component {\r\n\r\n    @property(Node)\r\n    protected palingNode: Node = null;\r\n    @property(Node)\r\n    protected palingRight: Node = null;\r\n    @property(Node)\r\n    protected palingLeft: Node = null;\r\n    @property(Node)\r\n    protected palingUp: Node = null;\r\n    @property(Node)\r\n    protected palingDown: Node = null;\r\n\r\n    @property(Node)\r\n    protected beastContainer: Node = null;\r\n\r\n    @property(Animation)\r\n    protected oilAnimation: Animation = null;\r\n\r\n    @property(Node)\r\n    protected oilPump: Node = null;\r\n\r\n\r\n    @property(Node)\r\n    singleShowPaling: Node = null; //单独显示的栅栏\r\n\r\n    // @property(Node)\r\n    // cloudNode: Node = null;\r\n\r\n    // @property(Node)\r\n    // cloudNode1: Node = null;\r\n\r\n    @property(Node)\r\n    coinNode: Node = null;\r\n\r\n    @property(Node)\r\n    levelUp: Node = null;\r\n\r\n    @property(Node)\r\n    levelUpParticle: Node = null;\r\n\r\n    @property(Animation)\r\n    mapEffect: Animation = null;\r\n\r\n\r\n    @property(CloudParticleEffect)\r\n    cloudParticleOuter: CloudParticleEffect = null;\r\n    @property(CloudParticleEffect)\r\n    cloudParticleCentrality: CloudParticleEffect = null;\r\n\r\n    @property(CloudParticleEffect)\r\n    cloudParticleOuter1: CloudParticleEffect = null;\r\n    @property(CloudParticleEffect)\r\n    cloudParticleCentrality1: CloudParticleEffect = null;\r\n\r\n    private isStart: boolean = false;\r\n\r\n    private isDrumAni = false;//是否开始油桶的动画事件\r\n    private drumDuration = 2.6;//持续多少秒\r\n    private drumTime: number = 0;//累计时间\r\n    private coinNum: number = 10;\r\n\r\n    @property(Node)\r\n    mapCoinNode: Node = null;\r\n    private mapCoinNum: number = 300;\r\n\r\n    private playPalingAnimation: Animation = null;\r\n    start() {\r\n        this.playPalingAnimation = this.palingNode.getComponent(Animation)\r\n        const animState = this.playPalingAnimation.getState(this.playPalingAnimation.defaultClip.name);\r\n        if (animState) {\r\n            animState.time = 0;    // 设置到第一帧\r\n            animState.sample();    // 采样当前时间帧\r\n            this.playPalingAnimation.pause(); // 暂停动画，停留在第一帧\r\n        }\r\n    }\r\n    //初始化事件\r\n    onInitEvent() {\r\n        //云的的事件监听\r\n        eventMgr.on(EventType.MapBeastB_start, this.MapBeastBStart, this);\r\n        eventMgr.on(EventType.MapBeastB_cloudFadeOut, this.beastBFadeOut, this);\r\n        eventMgr.on(EventType.MapBeastB_cloudFadeIn, this.beastBFadeIn, this);\r\n        //第二个云\r\n        eventMgr.on(EventType.MapBeastB1_cloudFadeOut, this.beastBFadeOutOneOne, this);\r\n        eventMgr.on(EventType.MapBeastB1_cloudFadeIn, this.beastBFadeInOneOne, this);\r\n\r\n    }\r\n\r\n    onLoad(): void {\r\n        this.onInitEvent();\r\n        this.initPaling();\r\n    }\r\n\r\n    beastBFadeOut() {\r\n        if (this.isStart) {\r\n            return;\r\n        }\r\n        this.cloudParticleOuter.cloudFadeEffct(false)\r\n        this.cloudParticleCentrality.cloudFadeEffct(false)\r\n        //this.cloudFadeEffct(false, this.cloudNode)\r\n\r\n    }\r\n    beastBFadeIn() {\r\n        if (this.isStart) {\r\n            return;\r\n        }\r\n        this.cloudParticleOuter.cloudFadeEffct(true)\r\n        this.cloudParticleCentrality.cloudFadeEffct(true)\r\n        //this.cloudFadeEffct(true, this.cloudNode)\r\n    }\r\n    beastBFadeOutOneOne() {\r\n        if (this.isStart) {\r\n            return;\r\n        }\r\n        this.cloudParticleOuter1.cloudFadeEffct(false)\r\n        this.cloudParticleCentrality1.cloudFadeEffct(false)\r\n        //this.cloudFadeEffct(false, this.cloudNode1)\r\n    }\r\n    beastBFadeInOneOne() {\r\n        if (this.isStart) {\r\n            return;\r\n        }\r\n        this.cloudParticleOuter1.cloudFadeEffct(true)\r\n        this.cloudParticleCentrality1.cloudFadeEffct(true)\r\n        // this.cloudFadeEffct(true, this.cloudNode1)\r\n    }\r\n    cloudFadeEffct(isFade: boolean, cloudNode: Node) {\r\n        let siblings = cloudNode.children;\r\n        if (siblings.length === 0) {\r\n            console.warn(\"当前云节点没有子节点\");\r\n            return;\r\n        }\r\n        // 遍历并处理同级节点\r\n        siblings.forEach((sibling, index) => {\r\n            sibling.getComponent(CloudEffct).startEffect(isFade);\r\n        });\r\n    }\r\n    MapBeastBStart() {\r\n        this.cloudParticleOuter.cloudFadeEffct(false)\r\n        this.cloudParticleCentrality.cloudFadeEffct(false)\r\n        DataManager.Instance.soundManager.playSocketSound();\r\n        this.scheduleOnce(() => {\r\n            DataManager.Instance.soundManager.playElectricSound();\r\n            DataManager.Instance.soundManager.playLockSound();\r\n        }, 0.6)\r\n\r\n        this.scheduleOnce(() => {\r\n            DataManager.Instance.addCoin(this.mapCoinNum);\r\n        }, 0.4)\r\n        this.palingEffctCallBack();\r\n\r\n\r\n\r\n    }\r\n    allEffect() {\r\n\r\n        this.mapEffect.play();\r\n        if (this.isStart) return\r\n        this.isStart = true;\r\n        //this.cloudFadeEffct(false, this.cloudNode1)\r\n        this.cloudParticleOuter1.cloudFadeEffct(false)\r\n        this.cloudParticleCentrality1.cloudFadeEffct(false)\r\n\r\n        this.scheduleOnce(() => {\r\n            this.oilPump.getComponent(SkeletalAnimation).play();\r\n        }, 1)\r\n        // this.scheduleOnce(() => {\r\n        //升级特效\r\n        this.levelUp.active = true;\r\n        const anim = this.levelUp.getComponent(Animation);\r\n        anim.play()\r\n        anim.once(Animation.EventType.FINISHED, () => {\r\n            this.levelUp.active = false;\r\n        }, this);\r\n        //升级粒子特效\r\n        DataManager.Instance.soundManager.playUpgradeSound();\r\n        this.levelUpParticle.active = true;\r\n        const animParticle = this.levelUpParticle.getComponent(Animation);\r\n        this.scheduleOnce(() => {\r\n            animParticle.play()\r\n        }, 0.06)\r\n        // animParticle.play()\r\n        animParticle.once(Animation.EventType.FINISHED, () => {\r\n            this.levelUpParticle.active = false;\r\n\r\n        }, this);\r\n        this.scheduleOnce(() => {\r\n            this.mapCoinNode.getComponent(coinEffect).setCoinNum(this.mapCoinNum);\r\n            this.mapCoinNode.getComponent(coinEffect).playEffect();\r\n\r\n        }, 0.3)\r\n        //}, 1.5);\r\n        // this.scheduleOnce(() => {\r\n\r\n        //     this.singleShowPaling.active = true;\r\n        //     this.singleShowPaling.getComponent(PalingAnimation).startBounce();\r\n        // }, 1.2)\r\n        this.scheduleOnce(() => {\r\n            this.beastContainer.active = true;\r\n        }, 2)\r\n        this.isDrumAni = true;\r\n        this.scheduleOnce(() => {\r\n            //摄像机移动\r\n            tween(DataManager.Instance.mainCamera.node)\r\n                .to(0.8, { worldPosition: new Vec3(0.014142, 34.1, 37.250385) })\r\n                .call(() => {\r\n                    //this._upgraded = true;\r\n                })\r\n                .start();\r\n\r\n        }, 1)\r\n    }\r\n    /**\r\n     * 关于木栅栏的操作\r\n     */\r\n    initPaling() {\r\n        // this.palingRight.active = false;\r\n        // this.palingDown.active = false;\r\n        // this.palingUp.active = true;\r\n        // this.palingLeft.active = false;\r\n\r\n    }\r\n    async palingEffctTo() {\r\n        // 获取动画组件\r\n        // const leftAnimation = this.palingLeft.getComponent(PalingAnimation);\r\n        // const rightAnimation = this.palingRight.getComponent(PalingAnimation);\r\n        // this.palingUp.getComponent(PalingAnimation).startMoveDown();\r\n        // 同时启动两个动画，并等待它们都完成\r\n        // await Promise.all([\r\n        //     leftAnimation.startAnimation(),\r\n        //     rightAnimation.startAnimation()\r\n        // ]);\r\n    }\r\n    async palingEffctCallBack() {\r\n        // this.palingRight.active = true;\r\n        // this.palingDown.active = true;\r\n        // this.palingUp.active = true;\r\n        // this.palingLeft.active = true;\r\n        DataManager.Instance.soundManager.playPalingSound();\r\n        let anim = this.palingNode.getComponent(Animation)\r\n        anim.play()\r\n        anim.once(Animation.EventType.FINISHED, () => {\r\n\r\n        })\r\n        this.scheduleOnce(() => {\r\n            this.allEffect();\r\n        }, 0.48)\r\n        // await this.palingEffctTo();\r\n\r\n        // this.palingDown.getComponent(PalingAnimation).startBounce();\r\n    }\r\n    update(deltaTime: number) {\r\n        if (this.isDrumAni) {\r\n            this.drumTime += deltaTime;\r\n            if (this.drumTime >= this.drumDuration) {\r\n                this.drumTime = 0;\r\n                //this.oilNode.getComponent(OilDrumEffect).showChildrenSequentially();\r\n                if (this.oilAnimation.node.active == false) {\r\n                    this.oilAnimation.node.active = true;\r\n                }\r\n\r\n                this.oilAnimation.play();\r\n                this.scheduleOnce(() => {\r\n                    this.coinNode.getComponent(coinEffect).setCoinNum(this.coinNum)\r\n                    this.coinNode.getComponent(coinEffect).playEffect();\r\n                }, 2.4)\r\n\r\n                DataManager.Instance.addCoin(this.coinNum);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}