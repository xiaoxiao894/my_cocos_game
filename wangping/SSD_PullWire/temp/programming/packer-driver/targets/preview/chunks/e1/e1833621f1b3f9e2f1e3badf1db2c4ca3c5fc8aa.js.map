{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_PullWire/assets/JavaScript/core/coinEffect.ts"],"names":["_decorator","Color","Component","Label","Sprite","tween","Vec3","ccclass","property","coinEffect","type","displayName","_opacity","currentTween","start","reset","setCoinNum","num","coinLabel","string","toString","stop","node","setPosition","startPosition","setOpacity","value","coinSprite","color","playEffect","originalPos","position","clone","originalScale","scale","x","y","z","call","parallel","to","fadeInDuration","firstRiseDistance","onUpdate","target","ratio","Math","floor","delay","pauseDuration","fadeOutDuration","secondRiseDistance","opacity"],"mappings":"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","sourcesContent":["\r\n// import { _decorator, Color, Component, Label, Node, Sprite, tween, Vec3 } from 'cc';\r\n// const { ccclass, property } = _decorator;\r\n\r\n// @ccclass('coinEffect')\r\n// export class coinEffect extends Component {\r\n//     @property(Sprite)\r\n//     coinSprite: Sprite = null;\r\n\r\n//     @property(Label)\r\n//     coinLabel: Label = null;\r\n\r\n//     // 动画参数\r\n//     @property({ type: Vec3, displayName: '初始位置' })\r\n//     startPosition: Vec3 = new Vec3(0, 0, 0);\r\n\r\n//     @property({ displayName: '第一阶段上升距离' })\r\n//     firstRiseDistance: number = 1.5;\r\n\r\n//     @property({ displayName: '第二阶段上升距离' })\r\n//     secondRiseDistance: number = 2;\r\n\r\n//     @property({ displayName: '淡入时间(秒)' })\r\n//     fadeInDuration: number = 1.0;\r\n\r\n//     @property({ displayName: '停顿时间(秒)' })\r\n//     pauseDuration: number = 1;\r\n\r\n//     @property({ displayName: '淡出时间(秒)' })\r\n//     fadeOutDuration: number = 1;\r\n\r\n//     // 显式声明opacity属性\r\n//     private _opacity: number = 0;\r\n\r\n//     start() {\r\n//         this.reset();\r\n//         //this.playEffect();\r\n//     }\r\n\r\n//     reset() {\r\n//         this.node.setPosition(this.startPosition);\r\n//         this.setOpacity(0);\r\n//     }\r\n\r\n//     setOpacity(value: number) {\r\n//         if (this.coinSprite) this.coinSprite.color = new Color(255, 255, 255, value);\r\n//         if (this.coinLabel) this.coinLabel.color = new Color(255, 255, 255, value);\r\n//     }\r\n\r\n//     playEffect() {\r\n//         const originalPos = this.node.position.clone();\r\n\r\n//         tween(this.node)\r\n//             .call(() => this.setOpacity(0))\r\n\r\n//             // 第一阶段：同时淡入和上升第一部分距离\r\n//             .parallel(\r\n//                 tween(this.node)\r\n//                     .to(this.fadeInDuration, { \r\n//                         position: new Vec3(\r\n//                             originalPos.x, \r\n//                             originalPos.y + this.firstRiseDistance, \r\n//                             originalPos.z\r\n//                         ) \r\n//                     }),\r\n//                 tween(this as any) // 添加类型断言\r\n//                     .to(this.fadeInDuration, { _opacity: 255 }, {\r\n//                         onUpdate: (target, ratio) => {\r\n//                             this.setOpacity(Math.floor(255 * ratio));\r\n//                         }\r\n//                     })\r\n//             )\r\n\r\n//             // 停顿\r\n//             .delay(this.pauseDuration)\r\n\r\n//             // 第二阶段：同时淡出和上升第二部分距离\r\n//             .parallel(\r\n//                 tween(this.node)\r\n//                     .to(this.fadeOutDuration, { \r\n//                         position: new Vec3(\r\n//                             originalPos.x, \r\n//                             originalPos.y + this.firstRiseDistance + this.secondRiseDistance, \r\n//                             originalPos.z\r\n//                         ) \r\n//                     }),\r\n//                 tween(this as any) // 添加类型断言\r\n//                     .to(this.fadeOutDuration, { _opacity: 0 }, {\r\n//                         onUpdate: (target, ratio) => {\r\n//                             this.setOpacity(Math.floor(255 * (1 - ratio)));\r\n//                         }\r\n//                     })\r\n//             )\r\n\r\n//             .call(() => this.reset())\r\n//             .start();\r\n//     }\r\n\r\n//     // 为opacity添加getter和setter（可选）\r\n//     get opacity() {\r\n//         return this._opacity;\r\n//     }\r\n\r\n//     set opacity(value: number) {\r\n//         this._opacity = value;\r\n//     }\r\n// }\r\nimport { _decorator, Color, Component, Label, Node, Sprite, Tween, tween, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('coinEffect')\r\nexport class coinEffect extends Component {\r\n    @property(Sprite)\r\n    coinSprite: Sprite = null;\r\n\r\n    @property(Label)\r\n    coinLabel: Label = null;\r\n\r\n    // 动画参数\r\n    @property({ type: Vec3, displayName: '初始位置' })\r\n    startPosition: Vec3 = new Vec3(0, 0, 0);\r\n\r\n    @property({ displayName: '第一阶段上升距离' })\r\n    firstRiseDistance: number = 0.5;\r\n\r\n    @property({ displayName: '第二阶段上升距离' })\r\n    secondRiseDistance: number = 0.5;\r\n\r\n    @property({ displayName: '淡入时间(秒)' })\r\n    fadeInDuration: number = 0.3;\r\n\r\n    @property({ displayName: '停顿时间(秒)' })\r\n    pauseDuration: number = 0.2;\r\n\r\n    @property({ displayName: '淡出时间(秒)' })\r\n    fadeOutDuration: number = 0.5;\r\n\r\n    // 显式声明opacity属性\r\n    private _opacity: number = 0;\r\n    private currentTween: any = null;\r\n\r\n    start() {\r\n        this.reset();\r\n        // this.playEffect();\r\n    }\r\n\r\n    public setCoinNum(num: number) {\r\n        if (this.coinLabel && num > 0) {\r\n            this.coinLabel.string = \"x\" + num.toString();\r\n        }\r\n    }\r\n\r\n    reset() {\r\n        // 停止当前动画\r\n        if (this.currentTween) {\r\n            this.currentTween.stop();\r\n            this.currentTween = null;\r\n        }\r\n\r\n        this.node.setPosition(this.startPosition);\r\n        this.setOpacity(0);\r\n    }\r\n\r\n    setOpacity(value: number) {\r\n        if (this.coinSprite) this.coinSprite.color = new Color(255, 255, 255, value);\r\n        if (this.coinLabel) this.coinLabel.color = new Color(255, 255, 255, value);\r\n    }\r\n\r\n    // 公共方法，用于外部触发动画\r\n    public playEffect() {\r\n        // 如果正在播放，先重置\r\n        this.reset();\r\n\r\n        const originalPos = this.node.position.clone();\r\n        const originalScale = new Vec3(this.node.scale.x, this.node.scale.y, this.node.scale.z);\r\n        this.currentTween = tween(this.node)\r\n            .call(() => this.setOpacity(0))\r\n\r\n            // 第一阶段：同时淡入和上升第一部分距离\r\n            .parallel(\r\n                tween(this.node)\r\n                    .to(this.fadeInDuration, {\r\n                        position: new Vec3(\r\n                            originalPos.x,\r\n                            originalPos.y + this.firstRiseDistance,\r\n                            originalPos.z\r\n                        )\r\n                    }),\r\n                tween(this as any)\r\n                    .to(this.fadeInDuration, { _opacity: 255 }, {\r\n                        onUpdate: (target, ratio) => {\r\n                            this.setOpacity(Math.floor(255 * ratio));\r\n                        }\r\n                    }),\r\n                // 新增的缩放动画 (在当前缩放基础上增加 0.1)\r\n                tween(this.node)\r\n                    .to(0.3, {\r\n                        scale: new Vec3(\r\n                            this.node.scale.x + 0.01,\r\n                            this.node.scale.y + 0.01,\r\n                            this.node.scale.z + 0.01\r\n                        )\r\n                    })\r\n                    .to(0.2, { scale: originalScale }) // 0.3秒内恢复原始大小\r\n            )\r\n\r\n            // 停顿\r\n            .delay(this.pauseDuration)\r\n\r\n            // 第二阶段：同时淡出和上升第二部分距离\r\n            .parallel(\r\n                tween(this.node)\r\n                    .to(this.fadeOutDuration, {\r\n                        position: new Vec3(\r\n                            originalPos.x,\r\n                            originalPos.y + this.firstRiseDistance + this.secondRiseDistance,\r\n                            originalPos.z\r\n                        )\r\n                    }),\r\n                tween(this as any)\r\n                    .to(this.fadeOutDuration, { _opacity: 0 }, {\r\n                        onUpdate: (target, ratio) => {\r\n                            this.setOpacity(Math.floor(255 * (1 - ratio)));\r\n                        }\r\n                    })\r\n            )\r\n\r\n            .call(() => {\r\n                // 动画完成后重置状态，但保持不可见\r\n                this.node.setPosition(this.startPosition);\r\n                this.currentTween = null;\r\n            })\r\n            .start();\r\n    }\r\n\r\n    // 为opacity添加getter和setter\r\n    get opacity() {\r\n        return this._opacity;\r\n    }\r\n\r\n    set opacity(value: number) {\r\n        this._opacity = value;\r\n    }\r\n    // // 测试代码\r\n    // private addNum = 0;\r\n    // protected update(dt: number): void {\r\n    //        this.addNum+= dt;\r\n    //        if(this.addNum >= 3){\r\n    //              this.playEffect();\r\n    //              this.addNum = 0;\r\n    //        }\r\n\r\n\r\n    // }\r\n}"]}