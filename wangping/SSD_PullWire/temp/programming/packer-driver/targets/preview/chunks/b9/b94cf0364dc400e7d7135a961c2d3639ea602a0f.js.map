{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_PullWire/assets/JavaScript/core/CloudParticleEffect.ts"],"names":["_decorator","Component","tween","Color","ParticleSystem","ccclass","property","CloudParticleEffect","tweenInstance","_material","_currentColor","start","cloudParticleOuter","getMaterialInstance","set","initialOpacity","setProperty","cloudFadeEffct","isFadeIn","currentOpacity","a","targetOpacity","cloudFadeOutCallBack","action","stop","startColor","endOpacity","to","fadeDuration","onUpdate","target","easing","call","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, tween, Color, Tween, ParticleSystem, Material } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CloudParticleEffect')\r\nexport class CloudParticleEffect extends Component {\r\n    @property(ParticleSystem)\r\n    public cloudParticleOuter: ParticleSystem = null;\r\n\r\n    @property\r\n    public fadeDuration: number = 1;\r\n\r\n    @property\r\n    public initialOpacity: number = 127;     // 初始透明度\r\n\r\n    @property\r\n    public targetOpacity: number = 0;    // 目标透明度\r\n\r\n    @property\r\n    public particleColor: Color = new Color(114, 114, 114, 127);\r\n\r\n    private tweenInstance: Tween<Color> = null;\r\n    private _material: Material = null;\r\n    private _currentColor: Color = new Color();\r\n\r\n    protected start(): void {\r\n        this._material = this.cloudParticleOuter.getMaterialInstance(0);\r\n        this._currentColor.set(114, 114, 114, this.initialOpacity);\r\n        this._material.setProperty(\"tintColor\", this._currentColor);\r\n        \r\n\r\n    }\r\n\r\n    cloudFadeEffct(isFadeIn: boolean) {\r\n        // 获取当前透明度\r\n        const currentOpacity = this._currentColor.a;\r\n\r\n        // 边界检查：如果已经达到目标透明度，则不执行操作\r\n        if (isFadeIn && currentOpacity >= this.initialOpacity - 1) {\r\n            return;\r\n        }\r\n        \r\n        if (!isFadeIn && currentOpacity <= this.targetOpacity + 1) {\r\n            return;\r\n        }\r\n\r\n        this.cloudFadeOutCallBack(isFadeIn ? 'fadeIn' : 'fadeOut');\r\n    }\r\n\r\n    cloudFadeOutCallBack(action: 'fadeIn' | 'fadeOut') {\r\n        if (this.tweenInstance) {\r\n            this.tweenInstance.stop();\r\n            this.tweenInstance = null;\r\n        }\r\n\r\n        if (!this._material) {\r\n            this._material = this.cloudParticleOuter.getMaterialInstance(0);\r\n        }\r\n\r\n        // 使用当前颜色作为起始点\r\n        const startColor = new Color(this._currentColor);\r\n        const endOpacity = action === 'fadeIn' ? this.initialOpacity : this.targetOpacity;\r\n        \r\n        this.tweenInstance = tween(startColor)\r\n            .to(this.fadeDuration, { a: endOpacity }, {\r\n                onUpdate: (target: Color) => {\r\n                    this._currentColor.set(target);\r\n                    this._material.setProperty(\"tintColor\", this._currentColor);\r\n                },\r\n                easing: 'linear'\r\n            })\r\n            .call(() => {\r\n                this.tweenInstance = null;\r\n            })\r\n            .start();\r\n    }\r\n\r\n    onDestroy() {\r\n        if (this.tweenInstance) {\r\n            this.tweenInstance.stop();\r\n            this.tweenInstance = null;\r\n        }\r\n    }\r\n}"]}