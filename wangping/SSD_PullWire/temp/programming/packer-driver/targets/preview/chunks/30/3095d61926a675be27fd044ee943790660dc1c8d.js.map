{"version":3,"sources":["file:///D:/Cocos/PlayAble/SSD_PullWire/assets/JavaScript/UI/CoinComponent.ts"],"names":["_decorator","Component","instantiate","Label","Node","Quat","tween","Vec3","DataManager","EventManager","EventName","ccclass","property","CoinComponent","isCoinMessagee","_coins","_upgraded","_breathTween","_remainingCoinBatches","undefined","num","tiem","isFrister","isFrister1","start","coinNum","string","onEnable","inst","on","TowerUpgradeBtnClick","towerUpgrade","CoinAdd","coinAdd","onDisable","off","updateCoinNum","playBreathAni","Number","emit","coinNumUpLimit","String","Instance","upgradeAnimationType","upgradeTween","stop","upgradeNode","rotation","to","scale","easing","call","union","repeatForever","mainCamera","node","worldPosition","update","dt","Math","ceil","scheduleOnce","soundManager","playResourceSound","towerCoinNum","upgradeCoinNum","startPos","endPos","coinEndNode","clone","camera","convertToUINode","tesTiem","teim","console","log","coinNode","pop","active","parent","effectNode","setPosition","setScale","controlPoint","x","abs","y","z","position","onUpdate","target","ratio","t","removeFromParent","push","GiveTowerCoin","tweenAni","breathNode"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Component, instantiate, Label, Node, Quat, Tween, tween, UITransform, Vec3, view } from 'cc';\r\nimport { DataManager } from '../Global/DataManager';\r\nimport { EventManager } from '../Global/EventManager';\r\nimport { EventName } from '../Common/Enum';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CoinComponent')\r\nexport class CoinComponent extends Component {\r\n\r\n    @property(Label)\r\n    coinNum: Label = null;\r\n\r\n    @property(Node)\r\n    effectNode: Node = null;\r\n\r\n    @property(Node)\r\n    coinNode: Node = null;\r\n\r\n    @property(Node)\r\n    breathNode: Node = null;\r\n\r\n\r\n    private isCoinMessagee: boolean = false;\r\n\r\n    private _coins: Node[] = [];\r\n\r\n    private _upgraded: boolean = false;\r\n\r\n    private _breathTween: Tween<Node> | null = null;\r\n\r\n    start() {\r\n        this.coinNum.string = \"0\";\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        EventManager.inst.on(EventName.TowerUpgradeBtnClick, this.towerUpgrade, this);\r\n        EventManager.inst.on(EventName.CoinAdd, this.coinAdd, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        EventManager.inst.off(EventName.TowerUpgradeBtnClick, this.towerUpgrade, this);\r\n        EventManager.inst.off(EventName.CoinAdd, this.coinAdd, this);\r\n    }\r\n\r\n    private coinAdd() {\r\n        this.updateCoinNum();\r\n        this.playBreathAni();\r\n    }\r\n\r\n    private updateCoinNum() {\r\n        if (Number(this.coinNum.string) >= 900) {\r\n            if (this.isCoinMessagee == false) {\r\n                EventManager.inst.emit(EventName.coinNumUpLimit)\r\n                this.isCoinMessagee = true;\r\n            }\r\n\r\n        }\r\n        // this.scheduleOnce(() => {\r\n\r\n        //  }, 0.3)\r\n\r\n\r\n        this.coinNum.string = String(DataManager.Instance.coinNum);\r\n    }\r\n\r\n    //点击金币\r\n    private towerUpgrade() {\r\n        DataManager.Instance.upgradeAnimationType = 3;\r\n        DataManager.Instance.upgradeTween.stop();\r\n        DataManager.Instance.upgradeNode.rotation = new Quat(0, 0, 0, 1);\r\n        DataManager.Instance.upgradeTween = tween(DataManager.Instance.upgradeNode)\r\n            .to(0.05, { scale: new Vec3(0.95, 0.95, 0.95) }, { easing: \"quadOut\" })\r\n            .to(0.05, { scale: new Vec3(0.85, 0.85, 0.85) }, { easing: \"quadIn\" })\r\n            .to(0.1, { scale: new Vec3(1, 1, 1) }, { easing: \"quadIn\" })\r\n            .call(() => {\r\n                DataManager.Instance.upgradeTween = tween(DataManager.Instance.upgradeNode)\r\n                    .to(0.5, { scale: new Vec3(1.1, 1.1, 1.1) }, { easing: \"quadOut\" })\r\n                    .to(0.5, { scale: new Vec3(1, 1, 1) }, { easing: \"quadIn\" })\r\n                    .union()\r\n                    .repeatForever()\r\n                    .start()\r\n            })\r\n            .union()\r\n            .start()\r\n        if (this._upgraded) {\r\n            return;\r\n        }\r\n        if (DataManager.Instance.coinNum <= 0) {\r\n            return;\r\n\r\n        }\r\n\r\n\r\n\r\n        //摄像机移动\r\n        tween(DataManager.Instance.mainCamera.node)\r\n            .to(0.8, { worldPosition: new Vec3(0.014142, 34.1, 37.250385) })\r\n            .call(() => {\r\n                this._upgraded = true;\r\n            })\r\n            .start();\r\n\r\n\r\n\r\n\r\n    }\r\n    private _remainingCoinBatches: number | undefined = undefined;\r\n    private num = 0;\r\n    private tiem = 0.3;\r\n    private isFrister = false;\r\n    private isFrister1 = false;\r\n    protected update(dt: number): void {\r\n\r\n        // 初始化计数器（如果未设置）\r\n        if (this._upgraded && this._remainingCoinBatches === undefined) {\r\n            this._remainingCoinBatches = Math.ceil(DataManager.Instance.coinNum / 10);\r\n            this.num = this._remainingCoinBatches;\r\n            // if(this.num > 50 ){\r\n            //     this.num = 50;\r\n            // }\r\n        }\r\n        if (this.num > 0) {\r\n            this.scheduleOnce(() => {\r\n                DataManager.Instance.soundManager.playResourceSound();\r\n            }, 0.3)\r\n            this.num--;\r\n        }\r\n        if (this._upgraded === true && DataManager.Instance.coinNum > 0 && DataManager.Instance.towerCoinNum < DataManager.Instance.upgradeCoinNum) {\r\n            if (this.isFrister == false && this.isFrister1 == false) {\r\n                this.isFrister = true;\r\n            }\r\n            let startPos: Vec3 = new Vec3(0, 0, 0);\r\n            let endPos: Vec3 = DataManager.Instance.coinEndNode.worldPosition.clone();\r\n            let camera: Camera = DataManager.Instance.mainCamera.camera;\r\n            camera.convertToUINode(endPos, this.node, endPos);\r\n\r\n            // 飞钱\r\n            DataManager.Instance.coinNum -= 10;\r\n            let tesTiem = 0.5\r\n            if (DataManager.Instance.coinNum < 100) {\r\n                tesTiem = 0.1\r\n            } else {\r\n                tesTiem = 0.5\r\n            }\r\n            this.updateCoinNum();\r\n            if (this.isFrister == true) {\r\n                this.isFrister = false;\r\n                this.isFrister1 = true;\r\n                this.scheduleOnce(() => {\r\n                    let teim = dt\r\n\r\n\r\n\r\n                    if (DataManager.Instance.coinNum >= 100) {\r\n                        teim = dt\r\n\r\n                    } else if (DataManager.Instance.coinNum > 30 && DataManager.Instance.coinNum < 100) {\r\n                        teim = 0.05\r\n                    }\r\n                    else {\r\n                        teim = 0.2\r\n                    }\r\n\r\n                    console.log(\"this._remainingCoinBatches == \" + this._remainingCoinBatches)\r\n\r\n                    if (DataManager.Instance.upgradeAnimationType == 3) {\r\n                        DataManager.Instance.upgradeTween.stop();\r\n                        DataManager.Instance.upgradeTween = tween(DataManager.Instance.upgradeNode)\r\n                            .to(teim, { scale: new Vec3(1.1, 1.1, 1.1) }, { easing: \"quadOut\" })\r\n                            .to(teim, { scale: new Vec3(1, 1, 1) }, { easing: \"quadIn\" })\r\n                            .union()\r\n                            .repeatForever()\r\n                            .start()\r\n\r\n                    }\r\n\r\n                }, tesTiem)\r\n\r\n            }\r\n\r\n            // 减少剩余批次计数\r\n            if (this._remainingCoinBatches !== undefined) {\r\n                this._remainingCoinBatches--;\r\n\r\n            }\r\n\r\n            let coinNode: Node = this._coins.pop() || instantiate(this.coinNode);\r\n            coinNode.active = true;\r\n            coinNode.parent = this.effectNode;\r\n            coinNode.setPosition(startPos);\r\n            coinNode.setScale(new Vec3(0.8, 0.8, 1));\r\n\r\n\r\n            const controlPoint = new Vec3(\r\n                startPos.x - Math.abs(endPos.x - startPos.x) * 0.5,\r\n                (startPos.y + endPos.y) * 0.5 + 100,\r\n                startPos.z\r\n            );\r\n\r\n            tween(coinNode).to(0.5, {\r\n\r\n                position: endPos,\r\n                scale: new Vec3(0.6, 0.6, 1)\r\n            }, {\r\n                easing: 'cubicOut',\r\n                onUpdate: (target, ratio) => {\r\n\r\n                    const t = ratio;\r\n                    const x = (1 - t) * (1 - t) * startPos.x +\r\n                        2 * t * (1 - t) * controlPoint.x +\r\n                        t * t * endPos.x;\r\n                    const y = (1 - t) * (1 - t) * startPos.y +\r\n                        2 * t * (1 - t) * controlPoint.y +\r\n                        t * t * endPos.y;\r\n\r\n                    coinNode.position = new Vec3(x, y, startPos.z);\r\n                }\r\n            })\r\n                .call(() => {\r\n\r\n                    coinNode.active = false;\r\n                    coinNode.removeFromParent();\r\n                    this._coins.push(coinNode);\r\n                    if (DataManager.Instance.towerCoinNum < DataManager.Instance.upgradeCoinNum) {\r\n                        DataManager.Instance.towerCoinNum += 10;\r\n\r\n                        EventManager.inst.emit(EventName.GiveTowerCoin);\r\n\r\n                    }\r\n\r\n                    // 仅当所有批次都完成且金币处理完毕时才重置_upgraded\r\n                    if (this._remainingCoinBatches !== undefined && this._remainingCoinBatches <= 0 &&\r\n                        DataManager.Instance.coinNum < 10) {\r\n                        this._upgraded = false;\r\n                        this._remainingCoinBatches = undefined; // 重置计数器\r\n                        this.isFrister = false;\r\n                        this.isFrister1 = false;\r\n                        if (this._remainingCoinBatches > 2) {\r\n                            this.tiem = 0.5\r\n\r\n                        }\r\n                        else if (this._remainingCoinBatches < 1) {\r\n                            this.tiem = 0.2\r\n                        } else {\r\n                            this.tiem = 0.3\r\n                        }\r\n                        this.scheduleOnce(() => {\r\n                            DataManager.Instance.upgradeAnimationType = 1;\r\n                            DataManager.Instance.upgradeTween.stop();\r\n                            DataManager.Instance.upgradeNode.scale = new Vec3(1, 1, 1);\r\n                            if (DataManager.Instance.upgradeAnimationType == 1) {\r\n                                DataManager.Instance.upgradeTween = tween(DataManager.Instance.upgradeNode)\r\n                                    .to(0.5, { scale: new Vec3(1.1, 1.1, 1.1) }, { easing: \"quadOut\" })\r\n                                    .to(0.5, { scale: new Vec3(1, 1, 1) }, { easing: \"quadIn\" })\r\n                                    .union()\r\n                                    .repeatForever()\r\n                                    .start()\r\n\r\n                            }\r\n                        }, this.tiem)\r\n\r\n\r\n                    }\r\n                }).start();\r\n        }\r\n    }\r\n\r\n    // 公用呼吸动画方法（防叠加）\r\n    private playBreathAni() {\r\n        if (this._breathTween) {\r\n            this._breathTween.stop(); // 停止之前的动画\r\n        }\r\n\r\n        const tweenAni = tween(this.breathNode)\r\n            .to(0.08, { scale: new Vec3(1, 1, 1) }, { easing: 'quadOut' })\r\n            .to(0.08, { scale: new Vec3(0.8, 0.8, 1) }, { easing: 'quadIn' })\r\n            .start();\r\n\r\n        this._breathTween = tweenAni;\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}